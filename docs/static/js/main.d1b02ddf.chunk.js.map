{"version":3,"sources":["Types.ts","untyped-lambda-integration/AppTypes.ts","AppTypes.ts","components/MenuBar.tsx","markdown-integration/AppTypes.ts","components/CreateBox.tsx","components/Editor.tsx","untyped-lambda-integration/TreeComparator.ts","untyped-lambda-integration/EmptyExpression.tsx","misc/index.ts","untyped-lambda-integration/ReactPrinter.tsx","untyped-lambda-integration/ReductionMessage.tsx","untyped-lambda-integration/Step.tsx","untyped-lambda-integration/InactiveExpression.tsx","untyped-lambda-integration/Expression.tsx","untyped-lambda-integration/ExpressionBox.tsx","markdown-integration/Note.tsx","components/Box.tsx","untyped-lambda-integration/ExerciseSwitch.tsx","untyped-lambda-integration/BoxTopBar.tsx","markdown-integration/BoxTopBar.tsx","components/BoxTitleBar.tsx","components/BoxContainer.tsx","screens/Notebook.tsx","screens/Help.tsx","misc/UserGuide.ts","untyped-lambda-integration/Settings.tsx","screens/Settings.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["BoxType","Screen","PromptPlaceholder","EvaluationStrategy","CODE_NAME","defaultSettings","type","UNTYPED_LAMBDA","SLI","expandStandalones","strategy","NORMAL","ALL_BOX_TYPES","LISP","MARKDOWN","DEFAULT_WHITELIST","EmptyAppState","notebookList","boxList","activeBoxIndex","NaN","focusedBoxIndex","undefined","allowedBoxes","__key","Date","now","toString","settings","whitelist","UNTYPED_CODE_NAME","UntypedLambdaDefaultSettings","getDefaultSettings","currentNotebook","currentScreen","MAIN","loadAppStateFromStorage","maybeState","localStorage","getItem","setItem","JSON","stringify","state","map","notebook","box","index","arr","untypedLambdaBox","expression","decodedFirst","decodeUntypedLambdaFast","ast","history","step","iindex","decodedNth","reduction","lastReduction","decode","parse","e","MenuBar","props","onScreenChange","onImport","onNotebookChange","onDeleteNotebook","content","data","Blob","window","URL","createObjectURL","createURL","id","className","title","onClick","HELP","SETTINGS","onMarkDownBlur","isEditing","isAllowed","anyBoxAllowed","includes","CreateBox","addNew","whiteList","untLSettings","isRunning","breakpoints","timeoutID","timeout","isExercise","editor","placeholder","caretPosition","syntaxError","allowed","addLispBoxIfAllowed","note","addMDBoxIfAllowed","ActionType","TreeComparator","roots","translator","Map","equals","context","this","compare","left","right","Lambda","backup","entries","set","argument","name","Application","Macro","ChurchNumeral","Variable","has","get","Editor","submitOnEnter","onContent","onEnter","onExecute","lines","split","length","onChange","replace","InputField","onKeyDown","event","shiftKey","ctrlKey","key","preventDefault","stopPropagation","onKeyDownCapture","height","language","theme","value","options","formatOnPaste","minimap","enabled","EmptyExpression","isActive","Math","max","reportEvent","category","action","label","ga","getAll","send","exception","ReactPrinter","tree","rendered","visit","lambda","accumulator","body","isBreakpoint","Alpha","Array","from","conversions","some","conversion","identifier","args","Symbol","ASTReductionType","BETA","broken","Set","printMultiLambda","node","application","leftClassName","rightClassName","redex","Beta","Gama","acc","churchNumber","Expansion","target","EXPANSION","macro","redexes","redexClass","variable","ASTVisitor","ReductionMessage","ALPHA","GAMA","StepMemo","memo","stepRecord","addBreakpoint","children","message","strategyToEvaluator","nextReduction","printer","incorrectStep","indexOf","correctStep","exerciseStep","print","substr","lastStep","StepWrapper","InactiveExpression","Expression","bind","to","sequence","fn","result","i","mapLeftFromTo","addBox","createBoxFrom","isNormalForm","breakpoint","setBoxState","PureComponent","NormalEvaluator","APPLICATIVE","ApplicativeEvaluator","OPTIMISATION","OptimizeEvaluator","ABSTRACTION","NormalAbstractionEvaluator","ExpressionBox","onSubmitExpression","parseExpression","onExerciseStep","onStep","onRun","onStop","shouldBreak","EVAL_MODE","console","log","clone","None","userAst","normal","perform","VALIDATE_MODE","push","setTimeout","pop","find","add","clearTimeout","singleLetterVars","tokens","tokenize","lambdaLetters","ReactMarkdown","require","Note","isFocused","source","Box","updateBoxState","Switch","ExerciseSwitch","makeExercise","endExercise","checked","shape","BoxTopBar","removeBox","BoxTitleBar","BoxContainer","isActiveBox","isFocusedBox","makeActive","onBlur","insertBefore","boxTypeClassName","mapBoxTypeToStr","Notebook","download","accept","htmlFor","splice","updateNotebook","newIndex","Help","Radio","Settings","change","disabled","style","SettingsScreen","updateSettings","untypedSettings","unTypLSet","App","setScreen","changeNotebook","removeNotebook","onAddNotebook","setState","onSelectNotebook","screen","Number","isNaN","newSettings","Component","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.d1b02ddf.chunk.js","sourcesContent":["import { UntypedLambdaState, UntypedLambdaSettings } from \"./untyped-lambda-integration/AppTypes\"\nimport { NoteState } from \"./markdown-integration/AppTypes\"\n\nexport enum BoxType {\n  UNTYPED_LAMBDA,\n  LISP,\n  MARKDOWN,\n}\n\nexport enum Screen {\n  MAIN,\n  HELP,\n  MACROLIST,\n  SETTINGS,\n  // NOTEBOOKS,\n}\n\nexport type AnyBox = -1\n\nexport type NoBox = -2\n\n// TODO: when building `Exam Mode`  allow only Array<BoxType> or NoBox\nexport type BoxesWhitelist = Array<BoxType> | AnyBox | NoBox\n\nexport interface AbstractBoxState {\n  type : BoxType,\n  __key : string, \n  title : String,\n}\n\nexport interface AbstractSettings {\n  type : BoxType,\n}\n\nexport interface LispBox extends AbstractBoxState {\n  // TODO: delete this placeholder and implement it\n}\n\nexport interface LispSettings extends AbstractSettings {\n  // TODO: delete this placeholder and implement it\n}\n\nexport type BoxState = UntypedLambdaState | LispBox | NoteState // or other things in the future\n\nexport type Settings = UntypedLambdaSettings | LispSettings // or other things in the future\n\n// TODO: this needs to be reconsidered\nexport interface GlobalSettings {\n  // [UNTYPED_CODE_NAME] : UntypedLambdaSettings\n  [key : string] : Settings\n}\n\nexport interface NotebookState {\n  boxList : Array<BoxState>\n  activeBoxIndex : number\n  focusedBoxIndex : number | undefined\n  allowedBoxes : BoxesWhitelist\n\n  settings : GlobalSettings // TODO: refactor to use the Dictionary\n\n  __key : string\n}\n\nexport interface AppState {\n  notebookList : Array<NotebookState>,\n  currentNotebook : number,\n  currentScreen : Screen,\n}\n\n\n// TODO: move to specific integration\nexport interface MacroDefinitionState {\n  __key : string\n  type : BoxType\n  macroName : string\n  macroExpression : string\n  singleLetterNames : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\n\n\n","import { MacroMap, AST, ASTReduction, NormalEvaluator, ApplicativeEvaluator, OptimizeEvaluator, ASTReductionType } from \"@lambdulus/core\"\n\nimport { AbstractSettings } from '../Types'\nimport { BoxType, AbstractBoxState } from '../Types'\n\nexport const ADD_BOX_LABEL = '+λ'\n\nexport enum PromptPlaceholder {\n  INIT = 'Type λ (as \\\\) expression and hit enter',\n  EVAL_MODE = 'Hit enter for next step',\n  VALIDATE_MODE = 'Write next step and hit enter for validation',\n  MACRO = 'Define Macro like: `NAME := [λ expression]` and hit enter',\n  NOTE = 'Type note and hit shift enter'\n}\n\nexport type Breakpoint = {\n  type : ASTReductionType,\n  context : AST,\n  broken : Set<AST>,\n}\n\nexport interface StepRecord {\n  ast : AST\n  lastReduction : ASTReduction | null\n  step : number\n  message : string\n  isNormalForm : boolean\n}\n\nexport enum EvaluationStrategy {\n  NORMAL = 'Normal Evaluation',\n  APPLICATIVE = 'Applicative Evaluation',\n  OPTIMISATION = 'Optimisation - η Conversion',\n  ABSTRACTION = 'Abstraction / Simplified Evaluation'\n}\n\nexport interface UntypedLambdaState extends AbstractBoxState {\n  __key : string\n  type : BoxType\n  expression : string\n  ast : AST | null\n  history : Array<StepRecord>\n  isRunning : boolean\n  breakpoints : Array<Breakpoint>\n  timeoutID : number | undefined\n  timeout : number\n  isExercise : boolean\n  \n  strategy : EvaluationStrategy\n  SLI : boolean\n  expandStandalones : boolean\n  \n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport const CODE_NAME = 'UNTYPED_LAMBDA_CALCULUS'\n\nexport interface UntypedLambdaSettings extends AbstractSettings {\n  SLI : boolean\n  expandStandalones : boolean\n  strategy : EvaluationStrategy\n}\n\nexport const defaultSettings : UntypedLambdaSettings = {\n  type : BoxType.UNTYPED_LAMBDA,\n  SLI : false,\n  expandStandalones : false,\n  strategy : EvaluationStrategy.NORMAL\n}\n\nexport type Evaluator = NormalEvaluator | ApplicativeEvaluator | OptimizeEvaluator\n\n\nexport function createNewUntypedLambda (defaultSettings : UntypedLambdaSettings) : UntypedLambdaState {\n  return {\n    ...defaultSettings,\n    __key : Date.now().toString(),\n    title : \"\",\n    type : BoxType.UNTYPED_LAMBDA,\n    expression : \"\",\n    ast : null,\n    history : [],\n    isRunning : false,\n    breakpoints : [],\n    timeoutID : undefined,\n    timeout : 5,\n    isExercise : false,\n    \n    // strategy : EvaluationStrategy.NORMAL,\n    // singleLetterNames : false,\n    // standalones : false,\n    \n    editor : {\n      placeholder : \"placeholder\",\n      content : \"\",\n      caretPosition : 0,\n      syntaxError : null,\n    }\n  }\n}","import { UntypedLambdaState, CODE_NAME as UNTYPED_CODE_NAME, StepRecord } from \"./untyped-lambda-integration/AppTypes\"\nimport { defaultSettings as UntypedLambdaDefaultSettings } from './untyped-lambda-integration/AppTypes'\n\nimport { BoxType, Screen, BoxesWhitelist, AppState, GlobalSettings, NotebookState, BoxState } from \"./Types\"\nimport { AST, decodeFast as decodeUntypedLambdaFast, ASTReduction } from \"@lambdulus/core\"\n\n\n// TODO: when building `Exam Mode` simply leave only non-evaluative BoxTypes\nexport const ALL_BOX_TYPES : Array<BoxType> = [ BoxType.UNTYPED_LAMBDA, BoxType.LISP, BoxType.MARKDOWN ]\n\nexport const ANY_BOX = -1\n\nexport const NO_BOX = -2\n\nexport const DEFAULT_WHITELIST : BoxesWhitelist = ALL_BOX_TYPES\n\n\nexport function mapBoxTypeToStr (type : BoxType) : string {\n  switch (type) {\n    case BoxType.UNTYPED_LAMBDA:\n      return 'untypedLambdaBox'\n\n    case BoxType.MARKDOWN:\n      return 'markDownBox'\n    default:\n      return ''\n  }\n}\n\n\nexport const EmptyAppState : AppState = {\n  notebookList : [{\n    boxList : [],\n    activeBoxIndex : NaN,\n    focusedBoxIndex : undefined,\n    allowedBoxes : ANY_BOX,\n    __key : Date.now().toString(),\n    settings : getDefaultSettings(DEFAULT_WHITELIST)\n  }],\n  currentNotebook : 0,\n  currentScreen : Screen.MAIN,\n}\n\n\nexport function updateSettingsInStorage (settings : GlobalSettings) : void {\n  window.localStorage.setItem('global-settings', JSON.stringify(settings))\n}\n\nexport function getDefaultSettings (whitelist : BoxesWhitelist) : GlobalSettings {\n  let defaultSettings = {}\n\n  if (whitelist === NO_BOX) {\n    whitelist = []\n  }\n  else if (whitelist === ANY_BOX) {\n    whitelist = ALL_BOX_TYPES\n  }\n\n  for (const type of whitelist) {\n    switch (type) {\n      case BoxType.UNTYPED_LAMBDA:\n        defaultSettings = {\n          ...defaultSettings,\n          [UNTYPED_CODE_NAME] : UntypedLambdaDefaultSettings,\n        }\n        break;\n    \n      default:\n        break;\n    }\n  }\n\n  return defaultSettings\n}\n\nexport function loadSettingsFromStorage () : GlobalSettings {\n  const defaultSettings = {\n    [UNTYPED_CODE_NAME] : {}\n  }\n\n  const serialized : string | null = window.localStorage.getItem('global-settings')\n  const deserialized : GlobalSettings =  serialized === null ? defaultSettings : JSON.parse(serialized)\n\n  \n  for (const [key, value] of Object.entries(deserialized)) {\n    switch (key) {\n      case UNTYPED_CODE_NAME:\n        deserialized[key] = { ...UntypedLambdaDefaultSettings, ...value }\n        break;\n    \n      default:\n        console.error(\"Settings CODE NAME is not one of known Code Names.\")\n        break;\n    }\n  }\n\n  return deserialized\n}\n\n\nexport function loadAppStateFromStorage () : AppState {\n  const maybeState : string | null = localStorage.getItem('AppState')\n\n  if (maybeState === null) {\n    localStorage.setItem('AppState', JSON.stringify(EmptyAppState))\n    return EmptyAppState\n  }\n  else {\n    try {\n      return decode(JSON.parse(maybeState))\n    }\n    catch (e) {\n      return EmptyAppState\n    }\n  }\n}\n\nexport function updateAppStateToStorage (state : AppState) : void {\n  localStorage.setItem('AppState', JSON.stringify(state))\n}\n\n// TODO: This function is going to be replaced with correct implementation of decoding\n// this slowly becomes better and better base for the final implementation\n/**\n * This function THROWS Error in case of invalid argument\n * @param state : Deserialized form of AppState\n */\nfunction decode (state : AppState) : AppState | never {\n  const notebookList : Array<NotebookState> = state.notebookList.map((notebook : NotebookState) => {\n    const boxList : Array<BoxState> = notebook.boxList.map((box : BoxState, index : number, arr : Array<BoxState>) => {\n      switch (box.type) {\n        case BoxType.UNTYPED_LAMBDA: {\n          const untypedLambdaBox : UntypedLambdaState = box as UntypedLambdaState\n\n          if (untypedLambdaBox.expression === '') {\n            return untypedLambdaBox\n          }\n          \n          const decodedFirst : AST | null = decodeUntypedLambdaFast(untypedLambdaBox.ast)\n\n          if (decodedFirst === null) {\n            // TODO: repair:\n            // parse expression\n            // replace untypedLambdaBox.ast with parsed AST\n            // for now - throw error\n            throw \"ROOT AST IS NOT DECODABLE\"\n          }\n\n          untypedLambdaBox.ast = decodedFirst\n          untypedLambdaBox.history = untypedLambdaBox.history.map((step : StepRecord, iindex : number) => {\n            let decodedNth : AST | null = decodeUntypedLambdaFast(step.ast) as AST\n\n            if (decodedNth === null) {\n              // TODO: repair:\n              // try to take previous Step.ast and do the evaluation\n              // though - remember this Step.step (number) may not be + 1 of the previous one\n              // you will need to do the steps as long as need to be\n              // replace decodedNth with parsed AST\n              // for throw\n              throw \"CURRENT STEP IS NOT DECODABLE \" + index\n            }\n\n            // TODO: maybe instead of this theatre just use the Core . Evalautor\n            // and get real instance of ASTReduction\n            let reduction : ASTReduction | undefined | null = step.lastReduction\n\n            if (step.lastReduction === undefined) {\n              reduction = null\n            }\n\n            return {\n              ...step,\n              lastReduction : reduction,\n              ast : decodedNth, // TODO: as AST this is unsafe\n            }\n          })\n\n          return untypedLambdaBox\n        }\n      \n        default:\n          return box\n      }\n    })\n\n    return {\n      ...notebook,\n      boxList,\n    }\n  })\n  \n  return {\n    ...state,\n    notebookList,\n  }\n}","import React, { ChangeEvent } from 'react'\nimport { AST, tokenize, parse, Token, MacroMap, None } from '@lambdulus/core'\n\nimport { ANY_BOX, loadSettingsFromStorage } from '../AppTypes'\nimport { BoxType, Screen, AppState, NotebookState } from '../Types'\n\n\nimport '../styles/MenuBar.css'\n// import { reportEvent } from '../misc'; // later\n\ninterface MenuBarProperties {\n  state : AppState\n  onImport (state : AppState) : void\n  onScreenChange (screen : Screen) : void\n  onNotebookChange (index : number) : void\n  onAddNotebook (notebook : NotebookState) : void\n  onSelectNotebook (index : number) : void\n  onDeleteNotebook (index : number) : void\n}\n\nexport default function MenuBar (props : MenuBarProperties) : JSX.Element {\n  const { state, onImport, onScreenChange, onNotebookChange, onDeleteNotebook } : MenuBarProperties = props\n  const { notebookList, currentNotebook } = state\n\n  const { currentScreen } = state\n\n  // const dehydrated : object = dehydrate(state)\n\n  const serialized : string = JSON.stringify(state)\n  const link : string = createURL(serialized)\n\n  return (\n    <div id=\"menu-bar\">\n      {/* TODO: SOLVE WHERE TO MOVE NOTEBOOKS TABS */}\n      {/* <ul className='notebooks UL'>\n        {\n          notebookList.map(\n            (notebook : NotebookState, index : number) =>\n            <li className={ `LI${ currentNotebook === index ? ' current' : '' }` } key={ notebook.__key }>\n              <div className='notebookIconWrapper'>\n                {\n                  notebookList.length === 1 ?\n                  null\n                  :\n                  <i className=\"removeNtb far fa-times-circle\" onClick={ () => onDeleteNotebook(index) } />\n                }\n                <div className='notebookIcon' onClick={ () => props.onSelectNotebook(index) }>\n                  { index }\n                </div>\n              </div>\n            </li>\n          )\n        }\n        <div className='addNotebook' onClick={ () => props.onAddNotebook(createNewNotebook()) } >\n          +\n        </div>\n      </ul> */}\n\n      <div\n        className={ currentScreen === Screen.MAIN ? 'currentTab tab' : 'tab' }\n        title='Notebook Content'\n        onClick={ () => onScreenChange(Screen.MAIN) }\n      >\n        <i\n          className=\"icon far fa-file-alt\"\n        />\n          {/* <p className='iconLabel'>Notebook</p> */}\n      </div>\n\n      <div\n        className={ currentScreen === Screen.HELP ? 'currentTab tab' : 'tab' }\n        title='Show help'\n        onClick={ () => onScreenChange(Screen.HELP) }\n      >\n        <i\n          className=\"icon far fa-question-circle\"\n        />\n        {/* <p className='iconLabel'>Help</p> */}\n      </div>\n\n      <div\n        className={ currentScreen === Screen.SETTINGS ? 'currentTab tab' : 'tab' }\n        title='Go to Settings'\n        onClick={ () => onScreenChange(Screen.SETTINGS) }\n      >\n        <i\n          className=\"icon fas fa-cogs\"\n        />\n        {/* <p className='iconLabel'>Settings</p> */}\n      </div>\n\n      {/* <div title='List all defined macros' >\n        {\n          screen === Screen.main ?\n            <i className=\"icon fas fa-list-ul\" onClick={ () => onScreenChange(Screen.macrolist) } />\n            :\n            screen === Screen.macrolist ?\n              <i className=\"icon far fa-window-close\" onClick={ () => onScreenChange(Screen.main) } />\n              :\n              <i className=\"icon fas fa-list-ul\" onClick={ () => onScreenChange(Screen.macrolist) } />\n        }\n        <p className='iconLabel'>Macros</p>\n      </div>         */}\n\n      {/* TODO: SOLVE WHERE TO MOVE FEEDBACK/BUGS/ISSUES */}\n      {/* <div\n        className='tab'\n        title='Report a bug or request new feature'>\n        <a href='https://github.com/lambdulus/new-frontend/issues' target=\"_blank\">\n          <i className=\"icon fas fa-bug\"></i>\n        </a>\n        <p className='iconLabel'>Feedback</p>\n      </div>  */}\n    </div>\n  )\n}\n\n// function dehydrateBox (box : BoxState) : BoxState {\n//   const { type } : BoxState = box\n\n//   if (type === BoxType.EXPRESSION) {\n\n//     return {\n//       ...box,\n//       ast : null as any, // TODO: don't\n//       history : [], // TODO: don't\n//       isRunning : false,\n//       breakpoints : [], // TODO: solve how to don't\n//       timeoutID : undefined,\n//     }\n//   }\n\n//   return box\n// }\n\n// function dehydrate (state : AppState) : AppState {\n//   return {\n//     ...state,\n//     submittedBoxes : state.submittedBoxes.map(dehydrateBox)\n//   }\n// }\n\n// function hydrateBox (box : BoxState, macroTable : MacroMap) : BoxState {\n//   const { type } : BoxState = box\n  \n//   if (type === BoxType.EXPRESSION) {\n//     const { singleLetterNames } = box as UntypedLambdaState\n//     const ast : AST = parseExpression((box as UntypedLambdaState).expression, { macroTable, singleLetterNames })\n\n//     return {\n//       ...box,\n//       ast,\n//       history : [ { ast, lastReduction : None, step : 0, message : '', isNormalForm : false } ],\n//     }\n//   }\n\n//   return box\n// }\n\n// function hydrate (dehydrated : AppState) : AppState {\n//   const { macroTable } = dehydrated\n//   const config = { macroTable }\n\n//   return {\n//     ...dehydrated,\n//     submittedBoxes : dehydrated.submittedBoxes.map((box) => hydrateBox(box, macroTable))\n//   }\n// }\n\n// interface Config {\n//   singleLetterNames : boolean\n//   macroTable : MacroMap\n// }\n\n// function parseExpression (expression : string, config : Config) : AST {\n//   const { singleLetterNames : singleLetterVars, macroTable } : Config = config\n  \n//   const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n//   const ast : AST = parse(tokens, macroTable)\n\n//   return ast\n// }\n\nfunction createNewNotebook () : NotebookState {\n  return {\n    boxList : [],\n    activeBoxIndex : NaN,\n    focusedBoxIndex : undefined,\n    allowedBoxes : ANY_BOX,\n    __key : Date.now().toString(),\n    settings : loadSettingsFromStorage()\n  }\n}\n\nfunction onFiles (event : ChangeEvent<HTMLInputElement>, onImport : (state : AppState) => void) : void {\n  const { target : { files } } = event\n  if (files === null) {\n    return\n  }\n\n  const file : File = files[0]\n  const reader : FileReader = new FileReader\n  reader.onload = (event : Event) => {\n    const state : AppState = JSON.parse(reader.result as string)\n\n    // onImport(hydrate(state))\n    // reportEvent('Import notebook', `Notebook named ${ file.name }`, '')\n  }\n\n  reader.readAsText(file) \n}\n\nfunction createURL (content : string) : string {\n  const data = new Blob([ content ], {\n    type: 'application/json'\n  })\n\n  return window.URL.createObjectURL(data);\n}","import { BoxType, AbstractBoxState } from \"../Types\"\n\n\nexport interface NoteState extends AbstractBoxState {\n  __key : string\n  type : BoxType\n  note : string\n  isEditing : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport function createNewMarkdown () : NoteState {\n  return {\n    __key : Date.now().toString(),\n    type : BoxType.MARKDOWN,\n    title : 'Click Here to Change the Title',\n    note : '',\n    isEditing : true,\n    editor : {\n      placeholder : PromptPlaceholder,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null\n    }\n  }\n}\n\nexport const PromptPlaceholder : string = 'Note in MarkDown'\n\nexport function onMarkDownBlur (state : NoteState) : NoteState {\n  return {\n    ...state,\n    isEditing: false,\n  }\n}","import React from 'react'\n\nimport { ANY_BOX, NO_BOX } from '../AppTypes'\nimport { BoxType, BoxesWhitelist, BoxState, GlobalSettings } from '../Types'\nimport { createNewUntypedLambda, ADD_BOX_LABEL, UntypedLambdaSettings, CODE_NAME as UNTYPED_CODE_NAME, UntypedLambdaState } from '../untyped-lambda-integration/AppTypes'\nimport { createNewMarkdown } from '../markdown-integration/AppTypes'\n\n\ninterface Props {\n  addNew : (box : BoxState) => void,\n  whiteList : BoxesWhitelist,\n  settings : GlobalSettings\n}\n\nfunction anyBoxAllowed (whitelist : BoxesWhitelist) : boolean {\n  return whitelist === ANY_BOX\n}\n\nfunction noBoxAllowed (whitelist : BoxesWhitelist) : boolean {\n  return whitelist === NO_BOX\n}\n\nfunction isAllowed (type : BoxType, whitelist : BoxesWhitelist) : boolean {\n  return anyBoxAllowed(whitelist) || (whitelist as Array<BoxType>).includes(type)\n}\n\nexport function CreateBox (props : Props) : JSX.Element {\n  const { addNew, whiteList, settings } : Props = props\n\n  const untLSettings : UntypedLambdaSettings = settings[UNTYPED_CODE_NAME] as UntypedLambdaState\n\n  const addLambdaBoxIfAllowed = (allowed : boolean) => (\n    allowed ?\n      <p\n        className='plusBtn'\n        title='Create new λ box'\n        onClick={ () => props.addNew(createNewUntypedLambda(untLSettings)) } // TODO: some imported function from the Integration -- like Integration.CreateNewBox()\n      >\n        <i>{ ADD_BOX_LABEL }</i>\n      </p>\n      :\n      null\n  )\n\n  const addLispBoxIfAllowed = (allowed : boolean) => (\n    allowed ?\n      <p\n        className='plusBtn'\n        title='Create new Lisp box'\n        onClick={ () => props.addNew({} as BoxState) }\n      >\n        <i>+ Lisp</i>\n      </p>\n      :\n      null\n  )\n\n  const addMDBoxIfAllowed = (allowed : boolean) => (\n    allowed ?\n    <p\n      className='plusBtn'\n      title='Create new MarkDown box'\n      onClick={ () => props.addNew(createNewMarkdown()) }\n    >\n      <i>+ MD</i>\n    </p>\n    :\n    null\n  )\n\n  return (\n    noBoxAllowed(whiteList) ?\n      null as any\n      :\n      <div className='addBoxArea'>\n        <div className='addButtons'>\n          { addLambdaBoxIfAllowed(isAllowed (BoxType.UNTYPED_LAMBDA, whiteList)) }\n          { addLispBoxIfAllowed(isAllowed(BoxType.LISP, whiteList)) }\n          { addMDBoxIfAllowed(isAllowed(BoxType.MARKDOWN, whiteList)) }\n        </div>\n      </div>\n  )\n}\n","import React, { ChangeEvent, KeyboardEvent } from 'react'\nimport MonacoEditor from 'react-monaco-editor'\n\nimport '../styles/Editor.css'\n\n// import { EvaluationStrategy } from '../App'\n\n\nexport enum ActionType {\n  ENTER_EXPRESSION = 'Enter Expression',\n  ENTER_EXERCISE = 'Enter Exercise',\n  NEXT_STEP = 'Next Step',\n  RUN = 'Run',\n  ENTER_MD = 'Enter MarkDown',\n}\n\ninterface EditorProperties {\n  placeholder: string\n  content : string\n  caretPosition : number\n  syntaxError : Error | null\n  submitOnEnter : boolean\n  \n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n  // onReset () : void\n}\n\nexport default function Editor (props : EditorProperties) : JSX.Element {\n  const {\n    placeholder,\n    content,\n    caretPosition,\n    syntaxError,\n    submitOnEnter,\n\n    onContent,\n    onEnter,\n    onExecute,\n  } : EditorProperties = props\n  const lines : number = content.split('\\n').length\n\n  const onChange = (content : string) => {\n    // let { target : { value : content } } : { target : { value : string } } = event\n    // const caretPosition : number = event.target.selectionEnd\n\n    content = content.replace(/\\\\/g, 'λ')\n\n    onContent(content, caretPosition)\n  }\n\n  // TODO: Editor should not decide that - it should only implement onEnter onShiftEnter onCtrlEnter\n  const onKeyDown = (event : KeyboardEvent<HTMLDivElement>) => {\n    if ( ! event.shiftKey && ! event.ctrlKey && event.key === 'Enter') {\n      \n      if (submitOnEnter) {\n        event.stopPropagation()\n        event.preventDefault()\n        onEnter()\n      }\n\n      return\n    }\n\n    // if (event.shiftKey && event.key === 'Enter' && isMarkDown) {\n    //   event.preventDefault()\n    //   onEnter()\n    // }\n    if (event.ctrlKey && event.key === 'Enter') {\n      event.preventDefault()\n      onExecute()\n    }\n\n    // TODO: not yet\n    // if (event.ctrlKey && event.key === 'r') {\n    //   event.preventDefault()\n    //   onReset()\n    // }\n  }\n\n  return (\n    <div className='editorContainer'>\n      {\n        syntaxError ?\n        <p className='editorError'>\n          { `${syntaxError}` }\n        </p>\n        :\n        null\n      }\n\n      <div className=\"editor\">\n        <InputField\n          placeholder={ placeholder }\n          content={ content }\n          lines={ lines }\n          caretPosition={ caretPosition }\n          // onChange={ onChange }\n          onContent={ (content : string) => onChange(content) }\n          onKeyDown={ onKeyDown }\n        />\n      </div>\n    </div>\n  )\n}\n\ninterface InputProps {\n  placeholder : string\n  content : string\n  lines : number\n  caretPosition : number\n  // onChange (event : ChangeEvent<HTMLTextAreaElement>) : void\n  onContent (content : string) : void\n  onKeyDown (event : KeyboardEvent<HTMLDivElement>) : void\n}\n\nfunction InputField (props : InputProps) : JSX.Element {\n  const { placeholder, content, lines, onKeyDown, caretPosition, onContent } : InputProps = props\n\n  return (\n    <div\n      onKeyDownCapture={ onKeyDown }\n    >\n      <MonacoEditor\n        // width=\"800\"\n        height={10 * 19} // 10 lines by default\n        language=\"markdown\"\n        theme=\"vs-light\"\n        value={ content }\n        options={ { formatOnPaste : true, minimap : { enabled : false} } }\n        onChange={ (content : string) => onContent(content) }\n        // editorDidMount={ ::this.editorDidMount }\n      />\n    </div>\n  )\n}","import { AST, Lambda, Application, Macro, ChurchNumeral, Variable } from \"@lambdulus/core\"\n\n///////////////////////////////////////////////////////////////////////////////////////\n\ntype Pair<T> = [T, T]\ntype Triple<T> = [T, T, T]\n\n\n// TODO: fix the public equals interface, maybe public get and private set?\n// maybe implement public get method and bool itself leave private?\n//\n// first I need more trees, I need the previous AST\nexport class TreeComparator {\n  private translator : Map<string, string> = new Map\n  public equals : boolean = true\n  private context : Pair<AST>\n\n  constructor (readonly roots : Pair<AST> ) {\n    [ ...this.context ] = roots\n    // TODO: I need to compare roots first\n    this.compare()\n  }\n\n  compare () : void {\n    /**\n    TODO: compare need to compare both children if got\n    if one of them is incorrect\n    then solve that problem\n    if both of them is incorrect\n    then solve both problems and then decide how both come together\n\n    then I have an instance of knowledge system\n    I can fire up that system in this context (this node with invalid children)\n    system will need to get instance of something to call methods on\n    because system needs to ask questions - like, is this possible,\n    is this error applicable?\n    so instead of human, code will look up the AST and answer the questions\n    so it will be some kind of class which is able to observe all 3 ASTs at the same time\n    it will also have implemented query methods,\n    probably wont be many of them, just few\n    **/\n    \n    const [ left, right ] : Pair<AST> = this.context\n\n    if (left instanceof Lambda && right instanceof Lambda) {\n      const backup : Map<string, string> = new Map(this.translator.entries())\n\n      this.translator.set(left.argument.name(), right.argument.name())\n      this.context = [ left.right, right.right ]\n      this.compare()\n\n      this.translator = backup\n    }\n    else if (left instanceof Application && right instanceof Application) {\n      this.context = [ left.left, right.left ]\n      this.compare()\n\n      if ( ! this.equals) {\n        return\n      }\n\n      this.context = [ left.right, right.right ]\n      this.compare()\n    }\n    else if (left instanceof Macro && right instanceof Macro) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof ChurchNumeral && right instanceof ChurchNumeral) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof Variable && right instanceof Variable) {\n      if (this.translator.has(left.name())) {\n        this.equals = this.translator.get(left.name()) === right.name()\n      }\n      else {\n        this.equals = left.name() === right.name()\n      }\n    }\n    else {\n      this.equals = false\n    }\n  }\n}","import React, { useContext, ReactNode } from 'react'\n\nimport Editor from '../components/Editor'\n// import { MakeActiveContext, DeleteBox } from './BoxSpace'\nimport { StepRecord } from './AppTypes'\n\ninterface EmptyExpressionProps {\n  className : string\n  isActive : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n  history : Array<StepRecord>\n\n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n}\n\n\nexport default function EmptyExpression(props : EmptyExpressionProps) : JSX.Element{\n  const { className, isActive, editor } = props\n  const {\n    placeholder,\n    content,\n    caretPosition,\n    syntaxError,\n  } = editor\n\n  // const makeActive = useContext(MakeActiveContext)\n  // const deleteBox = useContext(DeleteBox)\n\n  return (\n    <div\n      className={ `${className} ${isActive ? '' : ' inactiveBox'}` }\n    >\n      {\n        isActive ?\n          (\n            <div>\n              <Editor\n                placeholder={ placeholder } // data\n                content={ content } // data\n                caretPosition={ caretPosition } // data\n                syntaxError={ syntaxError } // data\n                submitOnEnter={ true } // data\n\n                onContent={ props.onContent } // fn\n                onEnter={ props.onEnter } // fn // tohle asi bude potreba\n                onExecute={ props.onExecute } // fn // tohle asi bude potreba\n              />\n            </div>\n          )\n          :\n          (\n            <div>\n              <p className='inactiveMessage'>\n                Collapsing { Math.max(0, props.history.length - 1) } { props.history.length === 2 ? 'step' : 'steps' }. Double click to activate this box.\n              </p>\n              </div>\n          )\n      }\n    </div>\n  )\n}","import { MacroMap } from \"@lambdulus/core\"\n\n\nexport function debounce (fn : Function, treshold : number)\n : [ (...args : Array<any>) => void, () => void ] {\n  let timer : number\n  \n  return [\n    function debounced (...args : Array<any>) : void {\n      window.clearTimeout(timer)\n\n      timer = window.setTimeout(() => {\n        fn(...args)\n      }, treshold)\n    },\n    function cancel () : void {\n      window.clearTimeout(timer)\n    }\n  ]\n}\n\n// export function getSavedMacros () : MacroMap {\n//   return JSON.parse(window.localStorage.getItem('macrotable') || '{}')\n// }\n\nexport function trimStr (str : string) : string {\n  return str.trim()\n}\n\nexport function mapLeftFromTo(\n  from : number,\n  to : number,\n  sequence : Array<any>,\n  fn : (...args : Array<any>) => any) {\n    const result : Array<any> = new Array(to - from + 1)\n\n    for (let e = 0, i = from; i <= to; ++i) {\n      result[e++] = fn(sequence[i], i)\n    }\n\n    return result\n  }\n\n// export const HANDY_MACROS : MacroMap = {\n//   // 'Y' : '(λ f . (λ x . f (x x)) (λ x . f (x x)))',\n//   // 'Z' : '(λ f . (λ y . f (λ z . y y z)) (λ y . f (λ z . y y z)))',\n//   // FACT : '(Y (λ f n . (<= n 1) 1 (* n (f (- n 1)))))',\n//   // FACCT : '(λ n . (Y (λ f n a . IF (= n 1) a (f (- n 1) (* n a)))) (- n 1) (n))',\n//   // FIB : '(Y (λ f n . (= n 0) 0 ((= n 1) 1 ( + (f (- n 1)) (f (- n 2))))))',\n//   // // SHORTLIST : 'CON 3 (CONS 5 (CONS 1 NIL))',\n//   // // LONGLIST :  '(CONS 3 (CONS 5 (CONS 1 (CONS 10 (CONS 7 (CONS 2 (CONS 4 (CONS 9 (CONS 4 (CONS 6 (CONS 8 NIL)))))))))))',\n//   // APPEND : 'Y (λ fn listA listB . IF (NULL listA) (listB) (CONS (FIRST listA) (fn (SECOND listA) listB)))',\n//   // LISTGREQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (>= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // LISTLESS : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (< (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // LISTGR : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (> (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // LISTEQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // QUICKSORT : 'Y (λ fn list . IF (NULL list) (NIL) ( IF (NULL (SECOND list)) (list) ( APPEND (fn (LISTLESS (FIRST list) list)) ( APPEND (LISTEQ (FIRST list) list) (fn (LISTGR (FIRST list) list)) ) ) ) )',\n//   // INFLIST : '(λ n . (Y (λ x . (λ f s g . g f s) n x)))',\n//   // REMOVENTH : 'Y (λ fn list n . IF (= n 0) (SECOND list) (IF (NULL list) NIL (CONS (FIRST list) (fn (SECOND list) (- n 1) ) ) ) )',\n//   // NTH : 'Y (λ fn list n . IF (= n 0) (FIRST list) (IF (NULL (list)) NIL (fn (SECOND list) (- n 1)) ) )',\n//   // LEN : 'Y (λ fn list . IF (NULL list) (0) (+ 1 (fn (SECOND list) )) )',\n//   // GETNTH : '(λ end . (Y (λ f n i . (end i) (i) ( (= n 0) (Y (λ f a . (end a) (i) (f) ) ) (f (- n 1)) ) )) )',\n//   // MAP : '(λ fn l . (Y (λ f it . IF (NULL it) (NIL) (CONS (fn (FIRST it)) (f (SECOND it))) )) l )',\n//   // REDUCE : '(λ fn l init . Y (λ f it acc . IF (NULL it) (acc) (f (SECOND it) (fn (FIRST it) acc)) ) l init )',\n//   // APPLY : '(λ f args . Y (λ ff f l . (NULL l) (f) (ff (f (FIRST l)) (SECOND l)) ) f args )',\n//   // RANGE : '(λ m n . Y (λ f e . (= e n) (CONS e NIL) (CONS e (f (+ e 1))) ) m )',\n//   // LISTCOMPR : '(λ args . APPLY (λ op in rng cond . Y (λ f l . (NULL l) (NIL) ( (cond (FIRST l)) (CONS (op (FIRST l)) (f (SECOND l))) (CONS (FIRST l) (f (SECOND l))) ) ) rng ) args )',\n//   // MOD : '(λ n m . (n (λ n . (= n (- m 1)) (0) (+ n 1)) (0)) )',\n//   // INFIX : 'APPLY (λ l op r . op l r)',\n// }\n\n// export function updateMacros (macroTable : MacroMap) : void {\n//   window.localStorage.setItem('macrotable', JSON.stringify(macroTable))\n// }\n\nexport function reportEvent (category : string, action : string, label : string) : void {\n  try {\n    const tracker = (window as any).ga.getAll()[0]\n    \n    tracker.send('event', category, action, label )\n  }\n  catch (exception) {\n    // instead of printing to the console - show notification on the web\n    // console.log(\"\")\n    // console.log('PLEASE DISABLE YOUR ADBLOCKER OR ALLOW GOOGLE ANALYTICS FOR THIS SITE')\n    // console.log(\"\")\n    // console.error(exception)\n  }\n}","import React from 'react'\n\nimport { ASTVisitor, Lambda, Variable, Beta, AST, Application, ChurchNumeral, Expansion, Macro, ASTReduction, Alpha, Gama, ASTReductionType } from \"@lambdulus/core\"\nimport { Breakpoint } from './AppTypes'\nimport { reportEvent } from '../misc';\n\n\nexport default class ReactPrinter extends ASTVisitor {\n  private rendered : JSX.Element | null = null\n  private argument : Variable | null = null\n\n  private printMultiLambda (lambda : Lambda, accumulator : JSX.Element) : void {\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.body.argument\n      let className : string = 'argument'\n      let title : string = ''\n\n      if (this.isBreakpoint(lambda.body.argument)) {\n        className += ' breakpoint'\n        title = 'Will break on substitution'\n      }\n\n      // bug@highlight-alpha\n      let set = false\n      if (this.reduction instanceof Alpha\n            &&\n          Array.from(this.reduction.conversions).some((conversion : Lambda) => {\n            return conversion.identifier === lambda.body.identifier\n          })\n          ) {\n              this.argument = context\n              set = true\n              className += ' alpha'\n      }\n\n      // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n      let argument : Variable | null = this.argument\n      if (this.argument !== lambda.body.argument\n          &&\n          this.argument !== null\n          &&\n          this.argument.name() === lambda.body.argument.name()) {\n        this.argument = null\n      } // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n\n      // TODO: same here\n      if (this.argument\n          &&\n          this.argument.name() === context.name()) {\n            className += ' substitutedArg'\n        }\n\n      const args : JSX.Element = (\n        <span className='arguments'>\n          { accumulator } {' '}\n          <span\n            className={ className }\n            title={ title }\n            onClick={ () => {\n              (context as any).identifier = Symbol()\n              this.onClick({ type : ASTReductionType.BETA, context, broken : new Set })\n              reportEvent('Breakpoint added to argument', 'Breakpoint was added', '')\n            }\n            }\n          >\n            { context.name() }\n          </span>\n        </span>\n      )\n      \n      this.printMultiLambda(lambda.body, args)\n      if (set === true) {\n        this.argument = null\n      }\n      this.argument = argument // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n    }\n    else {\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n      this.rendered = accumulator\n\n      this.rendered = (\n        <span className='function'>\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          { accumulator } . { body }\n          )\n        </span>\n      )\n    }\n  }\n\n  isBreakpoint (node : AST) : boolean {\n    for (const breakpoint of this.breakpoints) {\n      if (breakpoint.context.identifier === node.identifier) {\n        return true\n      }\n    }\n    return false\n  }\n\n  constructor (\n    public readonly tree : AST,\n    private readonly onClick : (breakpoint : Breakpoint) => void,\n    private readonly reduction : ASTReduction,\n    private readonly breakpoints : Array<Breakpoint>,\n  ) {\n    super()\n    this.tree.visit(this)\n  }\n\n  print () : JSX.Element | null {\n    return this.rendered\n  }\n\n  // TODO: little bit refactored, maybe keep going\n  onApplication (application: Application) : void {\n    let className : string = 'application'\n    let leftClassName : string = 'left'\n    let rightClassName : string = 'right'\n    let set : boolean = false\n    let redex : AST | null = null\n\n    if (this.reduction instanceof Beta) {\n      redex = this.reduction.redex\n    }\n\n    if (this.reduction instanceof Gama && this.reduction.args.includes(application)) {\n      className += ' redex abstraction argument'\n    }\n    // else if (this.reduction instanceof Expansion) {\n    //   redex = this.reduction.target\n    // } // to asi neni uplne potreba tady\n\n    if (redex !== null\n          &&\n        redex.identifier === application.identifier // tohle je asi trosku useles\n          &&\n        redex === application\n      ) {\n        leftClassName += ' redex'\n        rightClassName += ' redex'\n\n        // TODO: this is probably not good and should be done other way\n\n        if (application.left instanceof Lambda) {\n          this.argument = application.left.argument\n          set = true\n        }\n    }\n\n    if (application.right instanceof Application) {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3 a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>( { this.rendered } )</span>\n\n      this.rendered =\n      <span className={ className }>\n        { left } { right }\n      </span>\n    }\n    else {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>{ this.rendered }</span>\n\n      this.rendered =\n      <span className={ className }>\n        { left } { right }\n      </span>\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onLambda (lambda: Lambda) : void {\n    // TODO: this also seems not so elegant and clean\n\n    let title : string = ''\n\n    let argument : Variable | null = this.argument\n    if (this.argument !== lambda.argument\n        &&\n        this.argument !== null\n        &&\n        this.argument.name() === lambda.argument.name()) {\n      this.argument = null\n    }\n\n\n    // multilambda\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n        title = 'Will break on substitution'\n      }\n\n      // TODO: same here\n      if (this.argument\n        &&\n        this.argument.name() === context.name()) {\n          className += ' substitutedArg'\n      }\n\n      // if (this.reduction instanceof Alpha) {\n      //   className += ' alpha'\n      // }\n\n      const acc : JSX.Element = (\n        <span\n          className={ className }\n          title={ title }\n          onClick={ () => {\n            (context as any).identifier = Symbol()\n            this.onClick({ type : ASTReductionType.BETA, context, broken : new Set })\n            reportEvent('Breakpoint added to argument', 'Breakpoint was added', '')\n          }\n          }\n        >{ lambda.argument.name() }\n        </span>\n      )\n\n      this.printMultiLambda(lambda, acc)\n    }\n    else {\n      const context : Variable = lambda.argument\n\n      // lambda.argument.visit(this)\n      \n      // const args : JSX.Element | null = this.rendered\n\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n\n      let className : string = 'argument'\n      let title : string = ''\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n        title = 'Will break on substitution'\n      }\n\n      // TODO: same here\n      if (this.argument\n        &&\n        this.argument.name() === context.name()) {\n          className += ' substitutedArg'\n      }\n\n      this.rendered = (\n        <span className='function' >\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          <span\n            className='arguments'\n            onClick={ () => {\n              (context as any).identifier = Symbol()\n              // TODO: for now it does nothing - maybe delete in the future            \n              // this.onClick({ type : Beta, context, broken : new Set })\n              // reportEvent('Breakpoint added to argument', 'Breakpoint was added', '')\n            }\n            }\n          >\n            <span\n                className={ className }\n                title={ title }\n                onClick={ () => {\n                  (context as any).identifier = Symbol()\n                  this.onClick({ type : ASTReductionType.BETA, context, broken : new Set })\n                  reportEvent('Breakpoint added', 'Breakpoint was added', '')\n                }\n                }\n            >\n              { lambda.argument.name() }\n            </span>\n            { ' ' }\n          </span>\n          . { body } \n          )\n        </span>\n      )\n    }\n\n    this.argument = argument\n    if (argument !== null) {\n      this.argument = argument\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onChurchNumeral (churchNumber: ChurchNumeral) : void {\n    let className : string = 'churchnumeral'\n    let redex : AST | null = null\n    let redexClass : string = ' redex'\n    let title : string = ''\n\n    if (this.reduction instanceof Expansion) {\n      redex = this.reduction.target\n    }\n\n    if (this.reduction instanceof Gama && this.reduction.args.includes(churchNumber)) {\n      className += ' redex abstraction argument'\n    }\n\n    if (redex !== null\n          &&\n        redex.identifier === churchNumber.identifier\n          &&\n        redex === churchNumber\n      ) {\n        className += redexClass\n    }\n\n    if (this.isBreakpoint(churchNumber)) {\n      className += ' breakpoint'\n      title = 'Will break on Expansion'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        title={ title }\n        onClick={ () => {\n          (churchNumber as any).identifier = Symbol()\n          this.onClick({ type: ASTReductionType.EXPANSION, context : churchNumber, broken : new Set })\n          reportEvent('Breakpoint added to ChurchNumeral', 'Breakpoint was added', '')\n        }\n        }\n      >\n        { churchNumber.name() }\n      </span>\n    )\n  }\n\n  // TODO: little bit refactored, maybe keep going  \n  onMacro (macro: Macro) : void {\n    let className = 'macro'\n    let redex : AST | null = null\n    let redexClass : string = ' redex'\n    let title : string = ''\n\n    if (this.reduction instanceof Expansion) {\n      redex = this.reduction.target\n    } \n\n    if (this.reduction instanceof Gama) {\n      if (this.reduction.redexes.includes(macro)) {\n        [ redex ] = this.reduction.redexes\n        className += redexClass + ' abstraction'\n      }\n\n\n      if (this.reduction.args.includes(macro)) {\n        className += redexClass + ' abstraction argument'\n      }\n    }\n\n\n    if (redex !== null\n          &&\n        redex.identifier === macro.identifier\n          &&\n        redex === macro\n        ) {\n      className += redexClass\n    }\n\n    if (this.isBreakpoint(macro)) {\n      className += ' breakpoint'\n      title = 'Will break on Expansion'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        title={ title }\n        onClick={ () => {\n          (macro as any).identifier = Symbol()\n          this.onClick({ type: ASTReductionType.EXPANSION, context : macro, broken : new Set })\n          reportEvent('Breakpoint added to Macro', 'Breakpoint was added', '')\n        }\n        }\n      >\n        { macro.name() }\n      </span>\n    )\n  }\n  \n  onVariable (variable: Variable): void {\n    // TODO: same here - not so clean\n    let className : string = 'variable'\n\n    if (this.argument\n        &&\n        this.argument.name() === variable.name()) {\n          className += ' substitutedArg'\n          if (this.reduction instanceof Alpha) {\n            className += ' alpha'\n          }\n      }\n\n    this.rendered = <span className={ className } >{ variable.name() }</span>\n  }\n}","import React from 'react'\nimport { ASTReduction, Beta, Alpha, Expansion, Gama, ASTReductionType } from '@lambdulus/core' // , Eta\n\n\ninterface ReductionMessageProperties {\n  lastReduction : ASTReduction | null\n}\n\nexport default function ReductionMessage (props : ReductionMessageProperties) : JSX.Element {\n  const { lastReduction } = props\n\n  if (lastReduction === null) {\n    return null as any\n  }\n\n  if (lastReduction.type === ASTReductionType.BETA) {\n    return (\n      <p className='lastReduction'>\n        β reduction\n      </p>\n    )\n  }\n\n  if (lastReduction.type === ASTReductionType.ALPHA) {\n    return (\n      <p className='lastReduction'>\n        α conversion\n      </p>\n    )\n  }\n\n  if (lastReduction.type === ASTReductionType.EXPANSION) {\n    return (\n      <p className='lastReduction'>\n        Macro expansion\n      </p>\n    )\n  }\n\n  // if (lastReduction.type === ASTReductionType.ETA) {\n  //   return (\n  //     <p className='lastReduction'>\n  //       η conversion\n  //     </p>\n  //   )\n  // }\n\n  if (lastReduction.type === ASTReductionType.GAMA) {\n    return (\n      <p className='lastReduction'>\n        Simplified Application\n      </p>\n    )\n  }\n\n  else {\n    return null as any\n  }\n  \n}","import React, { memo } from 'react'\nimport { ASTReduction } from '@lambdulus/core'\n\nimport './styles/Step.css'\n\nimport { strategyToEvaluator } from './ExpressionBox'\nimport ReactPrinter from './ReactPrinter'\n// import ReductionMessage from './ReductionMessage'\nimport { EvaluationStrategy, StepRecord, Breakpoint, Evaluator } from './AppTypes'\nimport ReductionMessage from './ReductionMessage'\n// import { StrategyContext } from './DataInjector'\n\n\ninterface StepWrapperProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  lastStep : boolean\n}\n\ninterface StepProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  strategy : EvaluationStrategy\n  lastStep : boolean\n}\n\n// This is done because of highlighting - if Strategy is changed ->\n// old steps should not be re-highlighted with changed Strategy - but stay same\nconst StepMemo = memo(Step, (props : StepProperties) => !props.lastStep)\n\nexport default function StepWrapper (props : StepWrapperProperties) : JSX.Element {\n  // return(\n  //   <StrategyContext.Consumer>\n  //     { \n  //       (strategy : EvaluationStrategy) => <StepMemo { ...props } strategy={ strategy } />\n  //     }\n  //   </StrategyContext.Consumer>\n  // )\n  return(\n    <StepMemo { ...props } strategy={ EvaluationStrategy.NORMAL } />\n  )\n}\n\nfunction Step (props : StepProperties) : JSX.Element | null {\n  const { stepRecord, addBreakpoint, breakpoints, children, strategy } = props\n  const { ast : tree, lastReduction, step, message } = stepRecord\n\n  if (tree === null) {\n    return null\n  }\n\n  const evaluator : Evaluator = new (strategyToEvaluator(strategy) as any)(tree)\n  const reduction : ASTReduction = evaluator.nextReduction\n  const printer : ReactPrinter = new ReactPrinter(tree, addBreakpoint, reduction, breakpoints)\n\n  const incorrectStep : boolean = stepRecord.message.indexOf('Incorrect step.') === 0\n  const correctStep : boolean = stepRecord.message.indexOf('Correct.') === 0\n  const exerciseStep : boolean = incorrectStep || correctStep\n\n  return (\n    <span className='step'>\n      <ReductionMessage lastReduction={ lastReduction } />\n      <div className='inlineblock' >\n        <p className='stepNumber' >\n          { step } :\n        </p>\n        { printer.print() }\n        { children }\n        {\n          stepRecord.message === '' ?\n            null\n            :\n            exerciseStep === false ?\n            <p className='stepMessage' >\n              { stepRecord.message }\n            </p>\n            :\n            incorrectStep === true ?\n              <p className='stepMessage incorrect' >\n                Incorrect input: <i className='userInput'>`{ stepRecord.message.substr(15) }`</i>\n              </p>\n            :\n              <p className='stepMessage correct' >\n                { stepRecord.message }\n              </p>\n        }\n      </div>\n    </span>\n  )\n}","import React, { useContext, ReactNode } from 'react'\n\nimport Step from './Step'\n// import { AddBoxContext } from './MethodInjector'\nimport { Breakpoint, StepRecord, UntypedLambdaState } from './AppTypes'\n// import { DeleteBox, MakeActiveContext } from './BoxSpace'\n\ninterface InactiveExpressionProps {\n  className : string\n  breakpoints : Array<Breakpoint>\n  history : Array<StepRecord>\n\n  createBoxFrom (stepRecord : StepRecord) : UntypedLambdaState\n}\n\n\nexport default function InactiveExpression (props : InactiveExpressionProps) : JSX.Element {\n  const { className } = props\n  // const deleteBox = useContext(DeleteBox)\n  // const makeActive = useContext(MakeActiveContext)\n\n  return (\n    <div\n      className={ className + ' inactiveBox' }\n    >\n      <ul className='UL'>\n        <li key={ 0 } className='activeStep LI'>\n          <Step\n            breakpoints={ props.breakpoints }\n            addBreakpoint={ () => {} } // blank function - NOOP\n            stepRecord={ props.history[0] }\n            lastStep={ false }\n          >\n            \n            {/* <AddBoxContext.Consumer>\n              {\n                (addBox : (boxState : BoxState) => void) => <i\n                  className=\"hiddenIcon fas fa-pencil-alt\"\n                  onClick={ () => addBox(props.createBoxFrom(props.history[0])) }\n                />\n              }\n            </AddBoxContext.Consumer> */}\n            \n          </Step>\n        </li>\n      </ul>\n      <p className='inactiveMessage'>\n        Collapsing { props.history.length - 1 } { props.history.length === 2 ? 'step' : 'steps' }. Double click to activate this box.\n      </p>\n    </div>\n  )\n}"," import React, { PureComponent, ReactNode } from 'react'\n\n// import Controls from './Controls' // TODO: Controls are gonna be imported from the Frontend app - or maybe not even imported just passed as children\nimport Step from './Step'\nimport { PromptPlaceholder, UntypedLambdaState, Breakpoint, StepRecord } from './AppTypes'\nimport Editor from '../components/Editor'\n// import { DeleteBox } from './BoxSpace'\n// import { AddBoxContext } from './MethodInjector'\nimport { mapLeftFromTo } from '../misc'\n// import BoxTopBar from './BoxTopBar'\n// import Controls from './ExerciseSwitch'\n\n\ninterface EvaluatorProps {\n  className : string\n  isExercise : boolean\n  state : UntypedLambdaState\n  breakpoints : Array<Breakpoint>\n  history : Array<StepRecord>\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n  isNormalForm : boolean\n\n  createBoxFrom (stepRecord : StepRecord) : UntypedLambdaState\n  setBoxState (state : UntypedLambdaState) : void\n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n  addBox (box : UntypedLambdaState) : void\n}\n\nexport default class Expression extends PureComponent<EvaluatorProps> {\n  constructor (props : EvaluatorProps) {\n    super(props)\n\n    this.addBreakpoint = this.addBreakpoint.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { className, isExercise, state, editor } = this.props\n\n    const {\n      placeholder,\n      content,\n      caretPosition,\n      syntaxError,\n    } = editor\n\n    return (\n      <div className={ className }>\n        <ul className='UL'>\n          {\n            mapLeftFromTo(0, this.props.history.length - 2, this.props.history, (stepRecord : StepRecord, i : Number) =>\n              <li key={ i.toString() } className='inactiveStep LI' >\n                <Step\n                  breakpoints={ this.props.breakpoints }\n                  addBreakpoint={ () => {} }\n                  stepRecord={ stepRecord }\n                  lastStep={ false }\n                >\n                  <i\n                    className=\"hiddenIcon fas fa-pencil-alt\"\n                    title='Copy this to new box'\n                    onClick={ () => this.props.addBox(this.props.createBoxFrom(stepRecord)) }\n                  />\n                </Step>\n              </li>)\n          }\n          <li key={this.props.history.length - 1} className='activeStep LI'>\n            <Step\n              breakpoints={ this.props.breakpoints }\n              addBreakpoint={ this.addBreakpoint }\n              stepRecord={ this.props.history[this.props.history.length - 1] }\n              lastStep={ true }\n            >\n                <i\n                  className=\"hiddenIcon fas fa-pencil-alt\"\n                  title='Copy this to new box'\n                  onClick={ () => this.props.addBox(this.props.createBoxFrom(this.props.history[this.props.history.length - 1])) }\n                />\n            </Step>\n          </li>\n        </ul>\n        {\n          this.props.isNormalForm ?\n          null\n            :\n          <Editor\n            placeholder={ placeholder } // data\n            content={ content } // data\n            caretPosition={ caretPosition } // data\n            syntaxError={ syntaxError } // data\n            submitOnEnter={ true } // data\n\n            onContent={ this.props.onContent } // fn\n            onEnter={ this.props.onEnter } // fn // tohle asi bude potreba\n            onExecute={ this.props.onExecute } // fn // tohle asi bude potreba\n          />\n        }\n      </div>\n    )\n  }\n\n  addBreakpoint (breakpoint : Breakpoint) : void {\n    let { state, setBoxState } = this.props\n  \n    setBoxState({\n      ...state,\n      breakpoints : [ ...state.breakpoints, breakpoint ],\n    })\n  }\n}","import React, { PureComponent, ReactNode } from 'react'\n\nimport {\n  AST,\n  ASTReduction,\n  None,\n  NormalEvaluator,\n  Beta,\n  Lambda,\n  Variable,\n  Expansion,\n  ChurchNumeral,\n  Macro,\n  Token,\n  tokenize,\n  parse,\n  ApplicativeEvaluator,\n  OptimizeEvaluator,\n  MacroMap,\n  NormalAbstractionEvaluator,\n} from \"@lambdulus/core\"\n\nimport './styles/EvaluatorBox.css'\n\nimport { BoxType, BoxState } from '../Types'\n\nimport { TreeComparator } from './TreeComparator'\nimport EmptyEvaluator from './EmptyExpression'\nimport InactiveEvaluator from './InactiveExpression'\nimport Expression from './Expression'\nimport { EvaluationStrategy, PromptPlaceholder, UntypedLambdaState, Evaluator, StepRecord, Breakpoint } from './AppTypes'\nimport { reportEvent } from '../misc'\n\n\nexport function strategyToEvaluator (strategy : EvaluationStrategy) : Evaluator {\n  switch (strategy) {\n    case EvaluationStrategy.NORMAL:\n      return NormalEvaluator as any\n \n    case EvaluationStrategy.APPLICATIVE:\n      return ApplicativeEvaluator as any\n\n    case EvaluationStrategy.OPTIMISATION:\n      return OptimizeEvaluator as any\n\n    case EvaluationStrategy.ABSTRACTION:\n      return NormalAbstractionEvaluator as any\n  }\n}\n\nexport interface EvaluationProperties {\n  state : UntypedLambdaState\n  isActive : boolean\n  isFocused : boolean\n  // macroTable : MacroMap\n\n  setBoxState (state : UntypedLambdaState) : void\n  addBox (box : BoxState) : void\n}\n\nexport default class ExpressionBox extends PureComponent<EvaluationProperties> {\n  constructor (props : EvaluationProperties) {\n    super(props)\n\n    this.onContent = this.onContent.bind(this)\n    this.onSubmitExpression = this.onSubmitExpression.bind(this)\n    this.parseExpression = this.parseExpression.bind(this)\n    this.onEnter = this.onEnter.bind(this)\n    this.onExerciseStep = this.onExerciseStep.bind(this)\n    this.onStep = this.onStep.bind(this)\n    this.onExecute = this.onExecute.bind(this)\n    this.onRun = this.onRun.bind(this)\n    this.onStop = this.onStop.bind(this)\n    this.shouldBreak = this.shouldBreak.bind(this)\n    this.createBoxFrom = this.createBoxFrom.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { state, isActive, addBox } : EvaluationProperties = this.props\n    const {\n      history,\n      breakpoints,\n      isExercise,\n      strategy,\n      expression,\n      editor,\n    } : UntypedLambdaState = state\n\n    let className : string = 'box boxEval'\n    const { isNormalForm } = history.length ? history[history.length - 1] : { isNormalForm : false }\n\n    if (expression === '') {\n      return (\n        <EmptyEvaluator\n          className={ className }\n          isActive={ this.props.isActive }\n          editor={ editor }\n          history={ history }\n\n          onContent={ this.onContent }\n          onEnter={ this.onEnter }\n          onExecute={ this.onExecute }\n        />\n      )\n    }\n\n    if (isExercise) {\n      className += ' boxExercise'\n    }\n\n    // TODO: Maybe I will take this out\n    // Frontend may take care of that\n    if ( ! isActive) {\n      return (\n        <InactiveEvaluator\n          className={ className }\n          breakpoints={ breakpoints }\n          history={ history }\n          \n          createBoxFrom={ this.createBoxFrom }\n        />\n      )\n    }\n\n    return (\n      <Expression\n        className={ className }\n        isExercise={ isExercise }\n        state={ state }\n        breakpoints={ breakpoints }\n        history={ history }\n        editor={ editor }\n        isNormalForm={ isNormalForm }\n\n        createBoxFrom={ this.createBoxFrom }\n        setBoxState={ this.props.setBoxState }\n        onContent={ this.onContent }\n        onEnter={ this.onEnter }\n        onExecute={ this.onExecute }\n        addBox={ addBox }\n      />\n    )\n  }\n\n  createBoxFrom (stepRecord : StepRecord) : UntypedLambdaState {\n    const { state } : EvaluationProperties = this.props\n    const {\n      strategy,\n      SLI,\n      expandStandalones,\n    } : UntypedLambdaState = state\n    const { ast } = stepRecord\n    const content = ast.toString()\n\n    return {\n      type : BoxType.UNTYPED_LAMBDA,\n      __key : Date.now().toString(),\n      title : \"\",\n      expression : \"\",\n      ast : null,\n      history : [],\n      isRunning : false,\n      breakpoints : [],\n      timeoutID : undefined,\n      timeout : 10,\n      isExercise : false,\n      strategy,\n      SLI,\n      expandStandalones,\n      editor : {\n        placeholder : PromptPlaceholder.EVAL_MODE,\n        content,\n        caretPosition : content.length,\n        syntaxError : null,\n      }\n    }\n  }\n\n  onContent (content : string, caretPosition : number) : void {\n    const { state, setBoxState } = this.props\n\n    setBoxState({\n      ...state,\n      editor : {\n        ...state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n  }\n\n  onEnter () : void {\n    const { expression, isExercise, editor : { content } } = this.props.state\n\n    if (expression === '') {\n      this.onSubmitExpression()\n    }\n    else if (content !== '' && isExercise) {\n      this.onExerciseStep()\n    }\n    else if (content === '' && (! isExercise)) {\n      this.onStep()\n    }\n    else {\n      console.log('Error: Something unexpected just happened. A')\n    }\n  }\n\n  onSubmitExpression () : void {\n    const { state, setBoxState } = this.props\n    const {\n      editor : { content },\n    } = state\n\n    try {\n      const ast : AST = this.parseExpression(content)\n\n      setBoxState({\n        ...state,\n        ast,\n        expression : content,\n        history : [ {\n          ast : ast.clone(),\n          lastReduction : new None,\n          step : 0,\n          message : '',\n          isNormalForm : false\n        } ],\n        editor : {\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.EVAL_MODE,\n          syntaxError : null,\n        }\n      })\n\n      reportEvent('Submit Expression', 'submit valid', content)\n    } catch (exception) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : exception.toString(),\n        }\n      })\n\n      reportEvent('Submit Expression', 'submit invalid', content)\n    }\n  }\n\n  onExerciseStep () {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    \n    try {\n      const userAst : AST = this.parseExpression(content)\n      const stepRecord : StepRecord = history[history.length - 1]\n      const { isNormalForm, step } = stepRecord\n      let { ast, lastReduction } = stepRecord\n      ast = ast.clone()\n\n      if (isNormalForm) {\n        // TODO: do something about it\n        // say user - there are no more steps and it is in normal form        \n        // TODO: consider immutability\n        stepRecord.message = 'No more steps available. Expression is in normal form.'\n\n        setBoxState({\n          ...state,\n        })\n\n        reportEvent('Exercise Step', 'Step Already in normal form', content)\n\n        return\n      }\n    \n      const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n      lastReduction = normal.nextReduction\n    \n      if (normal.nextReduction instanceof None) {\n        // TODO: refactor PLS - update history\n        // TODO: say user it is in normal form and they are mistaken\n        stepRecord.isNormalForm = true\n        stepRecord.message = 'Expression is already in normal form.'\n        \n        setBoxState({\n          ...state,\n        })\n\n        reportEvent('Exercise Step', 'Step Already in Normal Form', content)\n        \n        return\n      }\n    \n      ast = normal.perform()\n    \n      let message : string = ''\n      const comparator : TreeComparator = new TreeComparator([ userAst, ast ])\n\n      if (comparator.equals) {\n        ast = userAst\n        message = 'Correct.'\n\n        reportEvent('Exercise Step', 'Valid Step', content)\n      }\n      else {\n        // TODO: say user it was incorrect\n        // TODO: na to se pouzije uvnitr EvaluatorState prop messages nebo tak neco\n        // console.log('Incorrect step')\n        message = `Incorrect step. ${content}`\n\n        reportEvent('Exercise Step', 'Invalid Step', content)\n      }\n\n      setBoxState({\n        ...state,\n        history : [ ...history, { ast, lastReduction, step : step + 1, message, isNormalForm : false } ],\n        editor : {\n          ...state.editor,\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.VALIDATE_MODE,\n          syntaxError : null,\n        }\n      })\n    } catch (exception) {\n      // TODO: print syntax error\n      // TODO: do it localy - no missuse of onSubmit\n\n      // TODO: print syntax error\n\n      reportEvent('Exercise Step', 'Syntax error in Step', content)\n    }\n  }\n\n  onStep () : void {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    const stepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { ast, lastReduction } = stepRecord\n    ast = ast.clone()\n  \n    if (isNormalForm) {\n      return\n    }\n\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n  \n    if (normal.nextReduction instanceof None) {\n      stepRecord.isNormalForm = true\n      stepRecord.message = 'Expression is in normal form.'\n      \n      setBoxState({\n        ...state,\n      })\n      \n      reportEvent('Evaluation Step', 'Step Normal Form Reached', ast.toString())\n\n      return\n    }\n  \n    ast = normal.perform()\n\n    if (ast instanceof Macro || ast instanceof ChurchNumeral) {\n      stepRecord.isNormalForm = true\n      stepRecord.message = 'Expression is in normal form.'\n\n      reportEvent('Evaluation Step', 'Step Normal Form Reached with Number or Macro', ast.toString())\n    }\n  \n    setBoxState({\n      ...state,\n      history : [ ...history, { ast, lastReduction, step : step + 1, message : '', isNormalForm : false } ],\n\n    })\n\n    reportEvent('Evaluation Step', 'Step', ast.toString())\n  }\n\n  onExecute () : void {\n    const { state, setBoxState } = this.props\n    const { isRunning, isExercise } = state\n\n    if (isExercise) {\n      // TODO: exercises can not be run - some message to user???\n      return\n    }\n\n    if (isRunning) {\n      this.onStop()\n    }\n    else {\n      const { timeout, history } = state\n      const stepRecord = history[history.length - 1]\n  \n      if (stepRecord.isNormalForm) {\n        return\n      }\n      \n      const { ast, step, lastReduction, isNormalForm, message } = stepRecord\n      history.push(history[history.length - 1])\n      history[history.length - 2] = { ast : ast.clone(), step, lastReduction, message : 'Skipping some steps...', isNormalForm }\n\n      setBoxState({\n        ...state,\n        isRunning : true,\n        timeoutID : window.setTimeout(this.onRun, timeout),\n      })\n\n      reportEvent('Execution', 'Run Evaluation', ast.toString())\n    }\n  }\n\n  onRun () : void {\n    const { state, setBoxState } = this.props\n    const { strategy } = state\n    let { history, isRunning, breakpoints, timeoutID, timeout } = state\n    const stepRecord : StepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { lastReduction } = stepRecord\n\n    if ( ! isRunning) {\n      return\n    }\n    \n    if (isNormalForm) {\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    let { ast } = stepRecord\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n    \n    if (normal.nextReduction instanceof None) {\n      // TODO: consider immutability\n      history.pop()\n      history.push({\n        ast,\n        lastReduction : stepRecord.lastReduction,\n        step,\n        message : 'Expression is in normal form.',\n        isNormalForm : true\n      })\n  \n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    // TODO: maybe refactor a little\n    const breakpoint : Breakpoint | undefined = breakpoints.find(\n      (breakpoint : Breakpoint) =>\n        this.shouldBreak(breakpoint, normal.nextReduction)\n    )\n\n    if (breakpoint !== undefined) {\n      // TODO: consider immutability\n      if (normal.nextReduction instanceof Expansion) {\n        breakpoint.broken.add(normal.nextReduction.target)\n      }\n      if (normal.nextReduction instanceof Beta && normal.nextReduction.redex.left instanceof Lambda) {\n        breakpoint.broken.add(normal.nextReduction.redex.left.argument)\n      }\n\n      window.clearTimeout(timeoutID)\n      reportEvent('Evaluation Run Ended', 'Breakpoint was reached', ast.toString())\n\n\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID,\n      })\n\n      return\n    }\n  \n    ast = normal.perform()\n\n    history[history.length - 1] = { ast, lastReduction, step : step + 1, message : '', isNormalForm }\n\n    if (ast instanceof Macro || ast instanceof ChurchNumeral) {\n      history[history.length - 1] = { ast, lastReduction, step : step + 1, message : 'Expression is in normal form.', isNormalForm : true }\n\n      reportEvent('Evaluation Run Ended', 'Step Normal Form Reached with Number or Macro', ast.toString())\n    }\n    \n    setBoxState({\n      ...state,\n      timeoutID : window.setTimeout(this.onRun, timeout)\n    })\n  }\n\n  onStop () : void {\n    const { state, setBoxState } = this.props\n    const { timeoutID } = state\n  \n    window.clearTimeout(timeoutID)\n  \n    setBoxState({\n      ...state,\n      isRunning : false,\n      timeoutID : undefined\n    })\n  }\n\n  // TODO: breakpointy se pak jeste musi predelat\n  shouldBreak (breakpoint : Breakpoint, reduction : ASTReduction) : boolean {\n    // if (reduction.type === breakpoint.type\n    //     && reduction instanceof Beta && breakpoint.context instanceof Lambda\n    //     && reduction.target.identifier === breakpoint.context.body.identifier\n    //   ) {\n    //     return true\n    // }\n    if (reduction.type === breakpoint.type\n        && reduction instanceof Beta && breakpoint.context instanceof Variable\n        && reduction.redex.left instanceof Lambda\n        && reduction.redex.left.argument.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.redex.left.argument)\n    ) {\n      return true\n    }\n\n    if (reduction.type === breakpoint.type\n        && reduction instanceof Expansion && breakpoint.context instanceof ChurchNumeral\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n    if (reduction.type === breakpoint.type\n        && reduction instanceof Expansion && breakpoint.context instanceof Macro\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n  \n    return false\n  }\n\n  // THROWS Exceptions\n  parseExpression (expression : string) : AST {\n    // const { macroTable } = this.props\n\n    const { SLI : singleLetterVars } = this.props.state\n\n    const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n    const ast : AST = parse(tokens, {}) // macroTable\n\n    return ast\n  }\n}","import React from 'react'\n\nimport 'github-markdown-css'\nimport { NoteState } from './AppTypes'\nimport Editor from '../components/Editor'\nconst ReactMarkdown = require('react-markdown')\n\nexport interface NoteProperties {\n  state : NoteState\n  isActive : boolean\n  isFocused : boolean\n\n  setBoxState (state : NoteState) : void\n}\n\nexport default function Note (props : NoteProperties) : JSX.Element {\n  const {\n    state : {\n      note,\n      editor : { placeholder, content, caretPosition, syntaxError },\n      isEditing,\n    },\n    isActive,\n    isFocused,\n    setBoxState,\n  } = props\n  \n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      note : content,\n      editor : {\n        ...props.state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n    // this.updateURL(expression) // tohle musim nejak vyresit - mozna ta metoda setBoxState v APP bude checkovat propisovat do URL\n  }\n\n    if (isFocused) {\n    return (\n      <div className='box boxNoteEditor'>\n        <Editor\n          placeholder={ placeholder } // data\n          content={ content } // data\n          caretPosition={ caretPosition } // data\n          syntaxError={ syntaxError } // data\n          submitOnEnter={ false } // data\n          \n          onContent={ onContent } // fn\n          onEnter={ () => void 0 } // fn\n          onExecute={ () => {} } // fn\n          // onReset={ this.onClear } // fn not yet\n        />\n      </div>\n    )\n  }\n\n\n  return (\n    <div\n      onClick={ () => \n        isActive &&\n        setBoxState({\n        ...props.state,\n        isEditing : true,\n      }) }\n      className='box boxNote'\n    >\n      <ReactMarkdown className='markdown-body' source={ note } />\n    </div>\n  )\n}","import React, { useContext, ReactNode } from 'react'\n\n// import Evaluator from './ExpressionBox'\n// import MacroDefinition from './MacroDefinition'\n// import Note from './Note'\n// import { MacroTableContext } from './EvaluatorSpace'\n// import { SetBoxContext } from './BoxSpace'\nimport { BoxType, BoxState } from '../Types'\n\nimport { UntypedLambdaState } from '../untyped-lambda-integration/AppTypes'\n\nimport EvaluatorIntegration from '../untyped-lambda-integration/ExpressionBox'\n\nimport { NoteState } from '../markdown-integration/AppTypes'\nimport Note from '../markdown-integration/Note'\n\n// import { BoxState } from '../AppTypes'\n\ninterface BoxProperties {\n  state : BoxState\n  isActive : boolean\n  isFocused : boolean\n\n  updateBoxState (box : BoxState) : void\n  addBox (box : BoxState) : void\n}\n\nexport default function Box (props : BoxProperties) : JSX.Element {\n  const { state, isActive, isFocused, updateBoxState, addBox } : BoxProperties = props\n  const { type } = state\n\n  // const macroTable = useContext(MacroTableContext)\n  // const setBoxState = useContext(SetBoxContext)\n\n\n  if (type === BoxType.UNTYPED_LAMBDA) {\n    return (\n      <EvaluatorIntegration\n        state={ state as UntypedLambdaState }\n        isActive={ isActive }\n        isFocused={ isFocused }\n        // macroTable={ macroTable }\n        \n        setBoxState={ updateBoxState }\n        addBox={ addBox }\n      />\n    )\n  }\n  if (type === BoxType.MARKDOWN) {\n    return (\n      <Note\n        state={ state as NoteState }\n        isActive={ isActive }\n        isFocused={ isFocused }\n\n        setBoxState={ updateBoxState }\n      />\n    )\n  }\n  else {\n    return (\n      <div>\n        Uknown BOX\n      </div>\n    )\n  }\n\n  // if (type === BoxType.MACRO) {\n  //   return (\n  //     <div className=''>\n  //       <MacroDefinition\n  //         state={ state as MacroDefinitionState }\n  //         setBoxState={ setBoxState }\n\n  //         // addBox={ addBox }\n  //       />\n  //     </div>\n  //   )\n  // }\n\n  // if (type === BoxType.MARKDOWN) {\n  //   return (\n  //     <div className=''>\n  //       <Note\n  //         state={ state as NoteState }\n  //         isActive={ isActive }\n\n  //         // addBox={ addBox }\n  //       />\n  //     </div>\n  //   )\n  // }\n\n  // return null as any // never happens\n}","import React, { ChangeEvent } from 'react'\n\nimport 'pretty-checkbox'\nimport './styles/ExerciseSwitch.css'\n\nconst { Switch } = require('pretty-checkbox-react')\n\n\nexport interface ControlsProps {\n  isExercise : boolean\n  makeExercise () : void\n  endExercise () : void\n}\n\n// TODO: maybe not really needed or rename it accordingly\nexport default function ExerciseSwitch (props : ControlsProps) : JSX.Element {\n  const {\n    isExercise,\n    makeExercise,\n    endExercise,\n  } : ControlsProps = props\n\n  return (\n    <div className=\"controls\">\n      <div title='Write the next step yourself'>\n        <Switch\n          className='control'\n          checked={ isExercise }\n          onChange={ (e : ChangeEvent<HTMLInputElement>) =>\n            e.target.checked ? makeExercise() : endExercise()\n          }\n          shape=\"fill\"\n        >\n          Exercise\n        </Switch>\n      </div>\n    </div>\n  )\n}","import React, { Component, MouseEvent } from 'react'\n\nimport Controls from './ExerciseSwitch'\nimport { UntypedLambdaState, PromptPlaceholder } from './AppTypes'\nimport { BoxState } from '../Types'\n\n\ninterface Props {\n  state : UntypedLambdaState\n  isActive : boolean\n  removeBox : (e : MouseEvent) => void\n  updateBoxState : (box : BoxState) => void\n}\n\n\nexport default function BoxTopBar (props : Props) : JSX.Element {\n  const { state, isActive, removeBox, updateBoxState } = props\n  const { isExercise, editor, expression, title } = state\n\n  return (\n    <div className='boxTopBar'>\n      {/* <div className='topBarTitle' contentEditable={ true } onBlur={ (e) => updateBoxState({ ...state, title : e.target.textContent || \"\" }) }>\n        { title === \"\" ? \"Click Here to Change the Title\" : title }\n      </div> */}\n      {\n        expression === '' ?\n          null\n        :\n        <Controls\n          isExercise={ isExercise }\n          makeExercise={ () =>\n            updateBoxState({\n              ...state,\n              isExercise : true,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.VALIDATE_MODE,\n              },\n            })\n          }\n          endExercise={ () =>\n            updateBoxState({\n              ...state,\n              isExercise : false,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.EVAL_MODE,\n              },\n            })\n          }\n        />\n      }\n\n      <i\n        className='removeBox far fa-trash-alt'\n        onClick={ removeBox }\n        title='Remove this Box'\n      />\n    </div>\n  )\n}","import React, { Component, ChangeEvent, MouseEvent } from 'react'\n\nimport { NoteState, PromptPlaceholder } from './AppTypes'\n\nimport 'pretty-checkbox'\nimport './styles/EditingSwitch.css'\nimport { BoxState } from '../Types'\n\nconst { Switch } = require('pretty-checkbox-react')\n\n\ninterface Props {\n  state : NoteState\n  isActive : boolean\n  removeBox : (e : MouseEvent) => void\n  updateBoxState : (box : BoxState) => void\n}\n\n\nexport default function BoxTopBar (props : Props) : JSX.Element {\n  const { state, isActive, removeBox, updateBoxState } = props\n  const { note, isEditing, title } = state\n\n  return (\n    <div className='boxTopBar'>\n      {/* <div className='topBarTitle' contentEditable={ true } onBlur={ (e) => updateBoxState({ ...state, title : e.target.textContent || \"\" }) }>\n        { title === \"\" ? \"Click Here to Change the Title\" : title }\n      </div> */}\n      {/* <div className='controls' title='Edit as Markdown'>\n        <Switch\n            className='control'\n            checked={ isEditing }\n            onChange={ (e : ChangeEvent<HTMLInputElement>) =>\n              updateBoxState({ ...state, isEditing : e.target.checked })\n            }\n            shape=\"fill\"\n          >\n            Editing\n          </Switch>\n      </div> */}\n\n      <i\n        className='removeBox far fa-trash-alt'\n        onClick={ removeBox }\n        title='Remove this Box'\n      />\n    </div>\n  )\n}","import React, { MouseEvent } from 'react'\nimport { BoxType, BoxState } from '../Types'\nimport UntypedLambdaBTB from '../untyped-lambda-integration/BoxTopBar'\nimport { UntypedLambdaState } from '../untyped-lambda-integration/AppTypes'\n\nimport MarkdownBTB from '../markdown-integration/BoxTopBar'\nimport { NoteState } from '../markdown-integration/AppTypes'\n\n\ninterface Props {\n  state : BoxState\n  isActive : boolean\n  isFocused : boolean\n  removeBox : (e : MouseEvent) => void\n  updateBoxState : (box : BoxState) => void\n}\n\n\nexport default function BoxTitleBar (props : Props) : JSX.Element {\n  const { state, isActive, updateBoxState, removeBox } : Props = props\n  const { type } = state\n\n\n  if (type === BoxType.UNTYPED_LAMBDA) {\n    return (\n      <UntypedLambdaBTB\n        state={ state as UntypedLambdaState }\n        isActive={ isActive }\n        removeBox={ removeBox }\n        updateBoxState={ updateBoxState }\n      />\n    )\n  }\n  if (type === BoxType.MARKDOWN) {\n    return (\n      <MarkdownBTB\n        state={ state as NoteState }\n        isActive={ isActive }\n        removeBox={ removeBox }\n        updateBoxState={ updateBoxState }\n      />\n    )\n  }\n  else {\n    return (\n      <div>\n        Uknown BOX\n      </div>\n    )\n  }\n\n}","import React, { MouseEvent } from 'react'\nimport { mapBoxTypeToStr } from '../AppTypes'\nimport Box from './Box'\nimport BoxTitleBar from './BoxTitleBar'\nimport { BoxState } from '../Types'\n\n\ninterface Props {\n  isActiveBox : boolean\n  isFocusedBox : boolean\n  box : BoxState\n\n  makeActive : () => void\n  onBlur : () => void\n  updateBoxState : (state : BoxState) => void\n  removeBox : () => void\n  insertBefore : (state : BoxState) => void\n}\n\nexport function BoxContainer (props : Props) : JSX.Element {\n  const { isActiveBox, isFocusedBox, box, makeActive, onBlur, updateBoxState, insertBefore, removeBox } : Props = props\n\n  const boxTypeClassName : string = mapBoxTypeToStr(box.type)\n\n  return (\n    <div\n      className={ `boxContainer ${ isActiveBox ? 'active' : 'inactive' } ${boxTypeClassName}` }\n      onClick={ makeActive }\n      onBlur={ onBlur }\n    >\n      <BoxTitleBar\n        state={ box }\n        isActive={ isActiveBox }\n        isFocused={ isFocusedBox }\n        removeBox={ (e : MouseEvent) => {\n          e.stopPropagation()\n          removeBox()\n         } }\n        updateBoxState={ (box : BoxState) => updateBoxState(box) }\n      />\n      <Box\n        state={ box }\n        isActive={ isActiveBox }\n        isFocused={ isFocusedBox }\n        updateBoxState={ (box : BoxState) => updateBoxState(box) }\n        addBox={ (box : BoxState) => insertBefore(box) }\n      />\n    </div>\n  )\n}","// This component needs to be able to specify which Boxes are allowed inside\n// It will also have other settings - maybe something like lock - if it's locked, you can not modify it\n// Exam mode will feature the build of the Frontend which will not import any of the Evaluation Boxes\n\n\nimport React, { PureComponent } from 'react'\nimport { CreateBox } from '../components/CreateBox'\nimport { BoxType, NotebookState, GlobalSettings, BoxState } from '../Types'\n\nimport { onMarkDownBlur, NoteState } from '../markdown-integration/AppTypes'\nimport { BoxContainer } from '../components/BoxContainer'\n\ninterface Props {\n  state : NotebookState\n  settings : GlobalSettings\n\n  updateNotebook (notebook : NotebookState) : void\n}\n\nexport default class Notebook extends PureComponent<Props> {\n  constructor (props : Props) {\n    super(props)\n\n    this.insertBefore = this.insertBefore.bind(this)\n    this.removeBox = this.removeBox.bind(this)\n    this.updateBoxState = this.updateBoxState.bind(this)\n    this.makeActive = this.makeActive.bind(this)\n    this.onBlur = this.onBlur.bind(this)\n  }\n\n  render () {\n    const { state, settings } = this.props\n    const { activeBoxIndex, focusedBoxIndex, boxList, allowedBoxes } = state\n\n    return (\n      <div className=\"mainSpace\">\n        <div className='importExportSpace'>\n          <div className='portContainer'>\n            {/* TODO: SOLVE WHERE TO MOVE IMPORT/EXPORT */}\n            <div\n              className='exportButton'\n              title='Download this notebook'>\n              <a\n                className='export'\n                // href={ link }\n                download=\"notebook_lambdulus.json\"\n                // onClick={ () => setTimeout(() => {\n                //   window.URL.revokeObjectURL(link)\n                //   reportEvent('Export notebook', `Notebook: ${serialized}`, '')\n                // }, 10) }\n              >\n                <i id='download' className=\"icon dark fas fa-cloud-download-alt\" />\n              </a>\n              <p className='iconLabel'>Export</p>\n            </div>\n            \n            <div\n              className='importButton'\n              title='Open exported notebook'>\n              <input type=\"file\" accept=\"application/json\" id=\"input\"\n              // onChange={ (e) => onFiles(e, onImport) }\n              />\n              <label htmlFor=\"input\"><i className=\"icon dark fas fa-cloud-upload-alt\"></i></label>\n              <p className='iconLabel'>Import</p>\n            </div>\n          </div>\n        </div>\n\n\n        {/* TODO: This will be refactore out to standalone component. */}\n        <ul className=\"boxList UL\">\n          { boxList.map(\n            (box : BoxState, i : number) =>\n            <li className=\"LI\" key={ box.__key }>\n              \n              <CreateBox\n                addNew={ (box : BoxState) => this.insertBefore(i, box) }\n                whiteList={ allowedBoxes }\n                settings={ settings }\n              />\n              \n              <BoxContainer\n                box={ box}\n                isActiveBox={ activeBoxIndex === i}\n                isFocusedBox={ focusedBoxIndex === i }\n                insertBefore={ (box : BoxState) => this.insertBefore(i, box) }\n                makeActive={ () => this.makeActive(i) }\n                removeBox={ () => this.removeBox(i) }\n                updateBoxState={ (box : BoxState) => this.updateBoxState(i, box) }\n                onBlur={ () => this.onBlur(i) }\n              />          \n            </li>\n          ) }\n  \n          <CreateBox\n            addNew={ (box : BoxState) => this.insertBefore(state.boxList.length, box) }\n            whiteList={ allowedBoxes }\n            settings={ settings }\n          />\n  \n        </ul>\n      </div>\n    )\n  }\n\n  insertBefore (index : number, box : BoxState) : void {\n    console.log(\"              INSERT BEFORE \" + index)\n    const { boxList } = this.props.state\n\n    boxList.splice(index, 0, box)\n    this.props.updateNotebook({ ...this.props.state, boxList : boxList, activeBoxIndex : index, focusedBoxIndex : index })\n  }\n\n  removeBox (index : number) : void {\n    const { boxList, activeBoxIndex } = this.props.state\n    \n    const nearestValidIndex = (i : number) => {\n      if (i < activeBoxIndex) return activeBoxIndex - 1\n      if (i > activeBoxIndex) return activeBoxIndex\n      if (boxList.length === 1) return NaN\n      if (i === 0) return i\n      return i - 1\n    }\n\n    const newIndex : number = nearestValidIndex(index)\n\n    boxList.splice(index, 1)\n    this.props.updateNotebook({ ...this.props.state, boxList : boxList, activeBoxIndex : newIndex })\n  }\n\n  /**\n   * This function is patching; not overriding\n   * @param index \n   * @param box \n   */\n  updateBoxState (index : number, box : BoxState) : void {\n    const { boxList } = this.props.state\n    boxList[index] = box\n\n    this.props.updateNotebook({ ...this.props.state, boxList })\n  }\n\n  makeActive (index : number) : void {\n    console.log(\"               MAKE ACTIVE \" + index)\n    const { activeBoxIndex, focusedBoxIndex, boxList } = this.props.state\n\n    const currentType : BoxType = boxList[activeBoxIndex].type\n\n    switch (currentType) {\n      case BoxType.UNTYPED_LAMBDA:\n        // boxList[activeBoxIndex] = onUntypedLambdaBlur(boxList[activeBoxIndex])\n        break\n      \n      case BoxType.MARKDOWN: {\n        boxList[activeBoxIndex] = onMarkDownBlur(boxList[activeBoxIndex] as NoteState)\n        break\n      }\n\n      default:\n        break\n    }\n\n    if (index !== activeBoxIndex || index !== focusedBoxIndex) {\n      this.props.updateNotebook({ ...this.props.state, activeBoxIndex : index, focusedBoxIndex : index, boxList })\n    }\n  }\n\n  onBlur (index : number) : void {\n    console.log(\"                  BLUR \" + index)\n    const { boxList, activeBoxIndex } = this.props.state\n\n    if (activeBoxIndex !== index) {\n      return\n    }\n\n    const currentType : BoxType = boxList[index].type\n\n    switch (currentType) {\n      case BoxType.UNTYPED_LAMBDA:\n        // boxList[activeBoxIndex] = onUntypedLambdaBlur(boxList[activeBoxIndex])\n        break\n      \n      case BoxType.MARKDOWN: {\n        boxList[index] = onMarkDownBlur(boxList[index] as NoteState)\n        break\n      }\n\n      default:\n        break\n    }\n\n    this.props.updateNotebook({ ...this.props.state, boxList, focusedBoxIndex : undefined })\n  }\n}","import React from 'react'\nimport 'github-markdown-css'\n\nimport guide from '../misc/UserGuide'\nconst ReactMarkdown = require('react-markdown')\n\nexport default function Help (props : {}) : JSX.Element {\n  return (\n  <div className='helpSpace'>\n    <ReactMarkdown className='markdown-body' source={ guide } />    \n  </div>)\n}","export default `# User guide\n\n## Typing expressions\n#### To write lambda expression you simply type in the prompt.\n\n## Typing λ symbol\n#### If you want to write \\`λ\\` symbol you simply type \\`\\\\\\` and Lambdulus will take care of the rest.\n\n## Multiple expressions\n#### You can also have many submitted expressions. To submit another expression you need to open new empty \\`expression box\\` by clicking on the \\`λ\\` inside the \\`+λ +Macro +MD\\` panel at the end of the notebook.\n\n## Single Letter Names (SLI)\n#### You can write lambda functions and omit whitespaces such as \\`(λabc.cba) 2 1 +\\`. To do that you have to check switch \\`Single Letter Names\\` at the top of the page.\n\n## Evaluation Strategies\n#### We have option to select from 3 evaluation strategies. The \\`Simplified\\` strategy is specific evaluation order which evaluates built-in macros atomicaly. The \\`Normal\\` and the \\`Applicative\\` strategies are sort of self describing.\n\n## Macros\n#### If you want to define your own macro - you can. You must first create empty \\`macro box\\` by clicking on the \\`+Macro\\` inside the \\`+λ +Macro +MD\\` panel at the end of the notebook. Then you write macro name followed by symbol \\`:=\\` and then valid lambda expression.\n\n## Macro Definition\n#### Inside the macro definition you can reference any valid macro which is already defined or will be defined in the future. Yes you can reference macro you are just defining inside it's own definition - whether you should or not is up to you.\n\n## List All Macros\n#### If you want to list all defined macros - built-ins and also your macros - you simply click on the \\`Macro\\` icon at the top or on the left of the page.\n\n## Remove User Macro\n#### To remove user macros - \\`because you can not remove built-ins\\` - first show all macros and then hover your mouse over the macro you want to remove and click the \\`trash bin\\` icon.\n\n## Redefine User Macro\n#### To redefine user macro - \\`because you can not redefine built-ins\\` - just create new empty \\`macro box\\` and define the already existing macro again - this time with different macro definition.\n\n## Report a Bug or Request New Features\n#### If you want to report a bug or you need some feature - click on the \\`Issues\\` button on the left or at the top of the page. Then fill in the issue on the GitHub page of the project. Definitely don't forget to check if the corresponding issue already exist.\n`","import React, { ChangeEvent } from 'react'\nimport { UntypedLambdaSettings, EvaluationStrategy } from './AppTypes'\n\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\n\ninterface Props {\n  settings : UntypedLambdaSettings\n  change : (settings : UntypedLambdaSettings) => void\n}\n\nexport default function Settings (props : Props) : JSX.Element {\n  const { settings, change } : Props = props\n  const { SLI, expandStandalones, strategy } : UntypedLambdaSettings = settings\n\n  return (\n    <div className='untypedLambdaSettings'>\n      <h3>Untyped Lambda Calculus</h3>\n\n\n      <span title='Letters as names without spaces'>\n        <Switch\n          checked={ SLI }\n          disabled={ false } // TODO: tohle bude rozhodne chtit prepsat\n          shape=\"fill\"\n          \n          onChange={\n             (e : ChangeEvent<HTMLInputElement>) => // tady nejakej destructuring\n              change({ ...settings, SLI : e.target.checked })\n          }\n        >\n          Single Letter Names\n        </Switch>\n      </span>\n\n      <br></br>\n      <br></br>\n\n      <span title='Expand stand-alones'>\n        <Switch\n          checked={ expandStandalones }\n          disabled={ false } // TODO: tohle bude rozhodne chtit prepsat\n          shape=\"fill\"\n          \n          onChange={\n            (e : ChangeEvent<HTMLInputElement>) => // tady nejakej destructuring\n              change({ ...settings, expandStandalones : e.target.checked })\n          }\n        >\n          Expand stand-alones\n        </Switch>\n      </span>\n\n      <br></br>\n      <br></br>\n\n      <div className='strategies inlineblock'>\n        <p className='stratsLabel inlineblock'>Evaluation Strategies:</p>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={\n            strategy === EvaluationStrategy.ABSTRACTION\n          }\n          \n          onChange={\n            () => change({ ...settings, strategy : EvaluationStrategy.ABSTRACTION })\n          }\n        >\n          Simplified\n        </Radio>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={\n            strategy === EvaluationStrategy.NORMAL\n          }\n          \n          onChange={\n            () => change({ ...settings, strategy : EvaluationStrategy.NORMAL })\n          }\n        >\n          Normal\n        </Radio>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={\n            strategy === EvaluationStrategy.APPLICATIVE\n          }\n          \n          onChange={\n            () => change({ ...settings, strategy : EvaluationStrategy.APPLICATIVE })\n          }\n        >\n          Applicative\n        </Radio>\n      </div>\n    </div>\n  )\n}","import React from 'react'\n\nimport UntypedLambdaCalculusSet from '../untyped-lambda-integration/Settings'\nimport { CODE_NAME as UNTYPED_CODE_NAME, UntypedLambdaSettings } from '../untyped-lambda-integration/AppTypes'\nimport { GlobalSettings } from '../Types'\n\n\ninterface Props {\n  settings : GlobalSettings\n  updateSettings : (settings : GlobalSettings) => void\n}\n\nexport default function SettingsScreen (props : Props) : JSX.Element {\n  const { settings, updateSettings } = props\n\n  const untypedSettings : UntypedLambdaSettings = settings[UNTYPED_CODE_NAME] as UntypedLambdaSettings\n\n  return (\n    <div className='settingsSpace'>\n      <UntypedLambdaCalculusSet\n        settings={ untypedSettings }\n        change={\n          (unTypLSet : UntypedLambdaSettings) =>\n            updateSettings({ ...settings, [UNTYPED_CODE_NAME] : unTypLSet })\n        }\n      />\n    </div>\n  )\n}","import React, { Component } from 'react'\n\nimport './App.css'\n\nimport { updateSettingsInStorage, loadAppStateFromStorage, updateAppStateToStorage } from './AppTypes'\n\nimport MenuBar from './components/MenuBar'\nimport Notebook from './screens/Notebook'\nimport Help from './screens/Help'\nimport SettingsScreen from './screens/Settings'\nimport { Screen, AppState, NotebookState, GlobalSettings } from './Types'\n\n\n\n/**\n * This is the main Application\n * in the future - when building Exam Mode - I will need to replace some part of the application components\n * if it's only some component at the top, it can be done easily\n * if it's gonna replace some deeper stuff I will need to implement some Namespace FROM which app and integrations\n * will inport parts and this Namespace will take care of that\n */\n\n\ninterface Props {}\nexport default class App extends Component<Props, AppState> {\n  constructor (props : Props) {\n    super(props)\n\n    this.state = loadAppStateFromStorage()\n\n    this.setScreen = this.setScreen.bind(this)\n    this.updateNotebook = this.updateNotebook.bind(this)\n    this.changeNotebook = this.changeNotebook.bind(this)\n    this.removeNotebook = this.removeNotebook.bind(this)\n    this.updateSettings = this.updateSettings.bind(this)\n\n    // TODO: implement Class Keyboard Controller -> handling all keyboard events and firing events -> invoking handlers from this class\n    // document.addEventListener('keydown', (event : KeyboardEvent) => {\n    //   console.log(event)\n    // })\n  }\n\n\n  render () {\n    const { notebookList, currentNotebook, currentScreen } = this.state\n    const state = notebookList[currentNotebook]\n    const { settings } = state\n\n    return (\n      <div id='app'>\n        <MenuBar\n          state={ this.state }\n          onScreenChange={ this.setScreen }\n          onImport={ () => void 0 }\n          onNotebookChange={ this.changeNotebook }\n          onAddNotebook={\n            (notebook : NotebookState) =>\n              this.setState(\n                { notebookList : [ ...this.state.notebookList, notebook ],\n                  currentNotebook : this.state.currentNotebook + 1\n                })\n          }\n          // TODO: there are gonna be all kinds of Notebooks - I need to take care of that\n          onSelectNotebook={ (index : number) => this.setState({ currentNotebook : index }) }\n          onDeleteNotebook={ (index : number) => this.removeNotebook(index) }\n        />\n        {\n          (() => {\n            if (currentScreen === Screen.MAIN)\n              return <Notebook state={ state } updateNotebook={ this.updateNotebook } settings={ settings } />\n            if (currentScreen === Screen.HELP)\n              return <Help/>\n            if (currentScreen === Screen.SETTINGS)\n              return <SettingsScreen settings={ settings } updateSettings={ this.updateSettings } />\n          })()\n        }\n        \n      </div>\n    )\n  }\n\n  setScreen (screen : Screen) : void {\n    this.setState({ currentScreen : screen })\n  }\n\n  updateNotebook (notebook : NotebookState) : void {\n    const { notebookList, currentNotebook } = this.state\n\n    notebookList[currentNotebook] = notebook\n\n    this.setState({ notebookList })\n    updateAppStateToStorage({ ...this.state })\n    // NOTE: Carefuly around here - I kinda rely on the mutation of this.state.notebookList\n  }\n\n  changeNotebook (index : number) : void {\n    this.setState({ currentNotebook : index })\n  }\n\n  removeNotebook (index : number) : void {\n    // if (index === 0) return\n\n    const { notebookList, currentNotebook } = this.state\n    \n    const nearestValidIndex = (i : number) => {\n      if (i < currentNotebook) return currentNotebook - 1\n      if (i > currentNotebook) return currentNotebook\n      if (notebookList.length === 1) return NaN\n      if (i === 0) return i\n      return i - 1\n    }\n    \n    const newIndex : number = nearestValidIndex(index)\n    \n    if (Number.isNaN(newIndex)) return\n\n    notebookList.splice(index, 1)\n    this.setState({ notebookList, currentNotebook : newIndex })\n  }\n\n  updateSettings (newSettings : GlobalSettings) : void {\n    const { currentNotebook, notebookList } = this.state\n    notebookList[currentNotebook].settings = newSettings\n\n    this.setState({ notebookList })\n    updateSettingsInStorage(newSettings)\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}