{"version":3,"sources":["Types.ts","untyped-lambda-integration/Types.ts","untyped-lambda-integration/AppTypes.ts","AppTypes.ts","components/MenuBar.tsx","markdown-integration/AppTypes.ts","components/CreateBox.tsx","components/Editor.tsx","untyped-lambda-integration/TreeComparator.ts","untyped-lambda-integration/EmptyExpression.tsx","misc/index.ts","untyped-lambda-integration/ReactPrinter.tsx","untyped-lambda-integration/ReductionMessage.tsx","untyped-lambda-integration/Step.tsx","untyped-lambda-integration/InactiveExpression.tsx","components/DebugControls.tsx","untyped-lambda-integration/Expression.tsx","untyped-lambda-integration/ExpressionBox.tsx","untyped-lambda-integration/Macro.tsx","untyped-lambda-integration/UntypedLambdaBox.tsx","markdown-integration/Note.tsx","empty-integration/index.tsx","components/Box.tsx","untyped-lambda-integration/BoxTopBar.tsx","markdown-integration/BoxTopBar.tsx","empty-integration/BoxTopBar.tsx","components/BoxTitleBar.tsx","components/BoxContainer.tsx","screens/Notebook.tsx","screens/Help.tsx","misc/UserGuide.ts","untyped-lambda-integration/Settings.tsx","screens/Settings.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["BoxType","Screen","PromptPlaceholder","UntypedLambdaType","EvaluationStrategy","CODE_NAME","defaultSettings","type","UNTYPED_LAMBDA","SLI","expandStandalones","strategy","NORMAL","createNewUntypedLambdaMacro","__key","Date","now","toString","title","minimized","menuOpen","settingsOpen","subtype","MACRO","expression","ast","macroName","macroExpression","editor","placeholder","content","caretPosition","syntaxError","decodeUntypedLambdaState","box","ORDINARY","untypedLambdaBox","decodedFirst","decodeUntypedLambdaFast","history","map","step","index","decodedNth","reduction","lastReduction","undefined","decodeUntypedLambdaExpression","EXERCISE","ALL_BOX_TYPES","LISP","MARKDOWN","EmptyAppState","notebookList","boxList","activeBoxIndex","NaN","focusedBoxIndex","allowedBoxes","settings","whitelist","UNTYPED_CODE_NAME","UntypedLambdaDefaultSettings","getDefaultSettings","name","editingName","persistent","currentNotebook","currentScreen","MAIN","loadSettingsFromStorage","serialized","window","localStorage","getItem","deserialized","JSON","parse","Object","entries","key","value","console","error","loadAppStateFromStorage","maybeState","setItem","stringify","decode","e","updateAppStateToStorage","state","notebook","arr","MenuBar","props","onImport","onClearWorkspace","onScreenChange","link","data","Blob","URL","createObjectURL","createURL","id","className","onClick","SETTINGS","href","download","setTimeout","revokeObjectURL","accept","onChange","event","files","target","file","reader","FileReader","onload","result","readAsText","onFiles","htmlFor","HELP","isAllowed","anyBoxAllowed","includes","ActionType","CreateBox","opened","onOpen","bind","this","addNew","whiteList","untLSettings","setState","isRunning","breakpoints","timeoutID","timeout","allowed","addLispBoxIfAllowed","note","isEditing","addMDBoxIfAllowed","Component","TreeComparator","roots","translator","Map","equals","context","compare","left","right","Lambda","backup","set","argument","Application","Macro","ChurchNumeral","Variable","has","get","Editor","submitOnEnter","shouldReplaceLambda","onContent","onEnter","onExecute","lines","split","length","replace","InputField","onKeyDown","shiftKey","ctrlKey","preventDefault","stopPropagation","onKeyDownCapture","height","language","theme","options","formatOnPaste","minimap","enabled","EmptyExpression","isActive","Math","max","reportEvent","category","action","label","ga","getAll","send","exception","ReactPrinter","tree","rendered","visit","lambda","accumulator","body","isBreakpoint","Alpha","Array","from","conversions","some","conversion","identifier","args","Symbol","ASTReductionType","BETA","broken","Set","printMultiLambda","node","application","leftClassName","rightClassName","redex","Beta","Gama","acc","churchNumber","Expansion","EXPANSION","macro","redexes","redexClass","variable","ASTVisitor","ReductionMessage","ALPHA","GAMA","StepMemo","memo","stepRecord","addBreakpoint","children","message","strategyToEvaluator","nextReduction","printer","incorrectStep","indexOf","correctStep","exerciseStep","print","substr","lastStep","StepWrapper","InactiveExpression","DebugControls","document","onkeydown","log","altKey","metaKey","onStep","onRun","runMessage","disabled","PureComponent","Expression","shouldShowDebugControls","to","sequence","fn","i","mapLeftFromTo","addBox","createBoxFrom","isNormalForm","breakpoint","setBoxState","NormalEvaluator","APPLICATIVE","ApplicativeEvaluator","OPTIMISATION","OptimizeEvaluator","ABSTRACTION","NormalAbstractionEvaluator","ExpressionBox","onSubmitExpression","parseExpression","onExerciseStep","onStop","shouldBreak","EVAL_MODE","clone","None","userAst","normal","perform","VALIDATE_MODE","push","pop","find","add","clearTimeout","singleLetterVars","tokens","tokenize","lambdaLetters","str","trim","builtinMacros","Error","singleLetterNames","isValidName","isValidExpression","macroBody","UntypedLambdaBox","exprState","macroState","ReactMarkdown","require","Note","isFocused","source","Empty","Box","updateBoxState","addBoxAfter","BoxTopBar","removeBox","Switch","EmptyTopBar","BoxTitleBar","addBoxBefore","contentEditable","onBlur","textContent","BoxContainer","isActiveBox","isFocusedBox","makeActive","boxTypeClassName","mapBoxTypeToStr","Notebook","insertBefore","insertAfter","createBoxFromURL","urlSearchParams","location","searchParams","boxState","splice","updateNotebook","newIndex","Help","Radio","Settings","change","checked","shape","style","SettingsScreen","updateSettings","untypedSettings","unTypLSet","App","setScreen","changeNotebook","addNotebook","removeNotebook","editNotebookName","changeNotebookName","stopEditingNotebook","importWorkspace","clearWorkspace","screen","createNewNotebook","Number","isNaN","newSettings","confirm","removeItem","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch"],"mappings":"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","file":"static/js/main.274a3b19.chunk.js","sourcesContent":["import { UntypedLambdaState, UntypedLambdaSettings } from \"./untyped-lambda-integration/Types\"\nimport { NoteState } from \"./markdown-integration/AppTypes\"\n\nexport enum BoxType {\n  UNTYPED_LAMBDA,\n  LISP,\n  MARKDOWN,\n}\n\nexport enum Screen {\n  MAIN,\n  HELP,\n  MACROLIST,\n  SETTINGS,\n  NOTEBOOKS, // TODO: this will be the final solution to the `Multiple Notebooks` problem\n}\n\nexport type AnyBox = -1\n\nexport type NoBox = -2\n\n// TODO: when building `Exam Mode`  allow only Array<BoxType> or NoBox\nexport type BoxesWhitelist = Array<BoxType> | AnyBox | NoBox\n\nexport interface AbstractBoxState {\n  type : BoxType,\n  __key : string, \n  title : String,\n  minimized : boolean,\n  menuOpen : boolean,\n  settingsOpen : boolean,\n}\n\nexport interface AbstractSettings {\n  type : BoxType,\n}\n\nexport interface LispBox extends AbstractBoxState {\n  // TODO: delete this placeholder and implement it\n}\n\nexport interface LispSettings extends AbstractSettings {\n  // TODO: delete this placeholder and implement it\n}\n\nexport type BoxState = UntypedLambdaState | LispBox | NoteState // or other things in the future\n\nexport type Settings = UntypedLambdaSettings | LispSettings // or other things in the future\n\n// TODO: this needs to be reconsidered\nexport interface GlobalSettings {\n  // [UNTYPED_CODE_NAME] : UntypedLambdaSettings\n  [key : string] : Settings\n}\n\nexport interface NotebookState {\n  boxList : Array<BoxState>\n  activeBoxIndex : number\n  focusedBoxIndex : number | undefined\n  allowedBoxes : BoxesWhitelist\n\n  settings : GlobalSettings // TODO: refactor to use the Dictionary\n\n  __key : string\n  name : string\n  editingName : boolean\n  persistent : boolean\n}\n\nexport interface AppState {\n  notebookList : Array<NotebookState>,\n  currentNotebook : number,\n  currentScreen : Screen,\n}\n\n\n// TODO: move to specific integration\nexport interface MacroDefinitionState {\n  __key : string\n  type : BoxType\n  macroName : string\n  macroExpression : string\n  singleLetterNames : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\n\n\n","import { AbstractSettings, BoxType, AbstractBoxState } from \"../Types\"\nimport { AST, ASTReduction, ASTReductionType, NormalEvaluator, ApplicativeEvaluator, OptimizeEvaluator } from \"@lambdulus/core\"\n\n\nexport enum PromptPlaceholder {\n  INIT = 'Type λ (as \\\\) expression and hit enter',\n  EVAL_MODE = 'Hit enter for next step',\n  VALIDATE_MODE = 'Write next step and hit enter for validation',\n  MACRO = 'Define Macro like: `NAME := [λ expression]` and hit enter',\n  NOTE = 'Type note and hit shift enter'\n}\n\nexport enum UntypedLambdaType {\n  ORDINARY,\n  EXERCISE,\n  MACRO,\n}\n\nexport type Breakpoint = {\n  type : ASTReductionType,\n  context : AST,\n  broken : Set<AST>,\n}\n\nexport interface StepRecord {\n  ast : AST\n  lastReduction : ASTReduction | null\n  step : number\n  message : string\n  isNormalForm : boolean\n}\n\nexport enum EvaluationStrategy {\n  NORMAL = 'Normal Evaluation',\n  APPLICATIVE = 'Applicative Evaluation',\n  OPTIMISATION = 'Optimisation - η Conversion',\n  ABSTRACTION = 'Abstraction / Simplified Evaluation'\n}\n\nexport type UntypedLambdaState = UntypedLambdaExpressionState | UntypedLambdaMacroState\n\n// TODO: consider abstract Untype Lambda State which will hold all common members\n\nexport interface UntypedLambdaExpressionState extends AbstractBoxState {\n  __key : string\n  type : BoxType\n\n  subtype : UntypedLambdaType\n  expression : string\n  ast : AST | null\n  history : Array<StepRecord>\n  isRunning : boolean\n  breakpoints : Array<Breakpoint>\n  timeoutID : number | undefined\n  timeout : number\n  // isExercise : boolean\n  \n  strategy : EvaluationStrategy\n  SLI : boolean\n  expandStandalones : boolean\n  \n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport interface UntypedLambdaMacroState extends AbstractBoxState {\n  __key : string\n  type : BoxType\n\n  subtype : UntypedLambdaType\n  expression : string\n  ast : AST | null\n  macroName : string\n  macroExpression : string\n  \n  SLI : boolean\n  expandStandalones : boolean\n  strategy : EvaluationStrategy\n\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport interface UntypedLambdaSettings extends AbstractSettings {\n  SLI : boolean\n  expandStandalones : boolean\n  strategy : EvaluationStrategy\n}\n\nexport type Evaluator = NormalEvaluator | ApplicativeEvaluator | OptimizeEvaluator\n","import { BoxType } from '../Types'\nimport { EvaluationStrategy, UntypedLambdaState, UntypedLambdaSettings, UntypedLambdaType, StepRecord, UntypedLambdaExpressionState, UntypedLambdaMacroState, PromptPlaceholder } from \"./Types\"\nimport { ASTReduction, AST, decodeFast as decodeUntypedLambdaFast } from '@lambdulus/core'\n\n\nexport const ADD_BOX_LABEL = '+λ'\n\nexport const CODE_NAME = 'UNTYPED_LAMBDA_CALCULUS'\n\nexport const defaultSettings : UntypedLambdaSettings = {\n  type : BoxType.UNTYPED_LAMBDA,\n  SLI : false,\n  expandStandalones : false,\n  strategy : EvaluationStrategy.NORMAL\n}\n\nexport function createNewUntypedLambdaExpression (defaultSettings : UntypedLambdaSettings) : UntypedLambdaExpressionState {\n  return {\n    ...defaultSettings,\n    __key : Date.now().toString(),\n    type : BoxType.UNTYPED_LAMBDA,\n    subtype : UntypedLambdaType.ORDINARY,\n    title : \"Untyped λ Expression\",\n    minimized : false,\n    menuOpen : false,\n    settingsOpen : false,\n    expression : \"\",\n    ast : null,\n    history : [],\n    isRunning : false,\n    breakpoints : [],\n    timeoutID : undefined,\n    timeout : 5,\n    \n    // strategy : EvaluationStrategy.NORMAL,\n    // singleLetterNames : false,\n    // standalones : false,\n    \n    editor : {\n      placeholder : \"placeholder\",\n      content : \"\",\n      caretPosition : 0,\n      syntaxError : null,\n    }\n  }\n}\n\n// TODO: Implement\nexport function createNewUntypedLambdaExercise (defaultSettings : UntypedLambdaSettings) : UntypedLambdaState {\n  return null as any\n}\n\n// TODO: Implement\nexport function createNewUntypedLambdaMacro (defaultSettings : UntypedLambdaSettings) : UntypedLambdaMacroState {\n  return (\n    {\n      ...defaultSettings,\n      __key : Date.now().toString(),\n      type : BoxType.UNTYPED_LAMBDA,\n      title : \"Untyped λ Macro Expression\",\n      minimized : false,\n      menuOpen : false,\n      settingsOpen : false,\n    \n      subtype : UntypedLambdaType.MACRO,\n      expression : '',\n      ast : null,\n      macroName : '',\n      macroExpression : '',\n      \n      editor : {\n        placeholder : PromptPlaceholder.MACRO,\n        content : '',\n        caretPosition : 0,\n        syntaxError : null\n      }\n    }\n  )\n}\n\n\nexport function decodeUntypedLambdaState (box : UntypedLambdaState) : UntypedLambdaState {\n  switch (box.subtype) {\n    case UntypedLambdaType.ORDINARY:\n      return decodeUntypedLambdaExpression(box as UntypedLambdaExpressionState)\n      \n    case UntypedLambdaType.MACRO:\n      return box //TODO: implement\n\n    case UntypedLambdaType.EXERCISE:\n      return box //TODO: implement\n  }\n}\n\nfunction decodeUntypedLambdaExpression (box : UntypedLambdaExpressionState) : UntypedLambdaExpressionState {\n  const untypedLambdaBox : UntypedLambdaExpressionState = box as UntypedLambdaExpressionState\n\n  if (untypedLambdaBox.expression === '') {\n    return untypedLambdaBox\n  }\n  \n  const decodedFirst : AST | null = decodeUntypedLambdaFast(untypedLambdaBox.ast)\n\n  if (decodedFirst === null) {\n    // TODO: repair:\n    // parse expression\n    // replace untypedLambdaBox.ast with parsed AST\n    // for now - throw error\n    throw \"ROOT AST IS NOT DECODABLE\"\n  }\n\n  untypedLambdaBox.ast = decodedFirst\n  untypedLambdaBox.history = untypedLambdaBox.history.map((step : StepRecord, index : number) => {\n    let decodedNth : AST | null = decodeUntypedLambdaFast(step.ast) as AST\n\n    if (decodedNth === null) {\n      // TODO: repair:\n      // try to take previous Step.ast and do the evaluation\n      // though - remember this Step.step (number) may not be + 1 of the previous one\n      // you will need to do the steps as long as need to be\n      // replace decodedNth with parsed AST\n      // for throw\n      throw \"CURRENT STEP IS NOT DECODABLE \" + index\n    }\n\n    // TODO: maybe instead of this theatre just use the Core . Evalautor\n    // and get real instance of ASTReduction\n    let reduction : ASTReduction | undefined | null = step.lastReduction\n\n    if (step.lastReduction === undefined) {\n      reduction = null\n    }\n\n    return {\n      ...step,\n      lastReduction : reduction,\n      ast : decodedNth, // TODO: as AST this is unsafe\n    }\n  })\n\n  return untypedLambdaBox\n}","import {  CODE_NAME as UNTYPED_CODE_NAME, decodeUntypedLambdaState } from './untyped-lambda-integration/AppTypes'\nimport { defaultSettings as UntypedLambdaDefaultSettings } from './untyped-lambda-integration/AppTypes'\n\nimport { BoxType, Screen, BoxesWhitelist, AppState, GlobalSettings, NotebookState, BoxState } from \"./Types\"\nimport { UntypedLambdaState } from './untyped-lambda-integration/Types'\n\n\nexport const CLEAR_WORKSPACE_CONFIRMATION : string =\n`This will delete this whole Notebook as well as every other Notebook stored in your browser.\n\n                                                              Are you sure?`\n\n// TODO: when building `Exam Mode` simply leave only non-evaluative BoxTypes\nexport const ALL_BOX_TYPES : Array<BoxType> = [ BoxType.UNTYPED_LAMBDA, BoxType.LISP, BoxType.MARKDOWN ]\n\nexport const ANY_BOX = -1\n\nexport const NO_BOX = -2\n\nexport const DEFAULT_WHITELIST : BoxesWhitelist = ALL_BOX_TYPES\n\n\nexport function mapBoxTypeToStr (type : BoxType) : string {\n  switch (type) {\n    case BoxType.UNTYPED_LAMBDA:\n      return 'untypedLambdaBox'\n\n    case BoxType.MARKDOWN:\n      return 'markDownBox'\n    default:\n      return ''\n  }\n}\n\n\nexport const EmptyAppState : AppState = {\n  notebookList : [{\n    boxList : [],\n    activeBoxIndex : NaN,\n    focusedBoxIndex : undefined,\n    allowedBoxes : ANY_BOX,\n    settings : getDefaultSettings(DEFAULT_WHITELIST),\n\n    __key : Date.now().toString(),\n    name : \"Default Ntbk\",\n    editingName : false,\n    persistent : true,\n  }],\n  currentNotebook : 0,\n  currentScreen : Screen.MAIN,\n}\n\n\nexport function updateSettingsInStorage (settings : GlobalSettings) : void {\n  window.localStorage.setItem('global-settings', JSON.stringify(settings))\n}\n\nexport function getDefaultSettings (whitelist : BoxesWhitelist) : GlobalSettings {\n  let defaultSettings = {}\n\n  if (whitelist === NO_BOX) {\n    whitelist = []\n  }\n  else if (whitelist === ANY_BOX) {\n    whitelist = ALL_BOX_TYPES\n  }\n\n  for (const type of whitelist) {\n    switch (type) {\n      case BoxType.UNTYPED_LAMBDA:\n        defaultSettings = {\n          ...defaultSettings,\n          [UNTYPED_CODE_NAME] : UntypedLambdaDefaultSettings,\n        }\n        break;\n    \n      default:\n        break;\n    }\n  }\n\n  return defaultSettings\n}\n\nexport function loadSettingsFromStorage () : GlobalSettings {\n  const defaultSettings = {\n    [UNTYPED_CODE_NAME] : {}\n  }\n\n  const serialized : string | null = window.localStorage.getItem('global-settings')\n  const deserialized : GlobalSettings =  serialized === null ? defaultSettings : JSON.parse(serialized)\n\n  \n  for (const [key, value] of Object.entries(deserialized)) {\n    switch (key) {\n      case UNTYPED_CODE_NAME:\n        deserialized[key] = { ...UntypedLambdaDefaultSettings, ...value }\n        break;\n    \n      default:\n        console.error(\"Settings CODE NAME is not one of known Code Names.\")\n        break;\n    }\n  }\n\n  return deserialized\n}\n\n\nexport function loadAppStateFromStorage () : AppState {\n  const maybeState : string | null = localStorage.getItem('AppState')\n\n  if (maybeState === null) {\n    localStorage.setItem('AppState', JSON.stringify(EmptyAppState))\n    return EmptyAppState\n  }\n  else {\n    try {\n      return decode(JSON.parse(maybeState))\n    }\n    catch (e) {\n      return EmptyAppState\n    }\n  }\n}\n\nexport function updateAppStateToStorage (state : AppState) : void {\n  localStorage.setItem('AppState', JSON.stringify(state))\n}\n\n// TODO: This function is going to be replaced with correct implementation of decoding\n// this slowly becomes better and better base for the final implementation\n/**\n * This function THROWS Error in case of invalid argument\n * @param state : Deserialized form of AppState\n */\nexport function decode (state : AppState) : AppState | never {\n  const notebookList : Array<NotebookState> = state.notebookList.map((notebook : NotebookState) => {\n    const boxList : Array<BoxState> = notebook.boxList.map((box : BoxState, index : number, arr : Array<BoxState>) => {\n      switch (box.type) {\n        case BoxType.UNTYPED_LAMBDA: {\n          decodeUntypedLambdaState(box as UntypedLambdaState)\n        }\n\n        //TODO: implement for other Box Types\n      \n        default:\n          return box\n      }\n    })\n\n    return {\n      ...notebook,\n      boxList,\n    }\n  })\n  \n  return {\n    ...state,\n    notebookList,\n  }\n}","import React, { ChangeEvent } from 'react'\n\nimport { decode } from '../AppTypes'\nimport { Screen, AppState } from '../Types'\n\n\nimport '../styles/MenuBar.css'\n// import { reportEvent } from '../misc'; // later\n\ninterface MenuBarProperties {\n  state : AppState\n  onImport (state : AppState) : void\n  onClearWorkspace () : void\n  onScreenChange (screen : Screen) : void\n}\n\nexport default function MenuBar (props : MenuBarProperties) : JSX.Element {\n  const { state, onImport, onClearWorkspace, onScreenChange } : MenuBarProperties = props\n\n  const { currentScreen } = state\n\n  // const dehydrated : object = dehydrate(state)\n\n  const serialized : string = JSON.stringify(state)\n  const link : string = createURL(serialized)\n\n  return (\n    <div id=\"menu-bar\">\n      <div\n        className='tab'\n        title='Get Info about this Tool'\n        onClick={ () => void 0 }\n      >\n        <span className='lambdulusIcon'>λ</span>\n        <p className='iconLabel'>Lambdulus</p>\n      </div>\n\n      <div className='separator' />\n\n      {/* NOTEBOOK */}\n      <div\n        className={ currentScreen === Screen.MAIN ? 'currentTab tab tab-hoverable' : 'tab tab-hoverable' }\n        title='Notebook Content'\n        onClick={ () => onScreenChange(Screen.MAIN) }\n      >\n        <i\n          className=\"icon far fa-file-alt\"\n        />\n        <p className='iconLabel'>Notebook</p>\n      </div>\n\n      {/* SETTINGS */}\n      <div\n        className={ currentScreen === Screen.SETTINGS ? 'currentTab tab tab-hoverable' : 'tab tab-hoverable' }\n        title='Go to the Settings'\n        onClick={ () => onScreenChange(Screen.SETTINGS) }\n      >\n        <i\n          className=\"icon fas fa-cogs\"\n        />\n        <p className='iconLabel'>Settings</p>\n      </div>\n\n      {/* Clear the Whole Workspace */}\n      <div\n        className='tab tab-hoverable'\n        title='Clear the Whole Workspace'\n        onClick={ onClearWorkspace }\n      >\n        <i\n          className=\"icon fas fa-eraser\"\n        />\n        <p className='iconLabel'>Clear All</p>\n      </div>\n\n      {/* <div title='List all defined macros' >\n        {\n          screen === Screen.main ?\n            <i className=\"icon fas fa-list-ul\" onClick={ () => onScreenChange(Screen.macrolist) } />\n            :\n            screen === Screen.macrolist ?\n              <i className=\"icon far fa-window-close\" onClick={ () => onScreenChange(Screen.main) } />\n              :\n              <i className=\"icon fas fa-list-ul\" onClick={ () => onScreenChange(Screen.macrolist) } />\n        }\n        <p className='iconLabel'>Macros</p>\n      </div>         */}\n\n      {/* TODO: SOLVE WHERE TO MOVE FEEDBACK/BUGS/ISSUES */}\n      {/* <div\n        className='tab'\n        title='Report a bug or request new feature'>\n        <a href='https://github.com/lambdulus/new-frontend/issues' target=\"_blank\">\n          <i className=\"icon fas fa-bug\"></i>\n        </a>\n        <p className='iconLabel'>Feedback</p>\n      </div>  */}\n\n      <div className='separator' />\n\n      {/* Export Notebook */}\n      <div\n        className='tab tab-hoverable'\n        title='Download this Notebook'\n      >\n        <a\n          className='export'\n          href={ link }\n          download=\"notebook_lambdulus.lus\" // TODO: change the name according to the notebook name\n          onClick={ () => setTimeout(() => {\n            window.URL.revokeObjectURL(link)\n            // reportEvent('Export notebook', `Notebook: ${serialized}`, '') // TODO: report event\n          }, 10) }\n        >\n          <i id='download' className=\"icon fas fa-cloud-download-alt\" />\n        </a>\n        <p className='iconLabel'>Export</p>\n      </div>\n\n      {/* Import Notebook */}\n      <div\n        className='tab tab-hoverable'\n        title='Import a Notebook from Computer'\n      >\n        <input type=\"file\" accept=\".lus\" id=\"input\"\n        onChange={ (e) => onFiles(e, onImport) }\n        />\n        <label htmlFor=\"input\"><i className=\"icon fas fa-cloud-upload-alt\"></i></label>\n        <p className='iconLabel'>Import</p>\n      </div>\n\n      <div className='separator' />\n\n      {/* Issues */}\n      <div\n        className='tab tab-hoverable'\n        title='Submit a Bug or a Feature Request'\n      >\n        <a\n        target=\"_blank\"\n          href='https://github.com/lambdulus/new-frontend/issues'\n        >\n          <i className=\"icon fas fa-bug\" />\n        </a>\n        <p className='iconLabel'>GH Issues</p>\n      </div>\n\n      {/* MANUAL/HELP */}\n      <div\n        className={ currentScreen === Screen.HELP ? 'currentTab tab tab-hoverable' : 'tab tab-hoverable' }\n        title='Show the Manual'\n        onClick={ () => onScreenChange(Screen.HELP) }\n      >\n        <i\n          className=\"icon far fa-question-circle\"\n        />\n        <p className='iconLabel'>Manual</p>\n      </div>\n\n    </div>\n  )\n}\n\n// function dehydrateBox (box : BoxState) : BoxState {\n//   const { type } : BoxState = box\n\n//   if (type === BoxType.EXPRESSION) {\n\n//     return {\n//       ...box,\n//       ast : null as any, // TODO: don't\n//       history : [], // TODO: don't\n//       isRunning : false,\n//       breakpoints : [], // TODO: solve how to don't\n//       timeoutID : undefined,\n//     }\n//   }\n\n//   return box\n// }\n\n// function dehydrate (state : AppState) : AppState {\n//   return {\n//     ...state,\n//     submittedBoxes : state.submittedBoxes.map(dehydrateBox)\n//   }\n// }\n\n// function hydrateBox (box : BoxState, macroTable : MacroMap) : BoxState {\n//   const { type } : BoxState = box\n  \n//   if (type === BoxType.EXPRESSION) {\n//     const { singleLetterNames } = box as UntypedLambdaState\n//     const ast : AST = parseExpression((box as UntypedLambdaState).expression, { macroTable, singleLetterNames })\n\n//     return {\n//       ...box,\n//       ast,\n//       history : [ { ast, lastReduction : None, step : 0, message : '', isNormalForm : false } ],\n//     }\n//   }\n\n//   return box\n// }\n\n// function hydrate (dehydrated : AppState) : AppState {\n//   const { macroTable } = dehydrated\n//   const config = { macroTable }\n\n//   return {\n//     ...dehydrated,\n//     submittedBoxes : dehydrated.submittedBoxes.map((box) => hydrateBox(box, macroTable))\n//   }\n// }\n\n// interface Config {\n//   singleLetterNames : boolean\n//   macroTable : MacroMap\n// }\n\n// function parseExpression (expression : string, config : Config) : AST {\n//   const { singleLetterNames : singleLetterVars, macroTable } : Config = config\n  \n//   const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n//   const ast : AST = parse(tokens, macroTable)\n\n//   return ast\n// }\n\n\nfunction onFiles (event : ChangeEvent<HTMLInputElement>, onImport : (state : AppState) => void) : void {\n  const { target : { files } } = event\n  if (files === null) {\n    return\n  }\n\n  const file : File = files[0]\n  const reader : FileReader = new FileReader\n  reader.onload = (event : Event) => {\n    const state : AppState = JSON.parse(reader.result as string)\n\n    onImport(decode(state))\n\n    // onImport(hydrate(state))\n    // reportEvent('Import notebook', `Notebook named ${ file.name }`, '')\n  }\n\n  reader.readAsText(file) \n}\n\nfunction createURL (content : string) : string {\n  const data = new Blob([ content ], {\n    type: 'application/json'\n  })\n\n  return window.URL.createObjectURL(data);\n}","import { BoxType, AbstractBoxState } from \"../Types\"\n\n\nexport interface NoteState extends AbstractBoxState {\n  __key : string\n  type : BoxType\n  note : string\n  isEditing : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport function createNewMarkdown () : NoteState {\n  return {\n    __key : Date.now().toString(),\n    type : BoxType.MARKDOWN,\n    title : 'Markdown Box',\n    minimized : false,\n    menuOpen : false,\n    settingsOpen : false,\n    note : '',\n    isEditing : true,\n    editor : {\n      placeholder : PromptPlaceholder,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null\n    }\n  }\n}\n\nexport const PromptPlaceholder : string = 'Note in MarkDown'\n\nexport function onMarkDownBlur (state : NoteState) : NoteState {\n  return {\n    ...state,\n    isEditing: false,\n  }\n}","import React, { Component } from 'react'\n\nimport { ANY_BOX, NO_BOX } from '../AppTypes'\nimport { BoxType, BoxesWhitelist, BoxState, GlobalSettings } from '../Types'\nimport { createNewUntypedLambdaExercise, createNewUntypedLambdaExpression, createNewUntypedLambdaMacro, ADD_BOX_LABEL, CODE_NAME as UNTYPED_CODE_NAME } from '../untyped-lambda-integration/AppTypes'\nimport { UntypedLambdaSettings, UntypedLambdaState } from '../untyped-lambda-integration/Types'\nimport { createNewMarkdown } from '../markdown-integration/AppTypes'\n\nimport \"../styles/CreateBox.css\"\n\ninterface Props {\n  addNew : (box : BoxState) => void,\n  whiteList : BoxesWhitelist,\n  settings : GlobalSettings\n}\n\ninterface State {\n  opened : boolean\n}\n\nfunction anyBoxAllowed (whitelist : BoxesWhitelist) : boolean {\n  return whitelist === ANY_BOX\n}\n\nfunction noBoxAllowed (whitelist : BoxesWhitelist) : boolean {\n  return whitelist === NO_BOX\n}\n\nfunction isAllowed (type : BoxType, whitelist : BoxesWhitelist) : boolean {\n  return anyBoxAllowed(whitelist) || (whitelist as Array<BoxType>).includes(type)\n}\n\n// TODO: this needs to change\n// somehow I need to be able to delegate choosing the specific subtype of the Box\nexport default class CreateBox extends Component<Props, State> {\n  constructor (props : Props) {\n    super(props)\n\n    this.state = {\n      opened : false,\n    }\n\n    this.onOpen = this.onOpen.bind(this)\n  }\n\n\n  render () : JSX.Element {\n    const { addNew, whiteList, settings } : Props = this.props\n  \n    const untLSettings : UntypedLambdaSettings = settings[UNTYPED_CODE_NAME] as UntypedLambdaState\n  \n    const addLambdaBoxIfAllowed = (allowed : boolean) => (\n      allowed ?\n        <div className='create-box--group'>\n          <p\n            className='plusBtn'\n            title='Create new λ box'\n            onClick={ () => {\n              this.setState({ opened : false })\n              addNew(createNewUntypedLambdaExpression(untLSettings)) } // TODO: some imported function from the Integration -- like Integration.CreateNewBox()\n            }\n          >\n            <i>{ ADD_BOX_LABEL } Expression</i>\n          </p>\n  \n          <p\n            className='plusBtn'\n            title='Create new λ Exercise box'\n            onClick={ () => {\n              this.setState({ opened : false })\n              addNew(createNewUntypedLambdaMacro(untLSettings)) } // TODO: some imported function from the Integration -- like Integration.CreateNewBox()\n            }\n              >\n            <i>{ ADD_BOX_LABEL } Macro</i>\n          </p>\n  \n          <p\n            className='plusBtn'\n            title='Create new λ Macro box'\n            onClick={ () => {\n              this.setState({ opened : false })\n              addNew(createNewUntypedLambdaMacro(untLSettings)) } // TODO: some imported function from the Integration -- like Integration.CreateNewBox()\n            }\n              >\n            <i>{ ADD_BOX_LABEL } Exercise</i>\n          </p>\n        </div>\n        :\n        null\n    )\n  \n    const addLispBoxIfAllowed = (allowed : boolean) => (\n      allowed ?\n        <div className='create-box--group'>\n          <p\n            className='plusBtn'\n            title='Create new Lisp box'\n            onClick={ () => {\n              this.setState({ opened : false })\n              addNew({__key : Date.now().toString()} as BoxState) } // NOTE: just for now\n            }\n          >\n            <i>+ Lisp</i>\n          </p>\n        </div>\n        :\n        null\n    )\n  \n    const addMDBoxIfAllowed = (allowed : boolean) => (\n      allowed ?\n      <div className='create-box--group'>\n        <p\n          className='plusBtn'\n          title='Create new MarkDown box'\n          onClick={ () => {\n            this.setState({ opened : false })\n            addNew(createNewMarkdown()) }\n          }\n        >\n          <i>+ MD</i>\n        </p>\n      </div>\n      :\n      null\n    )\n\n    if (this.state.opened) {\n      return (\n        noBoxAllowed(whiteList) ?\n          null as any\n          :\n          <div className='create-box'>\n            <div className='create-box--container'>\n              { addLambdaBoxIfAllowed(isAllowed (BoxType.UNTYPED_LAMBDA, whiteList)) }\n              { addLispBoxIfAllowed(isAllowed(BoxType.LISP, whiteList)) }\n              { addMDBoxIfAllowed(isAllowed(BoxType.MARKDOWN, whiteList)) }\n            </div>\n          </div>\n      )\n    }\n    \n    return (\n      <div className='create-box-plus'>\n        <div className='create-box-plus--button' onClick={ this.onOpen }>\n          <div className='create-box-plus--container'>\n            <p>\n              <i className=\"fas fa-plus\" />\n            </p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  onOpen () : void {\n    this.setState({ opened : true })\n  }\n  \n}\n","import React, { ChangeEvent, KeyboardEvent } from 'react'\nimport MonacoEditor from 'react-monaco-editor'\n\nimport '../styles/Editor.css'\n\n// import { EvaluationStrategy } from '../App'\n\n\nexport enum ActionType {\n  ENTER_EXPRESSION = 'Enter Expression',\n  ENTER_EXERCISE = 'Enter Exercise',\n  NEXT_STEP = 'Next Step',\n  RUN = 'Run',\n  ENTER_MD = 'Enter MarkDown',\n}\n\ninterface EditorProperties {\n  placeholder: string\n  content : string\n  caretPosition : number\n  syntaxError : Error | null\n  submitOnEnter : boolean\n  shouldReplaceLambda : boolean\n  \n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void // TODO:delete\n  // onReset () : void\n}\n\nexport default function Editor (props : EditorProperties) : JSX.Element {\n  const {\n    placeholder,\n    content,\n    caretPosition,\n    syntaxError,\n    submitOnEnter,\n    shouldReplaceLambda,\n\n    onContent,\n    onEnter,\n    onExecute,\n  } : EditorProperties = props\n  const lines : number = content.split('\\n').length\n\n  const onChange = (content : string) => {\n    // let { target : { value : content } } : { target : { value : string } } = event\n    // const caretPosition : number = event.target.selectionEnd\n\n    if (shouldReplaceLambda) {\n      content = content.replace(/\\\\/g, 'λ')\n    }\n    \n    onContent(content, caretPosition)\n  }\n\n  // TODO: Editor should not decide that - it should only implement onEnter onShiftEnter onCtrlEnter\n  const onKeyDown = (event : KeyboardEvent<HTMLDivElement>) => {\n    if ( ! event.shiftKey && ! event.ctrlKey && event.key === 'Enter') {\n      \n      if (submitOnEnter) {\n        event.stopPropagation()\n        event.preventDefault()\n        onEnter()\n      }\n\n      return\n    }\n\n    // if (event.shiftKey && event.key === 'Enter' && isMarkDown) {\n    //   event.preventDefault()\n    //   onEnter()\n    // }\n    if (event.ctrlKey && event.key === 'Enter') {\n      event.preventDefault()\n      onExecute()\n    }\n\n    // TODO: not yet\n    // if (event.ctrlKey && event.key === 'r') {\n    //   event.preventDefault()\n    //   onReset()\n    // }\n  }\n\n  return (\n    <div className='editorContainer'>\n      {\n        syntaxError ?\n        <p className='editorError'>\n          { `${syntaxError}` }\n        </p>\n        :\n        null\n      }\n\n      <div className=\"editor\">\n        <InputField\n          placeholder={ placeholder }\n          content={ content }\n          lines={ lines }\n          caretPosition={ caretPosition }\n          // onChange={ onChange }\n          onContent={ (content : string) => onChange(content) }\n          onKeyDown={ onKeyDown }\n        />\n      </div>\n    </div>\n  )\n}\n\ninterface InputProps {\n  placeholder : string\n  content : string\n  lines : number\n  caretPosition : number\n  // onChange (event : ChangeEvent<HTMLTextAreaElement>) : void\n  onContent (content : string) : void\n  onKeyDown (event : KeyboardEvent<HTMLDivElement>) : void\n}\n\nfunction InputField (props : InputProps) : JSX.Element {\n  const { placeholder, content, lines, onKeyDown, caretPosition, onContent } : InputProps = props\n\n  return (\n    <div\n      onKeyDownCapture={ onKeyDown }\n    >\n      <MonacoEditor\n        // width=\"800\"\n        height={10 * 19} // 10 lines by default\n        language=\"markdown\"\n        theme=\"vs-light\"\n        value={ content }\n        options={ { formatOnPaste : true, minimap : { enabled : false} } }\n        onChange={ (content : string) => onContent(content) }\n        // editorDidMount={ ::this.editorDidMount }\n      />\n    </div>\n  )\n}","import { AST, Lambda, Application, Macro, ChurchNumeral, Variable } from \"@lambdulus/core\"\n\n///////////////////////////////////////////////////////////////////////////////////////\n\ntype Pair<T> = [T, T]\ntype Triple<T> = [T, T, T]\n\n\n// TODO: fix the public equals interface, maybe public get and private set?\n// maybe implement public get method and bool itself leave private?\n//\n// first I need more trees, I need the previous AST\nexport class TreeComparator {\n  private translator : Map<string, string> = new Map\n  public equals : boolean = true\n  private context : Pair<AST>\n\n  constructor (readonly roots : Pair<AST> ) {\n    [ ...this.context ] = roots\n    // TODO: I need to compare roots first\n    this.compare()\n  }\n\n  compare () : void {\n    /**\n    TODO: compare need to compare both children if got\n    if one of them is incorrect\n    then solve that problem\n    if both of them is incorrect\n    then solve both problems and then decide how both come together\n\n    then I have an instance of knowledge system\n    I can fire up that system in this context (this node with invalid children)\n    system will need to get instance of something to call methods on\n    because system needs to ask questions - like, is this possible,\n    is this error applicable?\n    so instead of human, code will look up the AST and answer the questions\n    so it will be some kind of class which is able to observe all 3 ASTs at the same time\n    it will also have implemented query methods,\n    probably wont be many of them, just few\n    **/\n    \n    const [ left, right ] : Pair<AST> = this.context\n\n    if (left instanceof Lambda && right instanceof Lambda) {\n      const backup : Map<string, string> = new Map(this.translator.entries())\n\n      this.translator.set(left.argument.name(), right.argument.name())\n      this.context = [ left.right, right.right ]\n      this.compare()\n\n      this.translator = backup\n    }\n    else if (left instanceof Application && right instanceof Application) {\n      this.context = [ left.left, right.left ]\n      this.compare()\n\n      if ( ! this.equals) {\n        return\n      }\n\n      this.context = [ left.right, right.right ]\n      this.compare()\n    }\n    else if (left instanceof Macro && right instanceof Macro) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof ChurchNumeral && right instanceof ChurchNumeral) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof Variable && right instanceof Variable) {\n      if (this.translator.has(left.name())) {\n        this.equals = this.translator.get(left.name()) === right.name()\n      }\n      else {\n        this.equals = left.name() === right.name()\n      }\n    }\n    else {\n      this.equals = false\n    }\n  }\n}","import React, { useContext, ReactNode } from 'react'\n\nimport Editor from '../components/Editor'\n// import { MakeActiveContext, DeleteBox } from './BoxSpace'\nimport { StepRecord } from './Types'\n\ninterface EmptyExpressionProps {\n  className : string\n  isActive : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n  history : Array<StepRecord>\n\n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n}\n\n\nexport default function EmptyExpression(props : EmptyExpressionProps) : JSX.Element{\n  const { className, isActive, editor } = props\n  const {\n    placeholder,\n    content,\n    caretPosition,\n    syntaxError,\n  } = editor\n\n  // const makeActive = useContext(MakeActiveContext)\n  // const deleteBox = useContext(DeleteBox)\n\n  return (\n    <div\n      className={ `${className} ${isActive ? '' : ' inactiveBox'}` }\n    >\n      {\n        isActive ?\n          (\n            <div>\n              <Editor\n                placeholder={ placeholder } // data\n                content={ content } // data\n                caretPosition={ caretPosition } // data\n                syntaxError={ syntaxError } // data\n                submitOnEnter={ true } // data\n                shouldReplaceLambda={ true }\n\n                onContent={ props.onContent } // fn\n                onEnter={ props.onEnter } // fn // tohle asi bude potreba\n                onExecute={ props.onExecute } // fn // tohle asi bude potreba\n              />\n            </div>\n          )\n          :\n          (\n            <div>\n              <p className='inactiveMessage'>\n                Collapsing { Math.max(0, props.history.length - 1) } { props.history.length === 2 ? 'step' : 'steps' }. Click to activate this box.\n              </p>\n              </div>\n          )\n      }\n    </div>\n  )\n}","import { MacroMap } from \"@lambdulus/core\"\n\n\nexport function debounce (fn : Function, treshold : number)\n : [ (...args : Array<any>) => void, () => void ] {\n  let timer : number\n  \n  return [\n    function debounced (...args : Array<any>) : void {\n      window.clearTimeout(timer)\n\n      timer = window.setTimeout(() => {\n        fn(...args)\n      }, treshold)\n    },\n    function cancel () : void {\n      window.clearTimeout(timer)\n    }\n  ]\n}\n\n// export function getSavedMacros () : MacroMap {\n//   return JSON.parse(window.localStorage.getItem('macrotable') || '{}')\n// }\n\nexport function trimStr (str : string) : string {\n  return str.trim()\n}\n\nexport function mapLeftFromTo(\n  from : number,\n  to : number,\n  sequence : Array<any>,\n  fn : (...args : Array<any>) => any) {\n    const result : Array<any> = new Array(to - from + 1)\n\n    for (let e = 0, i = from; i <= to; ++i) {\n      result[e++] = fn(sequence[i], i)\n    }\n\n    return result\n  }\n\n// export const HANDY_MACROS : MacroMap = {\n//   // 'Y' : '(λ f . (λ x . f (x x)) (λ x . f (x x)))',\n//   // 'Z' : '(λ f . (λ y . f (λ z . y y z)) (λ y . f (λ z . y y z)))',\n//   // FACT : '(Y (λ f n . (<= n 1) 1 (* n (f (- n 1)))))',\n//   // FACCT : '(λ n . (Y (λ f n a . IF (= n 1) a (f (- n 1) (* n a)))) (- n 1) (n))',\n//   // FIB : '(Y (λ f n . (= n 0) 0 ((= n 1) 1 ( + (f (- n 1)) (f (- n 2))))))',\n//   // // SHORTLIST : 'CON 3 (CONS 5 (CONS 1 NIL))',\n//   // // LONGLIST :  '(CONS 3 (CONS 5 (CONS 1 (CONS 10 (CONS 7 (CONS 2 (CONS 4 (CONS 9 (CONS 4 (CONS 6 (CONS 8 NIL)))))))))))',\n//   // APPEND : 'Y (λ fn listA listB . IF (NULL listA) (listB) (CONS (FIRST listA) (fn (SECOND listA) listB)))',\n//   // LISTGREQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (>= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // LISTLESS : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (< (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // LISTGR : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (> (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // LISTEQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n//   // QUICKSORT : 'Y (λ fn list . IF (NULL list) (NIL) ( IF (NULL (SECOND list)) (list) ( APPEND (fn (LISTLESS (FIRST list) list)) ( APPEND (LISTEQ (FIRST list) list) (fn (LISTGR (FIRST list) list)) ) ) ) )',\n//   // INFLIST : '(λ n . (Y (λ x . (λ f s g . g f s) n x)))',\n//   // REMOVENTH : 'Y (λ fn list n . IF (= n 0) (SECOND list) (IF (NULL list) NIL (CONS (FIRST list) (fn (SECOND list) (- n 1) ) ) ) )',\n//   // NTH : 'Y (λ fn list n . IF (= n 0) (FIRST list) (IF (NULL (list)) NIL (fn (SECOND list) (- n 1)) ) )',\n//   // LEN : 'Y (λ fn list . IF (NULL list) (0) (+ 1 (fn (SECOND list) )) )',\n//   // GETNTH : '(λ end . (Y (λ f n i . (end i) (i) ( (= n 0) (Y (λ f a . (end a) (i) (f) ) ) (f (- n 1)) ) )) )',\n//   // MAP : '(λ fn l . (Y (λ f it . IF (NULL it) (NIL) (CONS (fn (FIRST it)) (f (SECOND it))) )) l )',\n//   // REDUCE : '(λ fn l init . Y (λ f it acc . IF (NULL it) (acc) (f (SECOND it) (fn (FIRST it) acc)) ) l init )',\n//   // APPLY : '(λ f args . Y (λ ff f l . (NULL l) (f) (ff (f (FIRST l)) (SECOND l)) ) f args )',\n//   // RANGE : '(λ m n . Y (λ f e . (= e n) (CONS e NIL) (CONS e (f (+ e 1))) ) m )',\n//   // LISTCOMPR : '(λ args . APPLY (λ op in rng cond . Y (λ f l . (NULL l) (NIL) ( (cond (FIRST l)) (CONS (op (FIRST l)) (f (SECOND l))) (CONS (FIRST l) (f (SECOND l))) ) ) rng ) args )',\n//   // MOD : '(λ n m . (n (λ n . (= n (- m 1)) (0) (+ n 1)) (0)) )',\n//   // INFIX : 'APPLY (λ l op r . op l r)',\n// }\n\n// export function updateMacros (macroTable : MacroMap) : void {\n//   window.localStorage.setItem('macrotable', JSON.stringify(macroTable))\n// }\n\nexport function reportEvent (category : string, action : string, label : string) : void {\n  try {\n    const tracker = (window as any).ga.getAll()[0]\n    \n    tracker.send('event', category, action, label )\n  }\n  catch (exception) {\n    // instead of printing to the console - show notification on the web\n    // console.log(\"\")\n    // console.log('PLEASE DISABLE YOUR ADBLOCKER OR ALLOW GOOGLE ANALYTICS FOR THIS SITE')\n    // console.log(\"\")\n    // console.error(exception)\n  }\n}","import React from 'react'\n\nimport { ASTVisitor, Lambda, Variable, Beta, AST, Application, ChurchNumeral, Expansion, Macro, ASTReduction, Alpha, Gama, ASTReductionType } from \"@lambdulus/core\"\nimport { Breakpoint } from './Types'\nimport { reportEvent } from '../misc';\n\n\nexport default class ReactPrinter extends ASTVisitor {\n  private rendered : JSX.Element | null = null\n  private argument : Variable | null = null\n\n  private printMultiLambda (lambda : Lambda, accumulator : JSX.Element) : void {\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.body.argument\n      let className : string = 'argument'\n      let title : string = ''\n\n      if (this.isBreakpoint(lambda.body.argument)) {\n        className += ' breakpoint'\n        title = 'Will break on substitution'\n      }\n\n      // bug@highlight-alpha\n      let set = false\n      if (this.reduction instanceof Alpha\n            &&\n          Array.from(this.reduction.conversions).some((conversion : Lambda) => {\n            return conversion.identifier === lambda.body.identifier\n          })\n          ) {\n              this.argument = context\n              set = true\n              className += ' alpha'\n      }\n\n      // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n      let argument : Variable | null = this.argument\n      if (this.argument !== lambda.body.argument\n          &&\n          this.argument !== null\n          &&\n          this.argument.name() === lambda.body.argument.name()) {\n        this.argument = null\n      } // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n\n      // TODO: same here\n      if (this.argument\n          &&\n          this.argument.name() === context.name()) {\n            className += ' substitutedArg'\n        }\n\n      const args : JSX.Element = (\n        <span className='arguments'>\n          { accumulator } {' '}\n          <span\n            className={ className }\n            title={ title }\n            onClick={ () => {\n              (context as any).identifier = Symbol()\n              this.onClick({ type : ASTReductionType.BETA, context, broken : new Set })\n              reportEvent('Breakpoint added to argument', 'Breakpoint was added', '')\n            }\n            }\n          >\n            { context.name() }\n          </span>\n        </span>\n      )\n      \n      this.printMultiLambda(lambda.body, args)\n      if (set === true) {\n        this.argument = null\n      }\n      this.argument = argument // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n    }\n    else {\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n      this.rendered = accumulator\n\n      this.rendered = (\n        <span className='function'>\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          { accumulator } . { body }\n          )\n        </span>\n      )\n    }\n  }\n\n  isBreakpoint (node : AST) : boolean {\n    for (const breakpoint of this.breakpoints) {\n      if (breakpoint.context.identifier === node.identifier) {\n        return true\n      }\n    }\n    return false\n  }\n\n  constructor (\n    public readonly tree : AST,\n    private readonly onClick : (breakpoint : Breakpoint) => void,\n    private readonly reduction : ASTReduction,\n    private readonly breakpoints : Array<Breakpoint>,\n  ) {\n    super()\n    this.tree.visit(this)\n  }\n\n  print () : JSX.Element | null {\n    return this.rendered\n  }\n\n  // TODO: little bit refactored, maybe keep going\n  onApplication (application: Application) : void {\n    let className : string = 'application'\n    let leftClassName : string = 'left'\n    let rightClassName : string = 'right'\n    let set : boolean = false\n    let redex : AST | null = null\n\n    if (this.reduction instanceof Beta) {\n      redex = this.reduction.redex\n    }\n\n    if (this.reduction instanceof Gama && this.reduction.args.includes(application)) {\n      className += ' redex abstraction argument'\n    }\n    // else if (this.reduction instanceof Expansion) {\n    //   redex = this.reduction.target\n    // } // to asi neni uplne potreba tady\n\n    if (redex !== null\n          &&\n        redex.identifier === application.identifier // tohle je asi trosku useles\n          &&\n        redex === application\n      ) {\n        leftClassName += ' redex'\n        rightClassName += ' redex'\n\n        // TODO: this is probably not good and should be done other way\n\n        if (application.left instanceof Lambda) {\n          this.argument = application.left.argument\n          set = true\n        }\n    }\n\n    if (application.right instanceof Application) {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3 a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>( { this.rendered } )</span>\n\n      this.rendered =\n      <span className={ className }>\n        { left } { right }\n      </span>\n    }\n    else {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>{ this.rendered }</span>\n\n      this.rendered =\n      <span className={ className }>\n        { left } { right }\n      </span>\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onLambda (lambda: Lambda) : void {\n    // TODO: this also seems not so elegant and clean\n\n    let title : string = ''\n\n    let argument : Variable | null = this.argument\n    if (this.argument !== lambda.argument\n        &&\n        this.argument !== null\n        &&\n        this.argument.name() === lambda.argument.name()) {\n      this.argument = null\n    }\n\n\n    // multilambda\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n        title = 'Will break on substitution'\n      }\n\n      // TODO: same here\n      if (this.argument\n        &&\n        this.argument.name() === context.name()) {\n          className += ' substitutedArg'\n      }\n\n      // if (this.reduction instanceof Alpha) {\n      //   className += ' alpha'\n      // }\n\n      const acc : JSX.Element = (\n        <span\n          className={ className }\n          title={ title }\n          onClick={ () => {\n            (context as any).identifier = Symbol()\n            this.onClick({ type : ASTReductionType.BETA, context, broken : new Set })\n            reportEvent('Breakpoint added to argument', 'Breakpoint was added', '')\n          }\n          }\n        >{ lambda.argument.name() }\n        </span>\n      )\n\n      this.printMultiLambda(lambda, acc)\n    }\n    else {\n      const context : Variable = lambda.argument\n\n      // lambda.argument.visit(this)\n      \n      // const args : JSX.Element | null = this.rendered\n\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n\n      let className : string = 'argument'\n      let title : string = ''\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n        title = 'Will break on substitution'\n      }\n\n      // TODO: same here\n      if (this.argument\n        &&\n        this.argument.name() === context.name()) {\n          className += ' substitutedArg'\n      }\n\n      this.rendered = (\n        <span className='function' >\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          <span\n            className='arguments'\n            onClick={ () => {\n              (context as any).identifier = Symbol()\n              // TODO: for now it does nothing - maybe delete in the future            \n              // this.onClick({ type : Beta, context, broken : new Set })\n              // reportEvent('Breakpoint added to argument', 'Breakpoint was added', '')\n            }\n            }\n          >\n            <span\n                className={ className }\n                title={ title }\n                onClick={ () => {\n                  (context as any).identifier = Symbol()\n                  this.onClick({ type : ASTReductionType.BETA, context, broken : new Set })\n                  reportEvent('Breakpoint added', 'Breakpoint was added', '')\n                }\n                }\n            >\n              { lambda.argument.name() }\n            </span>\n            { ' ' }\n          </span>\n          . { body } \n          )\n        </span>\n      )\n    }\n\n    this.argument = argument\n    if (argument !== null) {\n      this.argument = argument\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onChurchNumeral (churchNumber: ChurchNumeral) : void {\n    let className : string = 'churchnumeral'\n    let redex : AST | null = null\n    let redexClass : string = ' redex'\n    let title : string = ''\n\n    if (this.reduction instanceof Expansion) {\n      redex = this.reduction.target\n    }\n\n    if (this.reduction instanceof Gama && this.reduction.args.includes(churchNumber)) {\n      className += ' redex abstraction argument'\n    }\n\n    if (redex !== null\n          &&\n        redex.identifier === churchNumber.identifier\n          &&\n        redex === churchNumber\n      ) {\n        className += redexClass\n    }\n\n    if (this.isBreakpoint(churchNumber)) {\n      className += ' breakpoint'\n      title = 'Will break on Expansion'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        title={ title }\n        onClick={ () => {\n          (churchNumber as any).identifier = Symbol()\n          this.onClick({ type: ASTReductionType.EXPANSION, context : churchNumber, broken : new Set })\n          reportEvent('Breakpoint added to ChurchNumeral', 'Breakpoint was added', '')\n        }\n        }\n      >\n        { churchNumber.name() }\n      </span>\n    )\n  }\n\n  // TODO: little bit refactored, maybe keep going  \n  onMacro (macro: Macro) : void {\n    let className = 'macro'\n    let redex : AST | null = null\n    let redexClass : string = ' redex'\n    let title : string = ''\n\n    if (this.reduction instanceof Expansion) {\n      redex = this.reduction.target\n    } \n\n    if (this.reduction instanceof Gama) {\n      if (this.reduction.redexes.includes(macro)) {\n        [ redex ] = this.reduction.redexes\n        className += redexClass + ' abstraction'\n      }\n\n\n      if (this.reduction.args.includes(macro)) {\n        className += redexClass + ' abstraction argument'\n      }\n    }\n\n\n    if (redex !== null\n          &&\n        redex.identifier === macro.identifier\n          &&\n        redex === macro\n        ) {\n      className += redexClass\n    }\n\n    if (this.isBreakpoint(macro)) {\n      className += ' breakpoint'\n      title = 'Will break on Expansion'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        title={ title }\n        onClick={ () => {\n          (macro as any).identifier = Symbol()\n          this.onClick({ type: ASTReductionType.EXPANSION, context : macro, broken : new Set })\n          reportEvent('Breakpoint added to Macro', 'Breakpoint was added', '')\n        }\n        }\n      >\n        { macro.name() }\n      </span>\n    )\n  }\n  \n  onVariable (variable: Variable): void {\n    // TODO: same here - not so clean\n    let className : string = 'variable'\n\n    if (this.argument\n        &&\n        this.argument.name() === variable.name()) {\n          className += ' substitutedArg'\n          if (this.reduction instanceof Alpha) {\n            className += ' alpha'\n          }\n      }\n\n    this.rendered = <span className={ className } >{ variable.name() }</span>\n  }\n}","import React from 'react'\nimport { ASTReduction, Beta, Alpha, Expansion, Gama, ASTReductionType } from '@lambdulus/core' // , Eta\n\n\ninterface ReductionMessageProperties {\n  lastReduction : ASTReduction | null\n}\n\nexport default function ReductionMessage (props : ReductionMessageProperties) : JSX.Element {\n  const { lastReduction } = props\n\n  if (lastReduction === null) {\n    return null as any\n  }\n\n  if (lastReduction.type === ASTReductionType.BETA) {\n    return (\n      <p className='lastReduction'>\n        β reduction\n      </p>\n    )\n  }\n\n  if (lastReduction.type === ASTReductionType.ALPHA) {\n    return (\n      <p className='lastReduction'>\n        α conversion\n      </p>\n    )\n  }\n\n  if (lastReduction.type === ASTReductionType.EXPANSION) {\n    return (\n      <p className='lastReduction'>\n        Macro expansion\n      </p>\n    )\n  }\n\n  // if (lastReduction.type === ASTReductionType.ETA) {\n  //   return (\n  //     <p className='lastReduction'>\n  //       η conversion\n  //     </p>\n  //   )\n  // }\n\n  if (lastReduction.type === ASTReductionType.GAMA) {\n    return (\n      <p className='lastReduction'>\n        Simplified Application\n      </p>\n    )\n  }\n\n  else {\n    return null as any\n  }\n  \n}","import React, { memo } from 'react'\nimport { ASTReduction } from '@lambdulus/core'\n\nimport './styles/Step.css'\n\nimport { strategyToEvaluator } from './ExpressionBox'\nimport ReactPrinter from './ReactPrinter'\n// import ReductionMessage from './ReductionMessage'\nimport { EvaluationStrategy, StepRecord, Breakpoint, Evaluator } from './Types'\nimport ReductionMessage from './ReductionMessage'\n// import { StrategyContext } from './DataInjector'\n\n\ninterface StepWrapperProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  lastStep : boolean\n}\n\ninterface StepProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  strategy : EvaluationStrategy\n  lastStep : boolean\n}\n\n// This is done because of highlighting - if Strategy is changed ->\n// old steps should not be re-highlighted with changed Strategy - but stay same\nconst StepMemo = memo(Step, (props : StepProperties) => !props.lastStep)\n\nexport default function StepWrapper (props : StepWrapperProperties) : JSX.Element {\n  // return(\n  //   <StrategyContext.Consumer>\n  //     { \n  //       (strategy : EvaluationStrategy) => <StepMemo { ...props } strategy={ strategy } />\n  //     }\n  //   </StrategyContext.Consumer>\n  // )\n  return(\n    <StepMemo { ...props } strategy={ EvaluationStrategy.NORMAL } />\n  )\n}\n\nfunction Step (props : StepProperties) : JSX.Element | null {\n  const { stepRecord, addBreakpoint, breakpoints, children, strategy } = props\n  const { ast : tree, lastReduction, step, message } = stepRecord\n\n  if (tree === null) {\n    return null\n  }\n\n  const evaluator : Evaluator = new (strategyToEvaluator(strategy) as any)(tree)\n  const reduction : ASTReduction = evaluator.nextReduction\n  const printer : ReactPrinter = new ReactPrinter(tree, addBreakpoint, reduction, breakpoints)\n\n  const incorrectStep : boolean = stepRecord.message.indexOf('Incorrect step.') === 0\n  const correctStep : boolean = stepRecord.message.indexOf('Correct.') === 0\n  const exerciseStep : boolean = incorrectStep || correctStep\n\n  return (\n    <span className='step'>\n      <ReductionMessage lastReduction={ lastReduction } />\n      <div className='inlineblock' >\n        <p className='stepNumber' >\n          { step } :\n        </p>\n        { printer.print() }\n        { children }\n        {\n          stepRecord.message === '' ?\n            null\n            :\n            exerciseStep === false ?\n            <p className='stepMessage' >\n              { stepRecord.message }\n            </p>\n            :\n            incorrectStep === true ?\n              <p className='stepMessage incorrect' >\n                Incorrect input: <i className='userInput'>`{ stepRecord.message.substr(15) }`</i>\n              </p>\n            :\n              <p className='stepMessage correct' >\n                { stepRecord.message }\n              </p>\n        }\n      </div>\n    </span>\n  )\n}","import React, { useContext, ReactNode } from 'react'\n\nimport Step from './Step'\n// import { AddBoxContext } from './MethodInjector'\nimport { Breakpoint, StepRecord, UntypedLambdaState } from './Types'\n// import { DeleteBox, MakeActiveContext } from './BoxSpace'\n\ninterface InactiveExpressionProps {\n  className : string\n  breakpoints : Array<Breakpoint>\n  history : Array<StepRecord>\n\n  createBoxFrom (stepRecord : StepRecord) : UntypedLambdaState\n}\n\n\nexport default function InactiveExpression (props : InactiveExpressionProps) : JSX.Element {\n  const { className } = props\n  // const deleteBox = useContext(DeleteBox)\n  // const makeActive = useContext(MakeActiveContext)\n\n  return (\n    <div\n      className={ className + ' inactiveBox' }\n    >\n      <ul className='UL'>\n        <li key={ 0 } className='activeStep LI'>\n          <Step\n            breakpoints={ props.breakpoints }\n            addBreakpoint={ () => {} } // blank function - NOOP\n            stepRecord={ props.history[0] }\n            lastStep={ false }\n          >\n            \n            {/* <AddBoxContext.Consumer>\n              {\n                (addBox : (boxState : BoxState) => void) => <i\n                  className=\"hiddenIcon far fa-clone\"\n                  onClick={ () => addBox(props.createBoxFrom(props.history[0])) }\n                />\n              }\n            </AddBoxContext.Consumer> */}\n            \n          </Step>\n        </li>\n      </ul>\n      <p className='inactiveMessage'>\n        Collapsing { props.history.length - 1 } { props.history.length === 2 ? 'step' : 'steps' }. Click to activate this box.\n      </p>\n    </div>\n  )\n}","import React, { PureComponent } from 'react'\n\nimport '../styles/DebugControls.css'\n\n\ninterface Props {\n  isRunning : boolean\n\n  onStep : () => void\n  onRun : () => void\n}\n\n// TODO: Consider separating the `keydown` event handler into different file\n// it would be singleton module, which would make sure ONLY ONE `DebugControls` component\n// is subscribed to the `keydown` event\nexport default class DebugControls extends PureComponent<Props> {\n  constructor (props : Props) {\n    super(props)\n  }\n\n  componentDidMount () : void {\n    document.onkeydown = (event) => {\n      console.log('KEYDOWN', event.key)\n      if ( ( ! event.shiftKey)\n        && ( ! event.ctrlKey)\n        && ( ! event.altKey)\n        && ( ! event.metaKey)\n        && (event.key === 'F8' || event.key === 'F9')) {\n          if (event.key === 'F8') {\n            this.props.onStep()\n          }\n          if (event.key === 'F9') {\n            this.props.onRun()\n          }\n        }\n    }\n  }\n\n  componentWillUnmount () : void {\n    document.onkeydown = () => void 0\n  }\n\n  render () {\n    const { isRunning, onStep, onRun } : Props = this.props\n  \n    const runMessage : string =\n      isRunning ? 'Stop the Evaluation (Press F9)' :  'Evaluate the Expression (Press F9)'\n\n    return (\n      <div className='debug-controls'>\n        <button\n          title={ runMessage }\n          type=\"button\"\n          className='btn debug-controls--run'\n          onClick={ onRun }\n        >\n          <span className='debug-controls--btn-label'>{ isRunning ? 'Stop' : 'Run' }</span>\n          <i className=\"mini-icon fas fa-play\"></i>\n        </button>\n        \n        <button\n          title='Evaluate Next Step (Press F8)'\n          type=\"button\"\n          className='btn debug-controls--step'\n          onClick={ onStep }\n          disabled={ isRunning }\n        >\n          <span className='debug-controls--btn-label'>Step</span>\n          <i className=\"mini-icon fas fa-step-forward\"></i>\n        </button>\n      </div>\n    )\n  }\n\n}"," import React, { PureComponent, ReactNode } from 'react'\n\n// import Controls from './Controls' // TODO: Controls are gonna be imported from the Frontend app - or maybe not even imported just passed as children\nimport Step from './Step'\nimport { UntypedLambdaState, Breakpoint, StepRecord, UntypedLambdaExpressionState } from './Types'\nimport Editor from '../components/Editor'\n// import { DeleteBox } from './BoxSpace'\n// import { AddBoxContext } from './MethodInjector'\nimport { mapLeftFromTo } from '../misc'\nimport DebugControls from '../components/DebugControls'\n// import BoxTopBar from './BoxTopBar'\n// import Controls from './ExerciseSwitch'\n\n\ninterface EvaluatorProps {\n  className : string\n  state : UntypedLambdaExpressionState\n  breakpoints : Array<Breakpoint>\n  history : Array<StepRecord>\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n  isNormalForm : boolean\n\n  createBoxFrom (stepRecord : StepRecord) : UntypedLambdaState\n  setBoxState (state : UntypedLambdaExpressionState) : void\n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n  addBox (box : UntypedLambdaState) : void\n  shouldShowDebugControls : boolean\n}\n\nexport default class Expression extends PureComponent<EvaluatorProps> {\n  constructor (props : EvaluatorProps) {\n    super(props)\n\n    this.addBreakpoint = this.addBreakpoint.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { className, state, editor, shouldShowDebugControls } = this.props\n\n    const { isRunning } : UntypedLambdaExpressionState = state\n\n    const {\n      placeholder,\n      content,\n      caretPosition,\n      syntaxError,\n    } = editor\n\n    return (\n      <div className={ className }>\n        <ul className='UL'>\n          {\n            mapLeftFromTo(0, this.props.history.length - 2, this.props.history, (stepRecord : StepRecord, i : Number) =>\n              <li key={ i.toString() } className='inactiveStep LI' >\n                <Step\n                  breakpoints={ this.props.breakpoints }\n                  addBreakpoint={ () => {} }\n                  stepRecord={ stepRecord }\n                  lastStep={ false }\n                >\n                  <i\n                    className=\"hiddenIcon far fa-clone\"\n                    title='Clone this expression to the new box'\n                    onClick={ (e : any) => {\n                      e.preventDefault()\n                      this.props.addBox(this.props.createBoxFrom(stepRecord))\n                    } }\n                  />\n                </Step>\n              </li>)\n          }\n          <li key={this.props.history.length - 1} className='activeStep LI'>\n            <Step\n              breakpoints={ this.props.breakpoints }\n              addBreakpoint={ this.addBreakpoint }\n              stepRecord={ this.props.history[this.props.history.length - 1] }\n              lastStep={ true }\n            >\n                <i\n                  className=\"hiddenIcon far fa-clone\"\n                  title='Clone this expression to the new box'\n                  onClick={ (e : any) => {\n                    e.preventDefault() // TODO: maybe I shouldn't do this\n                    // maybe instead I should drop the `focusedBoxIndex` and stop caring if Box has been clicked\n                    // instead I could always render whole and complete Box if user does not collapsed it\n                    // I need to think this through\n                    this.props.addBox(this.props.createBoxFrom(this.props.history[this.props.history.length - 1]))\n                   } }\n                />\n            </Step>\n          </li>\n        </ul>\n        {\n          ( ! this.props.isNormalForm && shouldShowDebugControls) ?\n            <DebugControls\n              isRunning={ isRunning }\n              onStep={ this.props.onEnter }\n              onRun={ this.props.onExecute }\n            />\n          :\n            null\n          // <Editor\n          //   placeholder={ placeholder } // data\n          //   content={ content } // data\n          //   caretPosition={ caretPosition } // data\n          //   syntaxError={ syntaxError } // data\n          //   submitOnEnter={ true } // data\n\n          //   onContent={ this.props.onContent } // fn\n          //   onEnter={ this.props.onEnter } // fn // tohle asi bude potreba\n          //   onExecute={ this.props.onExecute } // fn // tohle asi bude potreba\n          // />\n        }\n      </div>\n    )\n  }\n\n  addBreakpoint (breakpoint : Breakpoint) : void {\n    let { state, setBoxState } = this.props\n  \n    setBoxState({\n      ...state,\n      breakpoints : [ ...state.breakpoints, breakpoint ],\n    })\n  }\n}","import React, { PureComponent, ReactNode } from 'react'\n\nimport {\n  AST,\n  ASTReduction,\n  None,\n  NormalEvaluator,\n  Beta,\n  Lambda,\n  Variable,\n  Expansion,\n  ChurchNumeral,\n  Macro,\n  Token,\n  tokenize,\n  parse,\n  ApplicativeEvaluator,\n  OptimizeEvaluator,\n  MacroMap,\n  NormalAbstractionEvaluator,\n} from \"@lambdulus/core\"\n\nimport './styles/EvaluatorBox.css'\n\nimport { BoxType, BoxState } from '../Types'\n\nimport { TreeComparator } from './TreeComparator'\nimport EmptyEvaluator from './EmptyExpression'\nimport InactiveEvaluator from './InactiveExpression'\nimport Expression from './Expression'\nimport { EvaluationStrategy, PromptPlaceholder, UntypedLambdaState, Evaluator, StepRecord, Breakpoint, UntypedLambdaType, UntypedLambdaExpressionState } from './Types'\nimport { reportEvent } from '../misc'\n\n\nexport function strategyToEvaluator (strategy : EvaluationStrategy) : Evaluator {\n  switch (strategy) {\n    case EvaluationStrategy.NORMAL:\n      return NormalEvaluator as any\n \n    case EvaluationStrategy.APPLICATIVE:\n      return ApplicativeEvaluator as any\n\n    case EvaluationStrategy.OPTIMISATION:\n      return OptimizeEvaluator as any\n\n    case EvaluationStrategy.ABSTRACTION:\n      return NormalAbstractionEvaluator as any\n  }\n}\n\nexport interface EvaluationProperties {\n  state : UntypedLambdaExpressionState\n  isActive : boolean\n  isFocused : boolean\n\n  setBoxState (state : UntypedLambdaExpressionState) : void\n  addBox (box : UntypedLambdaState) : void\n}\n\nexport default class ExpressionBox extends PureComponent<EvaluationProperties> {\n  constructor (props : EvaluationProperties) {\n    super(props)\n\n    this.onContent = this.onContent.bind(this)\n    this.onSubmitExpression = this.onSubmitExpression.bind(this)\n    this.parseExpression = this.parseExpression.bind(this)\n    this.onEnter = this.onEnter.bind(this)\n    this.onExerciseStep = this.onExerciseStep.bind(this)\n    this.onStep = this.onStep.bind(this)\n    this.onExecute = this.onExecute.bind(this)\n    this.onRun = this.onRun.bind(this)\n    this.onStop = this.onStop.bind(this)\n    this.shouldBreak = this.shouldBreak.bind(this)\n    this.createBoxFrom = this.createBoxFrom.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { state, isActive, addBox } : EvaluationProperties = this.props\n    const {\n      minimized,\n      history,\n      breakpoints,\n      // isExercise,\n      strategy,\n      expression,\n      editor,\n    } : UntypedLambdaExpressionState = state\n\n    let className : string = 'box boxEval'\n    const { isNormalForm } = history.length ? history[history.length - 1] : { isNormalForm : false }\n\n    if (expression === '') {\n      return (\n        <EmptyEvaluator\n          className={ className }\n          isActive={ this.props.isActive }\n          editor={ editor }\n          history={ history }\n\n          onContent={ this.onContent }\n          onEnter={ this.onEnter }\n          onExecute={ this.onExecute }\n        />\n      )\n    }\n\n    // NOTE: commenting now - Exercise Box will come later\n    // if (isExercise) {\n    //   className += ' boxExercise'\n    // }\n\n    // TODO: Maybe I will take this out\n    // Frontend may take care of that\n    if (minimized) {\n      return (\n        <InactiveEvaluator\n          className={ className }\n          breakpoints={ breakpoints }\n          history={ history }\n          \n          createBoxFrom={ this.createBoxFrom }\n        />\n      )\n    }\n\n    return (\n      <Expression\n        className={ className }\n        // isExercise={ isExercise }\n        state={ state }\n        breakpoints={ breakpoints }\n        history={ history }\n        editor={ editor }\n        isNormalForm={ isNormalForm }\n        shouldShowDebugControls={ isActive }\n\n        createBoxFrom={ this.createBoxFrom }\n        setBoxState={ this.props.setBoxState }\n        onContent={ this.onContent }\n        onEnter={ this.onEnter }\n        onExecute={ this.onExecute }\n        addBox={ addBox }\n      />\n    )\n  }\n\n  createBoxFrom (stepRecord : StepRecord) : UntypedLambdaState {\n    const { state } : EvaluationProperties = this.props\n    const {\n      strategy,\n      SLI,\n      expandStandalones,\n    } : UntypedLambdaExpressionState = state\n    const { ast } = stepRecord\n    const content = ast.toString()\n\n    return {\n      __key : Date.now().toString(),\n      type : BoxType.UNTYPED_LAMBDA,\n      subtype : UntypedLambdaType.ORDINARY,\n      title : `Copy of ${state.title}`,\n      minimized : false,\n      menuOpen : false,\n      settingsOpen : false,\n      expression : \"\",\n      ast : null,\n      history : [],\n      isRunning : false,\n      breakpoints : [],\n      timeoutID : undefined,\n      timeout : 10,\n      // isExercise : false,\n      strategy,\n      SLI,\n      expandStandalones,\n      editor : {\n        placeholder : PromptPlaceholder.EVAL_MODE,\n        content,\n        caretPosition : content.length,\n        syntaxError : null,\n      }\n    }\n  }\n\n  onContent (content : string, caretPosition : number) : void {\n    const { state, setBoxState } = this.props\n\n    setBoxState({\n      ...state,\n      editor : {\n        ...state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n  }\n\n  onEnter () : void {\n    const { expression, editor : { content } } = this.props.state\n\n    if (expression === '') {\n      this.onSubmitExpression()\n    }\n    else if (content !== '') { // && isExercise\n      this.onExerciseStep()\n    }\n    else if (content === '') { //  && (! isExercise)\n      this.onStep()\n    }\n    else {\n      console.log('Error: Something unexpected just happened. A')\n    }\n  }\n\n  onSubmitExpression () : void {\n    const { state, setBoxState } = this.props\n    const {\n      editor : { content },\n    } = state\n\n    try {\n      const ast : AST = this.parseExpression(content)\n\n      setBoxState({\n        ...state,\n        ast,\n        expression : content,\n        history : [ {\n          ast : ast.clone(),\n          lastReduction : new None,\n          step : 0,\n          message : '',\n          isNormalForm : false\n        } ],\n        editor : {\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.EVAL_MODE,\n          syntaxError : null,\n        }\n      })\n\n      reportEvent('Submit Expression', 'submit valid', content)\n    } catch (exception) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : exception.toString(),\n        }\n      })\n\n      reportEvent('Submit Expression', 'submit invalid', content)\n    }\n  }\n\n  onExerciseStep () {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    \n    try {\n      const userAst : AST = this.parseExpression(content)\n      const stepRecord : StepRecord = history[history.length - 1]\n      const { isNormalForm, step } = stepRecord\n      let { ast, lastReduction } = stepRecord\n      ast = ast.clone()\n\n      if (isNormalForm) {\n        // TODO: do something about it\n        // say user - there are no more steps and it is in normal form        \n        // TODO: consider immutability\n        stepRecord.message = 'No more steps available. Expression is in normal form.'\n\n        setBoxState({\n          ...state,\n        })\n\n        reportEvent('Exercise Step', 'Step Already in normal form', content)\n\n        return\n      }\n    \n      const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n      lastReduction = normal.nextReduction\n    \n      if (normal.nextReduction instanceof None) {\n        // TODO: refactor PLS - update history\n        // TODO: say user it is in normal form and they are mistaken\n        stepRecord.isNormalForm = true\n        stepRecord.message = 'Expression is already in normal form.'\n        \n        setBoxState({\n          ...state,\n        })\n\n        reportEvent('Exercise Step', 'Step Already in Normal Form', content)\n        \n        return\n      }\n    \n      ast = normal.perform()\n    \n      let message : string = ''\n      const comparator : TreeComparator = new TreeComparator([ userAst, ast ])\n\n      if (comparator.equals) {\n        ast = userAst\n        message = 'Correct.'\n\n        reportEvent('Exercise Step', 'Valid Step', content)\n      }\n      else {\n        // TODO: say user it was incorrect\n        // TODO: na to se pouzije uvnitr EvaluatorState prop messages nebo tak neco\n        // console.log('Incorrect step')\n        message = `Incorrect step. ${content}`\n\n        reportEvent('Exercise Step', 'Invalid Step', content)\n      }\n\n      setBoxState({\n        ...state,\n        history : [ ...history, { ast, lastReduction, step : step + 1, message, isNormalForm : false } ],\n        editor : {\n          ...state.editor,\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.VALIDATE_MODE,\n          syntaxError : null,\n        }\n      })\n    } catch (exception) {\n      // TODO: print syntax error\n      // TODO: do it localy - no missuse of onSubmit\n\n      // TODO: print syntax error\n\n      reportEvent('Exercise Step', 'Syntax error in Step', content)\n    }\n  }\n\n  onStep () : void {\n    console.log('DOIN ONE STEP')\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    const stepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { ast, lastReduction } = stepRecord\n    ast = ast.clone()\n  \n    if (isNormalForm) {\n      return\n    }\n\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n  \n    if (normal.nextReduction instanceof None) {\n      console.log('NEXT IS NONE')\n      stepRecord.isNormalForm = true\n      stepRecord.message = 'Expression is in normal form.'\n      \n      setBoxState({\n        ...state,\n      })\n      \n      reportEvent('Evaluation Step', 'Step Normal Form Reached', ast.toString())\n\n      return\n    }\n  \n    ast = normal.perform()\n\n    // ANCHOR: #0023\n    // NOTE: This is completely crazy - it doesn't make any sense\n    // TODO: Investigate more - and fix the functionality\n    // it probably should check if the current AST Root is a Macro and next Reduction is Expansion of exactly this AST\n    // then it can say - it is in the Normal Form - if some settings enables it - not by default though\n    //\n    // if (ast instanceof Macro || ast instanceof ChurchNumeral) {\n    //   console.log('CURRENT IS MACRO OR NUMBER')\n\n    //   stepRecord.isNormalForm = true\n    //   stepRecord.message = 'Expression is in normal form.'\n\n    //   reportEvent('Evaluation Step', 'Step Normal Form Reached with Number or Macro', ast.toString())\n    // }\n  \n    setBoxState({\n      ...state,\n      history : [ ...history, { ast, lastReduction, step : step + 1, message : '', isNormalForm : false } ],\n\n    })\n\n    reportEvent('Evaluation Step', 'Step', ast.toString())\n  }\n\n  onExecute () : void {\n    const { state, setBoxState } = this.props\n    const { isRunning } = state\n\n    // if (isExercise) {\n    //   // TODO: exercises can not be run - some message to user???\n    //   return\n    // }\n\n    if (isRunning) {\n      this.onStop()\n    }\n    else {\n      const { timeout, history } = state\n      const stepRecord = history[history.length - 1]\n  \n      if (stepRecord.isNormalForm) {\n        return\n      }\n      \n      const { ast, step, lastReduction, isNormalForm, message } = stepRecord\n      history.push(history[history.length - 1])\n      history[history.length - 2] = { ast : ast.clone(), step, lastReduction, message : 'Skipping some steps...', isNormalForm }\n\n      setBoxState({\n        ...state,\n        isRunning : true,\n        timeoutID : window.setTimeout(this.onRun, timeout),\n      })\n\n      reportEvent('Execution', 'Run Evaluation', ast.toString())\n    }\n  }\n\n  onRun () : void {\n    const { state, setBoxState } = this.props\n    const { strategy } = state\n    let { history, isRunning, breakpoints, timeoutID, timeout } = state\n    const stepRecord : StepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { lastReduction } = stepRecord\n\n    if ( ! isRunning) {\n      return\n    }\n    \n    if (isNormalForm) {\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    let { ast } = stepRecord\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n    \n    if (normal.nextReduction instanceof None) {\n      // TODO: consider immutability\n      history.pop()\n      history.push({\n        ast,\n        lastReduction : stepRecord.lastReduction,\n        step,\n        message : 'Expression is in normal form.',\n        isNormalForm : true\n      })\n  \n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    // TODO: maybe refactor a little\n    const breakpoint : Breakpoint | undefined = breakpoints.find(\n      (breakpoint : Breakpoint) =>\n        this.shouldBreak(breakpoint, normal.nextReduction)\n    )\n\n    if (breakpoint !== undefined) {\n      // TODO: consider immutability\n      if (normal.nextReduction instanceof Expansion) {\n        breakpoint.broken.add(normal.nextReduction.target)\n      }\n      if (normal.nextReduction instanceof Beta && normal.nextReduction.redex.left instanceof Lambda) {\n        breakpoint.broken.add(normal.nextReduction.redex.left.argument)\n      }\n\n      window.clearTimeout(timeoutID)\n      reportEvent('Evaluation Run Ended', 'Breakpoint was reached', ast.toString())\n\n\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID,\n      })\n\n      return\n    }\n  \n    ast = normal.perform()\n\n    history[history.length - 1] = { ast, lastReduction, step : step + 1, message : '', isNormalForm }\n\n    // NOTE: Same thing as #0023\n    // if (ast instanceof Macro || ast instanceof ChurchNumeral) {\n    //   history[history.length - 1] = { ast, lastReduction, step : step + 1, message : 'Expression is in normal form.', isNormalForm : true }\n\n    //   reportEvent('Evaluation Run Ended', 'Step Normal Form Reached with Number or Macro', ast.toString())\n    // }\n    \n    setBoxState({\n      ...state,\n      timeoutID : window.setTimeout(this.onRun, timeout)\n    })\n  }\n\n  onStop () : void {\n    const { state, setBoxState } = this.props\n    const { timeoutID } = state\n  \n    window.clearTimeout(timeoutID)\n  \n    setBoxState({\n      ...state,\n      isRunning : false,\n      timeoutID : undefined\n    })\n  }\n\n  // TODO: breakpointy se pak jeste musi predelat\n  shouldBreak (breakpoint : Breakpoint, reduction : ASTReduction) : boolean {\n    // if (reduction.type === breakpoint.type\n    //     && reduction instanceof Beta && breakpoint.context instanceof Lambda\n    //     && reduction.target.identifier === breakpoint.context.body.identifier\n    //   ) {\n    //     return true\n    // }\n    if (reduction.type === breakpoint.type\n        && reduction instanceof Beta && breakpoint.context instanceof Variable\n        && reduction.redex.left instanceof Lambda\n        && reduction.redex.left.argument.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.redex.left.argument)\n    ) {\n      return true\n    }\n\n    if (reduction.type === breakpoint.type\n        && reduction instanceof Expansion && breakpoint.context instanceof ChurchNumeral\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n    if (reduction.type === breakpoint.type\n        && reduction instanceof Expansion && breakpoint.context instanceof Macro\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n  \n    return false\n  }\n\n  // THROWS Exceptions\n  parseExpression (expression : string) : AST {\n    // const { macroTable } = this.props\n\n    const { SLI : singleLetterVars } = this.props.state\n\n    const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n    const ast : AST = parse(tokens, {}) // macroTable\n\n    return ast\n  }\n}","import React, { useContext } from 'react'\n\nimport { BoxState } from '../Types'\nimport { tokenize, parse, AST, Token, Variable, builtinMacros } from '@lambdulus/core'\nimport { UntypedLambdaState, UntypedLambdaMacroState } from './Types'\nimport Editor from '../components/Editor'\n\n\n// import { trimStr } from '../misc'\n// import Editor from './Editor'\n// import { DefineMacroContext } from './MethodInjector'\n// import { MacroDefinitionState, BoxState } from '../AppTypes'\n// import { DeleteBox } from './BoxSpace'\n\n\ninterface Props {\n  state : UntypedLambdaMacroState\n  \n  setBoxState (state : UntypedLambdaMacroState) : void\n  addBox (box : BoxState) : void\n}\n\nexport default function Macro (props : Props) : JSX.Element {\n  const { state, setBoxState } = props\n  const { editor } = state\n  const { editor : { content, caretPosition, placeholder, syntaxError } } = state\n  const { macroName, macroExpression, SLI } = state\n\n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      editor : {\n        ...editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n  }\n\n  const onSubmit = () => {\n    const [ macroName, macroExpression ] : Array<string> = content.split(':=').map((str : string) => str.trim())\n\n    // TODO: refactor later - this is just dirty little quick fix\n    if ( ! isMacroUnambigous(macroName)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : new Error(`Macro name is not valid. It redefines built-in Macro.`),\n        }\n      })\n\n      return\n    }\n\n    if ( ! isValidName(macroName, false)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError :\n          // TODO: please fix this - only dirty quick impl\n            new Error(`Macro name is not valid.`),\n        }\n      })\n\n      return\n    }\n\n    if ( ! isValidExpression(macroExpression, SLI)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : new Error(`Macro expression is not valid.`)\n        }\n      })\n\n      return\n    }\n\n    // TODO: hotfix\n    // I want Macros submited in SLI mode to have SLI parsed bodies\n    // NEW COMMENT: if I recall correctly - this may not need to be fixed\n    // even though macro is SLI - after the parse - it shoudl be transformed into the space-netween-identifiers\n    // because this is how the whole expression will look like - no???\n    const macroBody : string = parseExpression(macroExpression, SLI).toString()\n\n    setBoxState({\n      ...state,\n      macroName,\n      macroExpression : macroBody,\n    })\n\n    // defineMacro(macroName, macroBody) // TODO: tady pak budu registrovat do statickyho clena to makro\n  \n    // const newMacroTable : MacroMap = {\n    //   ...macroTable,\n    //   [macroName] : macroExpression\n    // }\n    // this.updateMacros(newMacroTable)\n  }\n\n  // TODO: implement same as Evaluator - editor and stuff\n  if (macroName === '' && macroExpression === '') {\n    return (\n      <div className='box boxMacro inactiveBox'>\n          <p className='emptyStep'>Empty macro box.</p>\n          {/* <i className='removeBox far fa-trash-alt' onClick={ deleteBox } title='Remove this Box' /> */}\n          <Editor\n            placeholder={ placeholder } // data\n            content={ content } // data\n            caretPosition={ caretPosition } // data\n            syntaxError={ syntaxError } // data\n            shouldReplaceLambda={ true }\n            submitOnEnter={ true }\n\n            onContent={ onContent } // fn\n            onEnter={ onSubmit } // fn // tohle asi bude potreba\n            onExecute={ () => {} } // fn // TODO: tohle Macro nepotrebuje\n          />\n          </div>\n    )\n  }\n\n  return (\n    <div className='box boxMacro'>\n      { macroName } := { macroExpression }\n      {/* <i className='removeBox far fa-trash-alt' onClick={ deleteBox } title='Remove this Box' /> */}\n    </div>\n  )\n}\n\n// TODO: in the future there should be more then boolean to indicate validity\nfunction isValidName (name : string, singleLetterNames : boolean) : boolean {\n  try {\n    const root : AST = parseExpression(name, singleLetterNames)\n\n    return root instanceof Variable\n  }\n  catch (exception) {\n    return false\n  }\n}\n\n// THROWS Exceptions\nfunction parseExpression (expression : string, singleLetterNames : boolean) : AST {\n  const macroTable = {}\n  const singleLetterVars : boolean = singleLetterNames\n\n  const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n  const ast : AST = parse(tokens, macroTable)\n\n  return ast\n}\n\nfunction isMacroUnambigous (name : string) : boolean {\n  return ! (name in builtinMacros)\n}\n\nfunction isValidExpression (expression : string, singleLetterNames : boolean) : boolean {\n  try {\n    parseExpression(expression, singleLetterNames)\n\n    return true\n  }\n  catch (exception) {\n    console.log(exception)\n    return false\n  }\n}","import React from 'react'\n\nimport { BoxState } from '../Types'\nimport { UntypedLambdaState, UntypedLambdaType, UntypedLambdaExpressionState, UntypedLambdaMacroState } from './Types'\nimport ExpressionBox from './ExpressionBox'\nimport Macro from './Macro'\n\n\ninterface Props {\n  state : UntypedLambdaState\n  isActive : boolean\n  isFocused : boolean\n\n  setBoxState (state : UntypedLambdaState) : void\n  addBox (box : UntypedLambdaState) : void\n}\n\nexport default function UntypedLambdaBox (props : Props) : JSX.Element {\n  const { state } : Props = props\n  const { subtype } : UntypedLambdaState = state\n\n  switch (subtype) {\n    case UntypedLambdaType.ORDINARY: {\n      const exprState : UntypedLambdaExpressionState = state as UntypedLambdaExpressionState\n      return <ExpressionBox { ...props } state={ exprState } />\n    }\n\n    case UntypedLambdaType.EXERCISE:\n      return <div>Exercise Box not implemented</div>\n  \n    case UntypedLambdaType.MACRO: {\n      const macroState : UntypedLambdaMacroState = state as UntypedLambdaMacroState\n      return <Macro { ...props } state={ macroState} />\n    }\n  }\n}","import React from 'react'\n\nimport 'github-markdown-css'\nimport { NoteState } from './AppTypes'\nimport Editor from '../components/Editor'\nconst ReactMarkdown = require('react-markdown')\n\nexport interface NoteProperties {\n  state : NoteState\n  isActive : boolean\n  isFocused : boolean\n\n  setBoxState (state : NoteState) : void\n}\n\nexport default function Note (props : NoteProperties) : JSX.Element {\n  const {\n    state : {\n      note,\n      editor : { placeholder, content, caretPosition, syntaxError },\n      isEditing,\n    },\n    isActive,\n    isFocused,\n    setBoxState,\n  } = props\n  \n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      note : content,\n      editor : {\n        ...props.state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n    // this.updateURL(expression) // tohle musim nejak vyresit - mozna ta metoda setBoxState v APP bude checkovat propisovat do URL\n  }\n\n    if (isEditing) { // TODO: isFocused removed just for now\n    return (\n      <div className='box boxNoteEditor'>\n        <Editor\n          placeholder={ placeholder } // data\n          content={ content } // data\n          caretPosition={ caretPosition } // data\n          syntaxError={ syntaxError } // data\n          submitOnEnter={ false } // data\n          shouldReplaceLambda={ false }\n          \n          onContent={ onContent } // fn\n          onEnter={ () => void 0 } // fn\n          onExecute={ () => {} } // fn\n          // onReset={ this.onClear } // fn not yet\n        />\n      </div>\n    )\n  }\n\n\n  return (\n    <div\n      onClick={ () => \n        isActive &&\n        setBoxState({\n        ...props.state,\n        isEditing : true,\n      }) }\n      className='box boxNote'\n    >\n      <ReactMarkdown className='markdown-body' source={ note } />\n    </div>\n  )\n}","import React from 'react'\n\nexport default function Empty (props : {}) : JSX.Element {\n  return (\n    <div>\n      Empty Box\n    </div>\n  )\n}","import React, { useContext, ReactNode } from 'react'\n\n// import Evaluator from './ExpressionBox'\n// import MacroDefinition from './MacroDefinition'\n// import Note from './Note'\n// import { MacroTableContext } from './EvaluatorSpace'\n// import { SetBoxContext } from './BoxSpace'\nimport { BoxType, BoxState } from '../Types'\n\nimport { UntypedLambdaState } from '../untyped-lambda-integration/Types'\n\nimport UntypedLambdaBox from '../untyped-lambda-integration/UntypedLambdaBox'\n\nimport { NoteState } from '../markdown-integration/AppTypes'\nimport Note from '../markdown-integration/Note'\n\nimport Empty from '../empty-integration'\n\n// import { BoxState } from '../AppTypes'\n\ninterface BoxProperties {\n  state : BoxState\n  isActive : boolean\n  isFocused : boolean\n\n  updateBoxState (box : BoxState) : void\n  addBoxAfter (box : BoxState) : void\n}\n\nexport default function Box (props : BoxProperties) : JSX.Element {\n  const { state, isActive, isFocused, updateBoxState, addBoxAfter } : BoxProperties = props\n  const { type } = state\n\n  // const macroTable = useContext(MacroTableContext)\n  // const setBoxState = useContext(SetBoxContext)\n\n\n  if (type === BoxType.UNTYPED_LAMBDA) {\n    return (\n      <UntypedLambdaBox\n        state={ state as UntypedLambdaState }\n        isActive={ isActive }\n        isFocused={ isFocused }\n        // macroTable={ macroTable }\n        \n        setBoxState={ updateBoxState }\n        addBox={ addBoxAfter }\n      />\n    )\n  }\n  if (type === BoxType.MARKDOWN) {\n    return (\n      <Note\n        state={ state as NoteState }\n        isActive={ isActive }\n        isFocused={ isFocused }\n\n        setBoxState={ updateBoxState }\n      />\n    )\n  }\n  else {\n    return (\n      <Empty />\n    )\n  }\n\n  // if (type === BoxType.MACRO) {\n  //   return (\n  //     <div className=''>\n  //       <MacroDefinition\n  //         state={ state as MacroDefinitionState }\n  //         setBoxState={ setBoxState }\n\n  //         // addBox={ addBox }\n  //       />\n  //     </div>\n  //   )\n  // }\n\n  // if (type === BoxType.MARKDOWN) {\n  //   return (\n  //     <div className=''>\n  //       <Note\n  //         state={ state as NoteState }\n  //         isActive={ isActive }\n\n  //         // addBox={ addBox }\n  //       />\n  //     </div>\n  //   )\n  // }\n\n  // return null as any // never happens\n}","import React, { Component, MouseEvent } from 'react'\n\nimport Controls from './ExerciseSwitch'\nimport { UntypedLambdaState } from './Types'\nimport { BoxState } from '../Types'\n\n\ninterface Props {\n  state : UntypedLambdaState\n  isActive : boolean\n  removeBox : (e : MouseEvent) => void\n  updateBoxState : (box : BoxState) => void\n}\n\n\nexport default function BoxTopBar (props : Props) : JSX.Element {\n  const { state, isActive, removeBox, updateBoxState } = props\n  // const { isExercise, editor, expression, title } = state\n\n  return (\n    <div className=''>\n      {/* {\n        expression === '' ?\n          null\n        :\n        <Controls\n          isExercise={ isExercise }\n          makeExercise={ () =>\n            updateBoxState({\n              ...state,\n              isExercise : true,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.VALIDATE_MODE,\n              },\n            })\n          }\n          endExercise={ () =>\n            updateBoxState({\n              ...state,\n              isExercise : false,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.EVAL_MODE,\n              },\n            })\n          }\n        />\n      } */}\n\n      {/* <i\n        className='removeBox far fa-trash-alt'\n        onClick={ removeBox }\n        title='Remove this Box'\n      /> */}\n\n      {/* {\n        state.minimized ?\n          <i\n            className=\"imizeBox fas fa-sort-down\"\n            onClick={ (e : MouseEvent) => {\n              e.stopPropagation()\n              updateBoxState({ ...state, minimized : false })\n            } }\n            title='Expand this Box'\n          />\n          :\n          <i\n            className=\"imizeBox fas fa-sort-up\"\n            onClick={ (e : MouseEvent) => {\n              e.stopPropagation()\n              updateBoxState({ ...state, minimized : true })\n            } }\n            title='Collapse this Box'\n          />\n      } */}\n    </div>\n  )\n}","import React, { Component, ChangeEvent, MouseEvent } from 'react'\n\nimport { NoteState, PromptPlaceholder } from './AppTypes'\n\nimport 'pretty-checkbox'\nimport './styles/EditingSwitch.css'\nimport { BoxState } from '../Types'\n\nconst { Switch } = require('pretty-checkbox-react')\n\n\ninterface Props {\n  state : NoteState\n  isActive : boolean\n  removeBox : (e : MouseEvent) => void\n  updateBoxState : (box : BoxState) => void\n}\n\n\nexport default function BoxTopBar (props : Props) : JSX.Element {\n  const { state, isActive, removeBox, updateBoxState } = props\n  const { note, isEditing, title } = state\n\n  return (\n    <div className=''>\n      {\n      // TODO: Remove This\n      /* <div className='topBarTitle' contentEditable={ true } onBlur={ (e) => updateBoxState({ ...state, title : e.target.textContent || \"\" }) }>\n        { title === \"\" ? \"Click Here to Change the Title\" : title }\n      </div> */}\n      <div className='markdown-controls' title='Edit as Markdown'>\n        \n        {/* This will be separated into it's own component */}\n        <div className='markdown-editing'>\n          <span\n            className={ `markdown-write ${isEditing ? 'markdown-selected' : ''}` }\n            onClick={ () => updateBoxState({ ...state, isEditing : true}) }\n          >\n            Edit\n          </span>\n          <span\n            className={ `markdown-preview ${isEditing ? '' : 'markdown-selected'}` }\n            onClick={ () => updateBoxState({ ...state, isEditing : false}) }\n          >\n            Preview\n          </span>\n        </div>\n      </div>\n\n      {/* <i\n        className='removeBox far fa-trash-alt'\n        onClick={ removeBox }\n        title='Remove this Box'\n      /> */}\n    </div>\n  )\n}","import React from 'react'\n\nexport default function EmptyTopBar (props : {}) : JSX.Element {\n  return (\n    <div></div>\n  )\n}","import React, { MouseEvent } from 'react'\nimport { BoxType, BoxState } from '../Types'\nimport UntypedLambdaBTB from '../untyped-lambda-integration/BoxTopBar'\nimport { UntypedLambdaState } from '../untyped-lambda-integration/Types'\n\nimport MarkdownBTB from '../markdown-integration/BoxTopBar'\nimport { NoteState } from '../markdown-integration/AppTypes'\n\nimport EmptyBTB from '../empty-integration/BoxTopBar'\n\nimport '../styles/BoxTopBar.css'\n\ninterface Props {\n  state : BoxState\n  isActive : boolean\n  isFocused : boolean\n  removeBox : (e : MouseEvent) => void\n  updateBoxState : (box : BoxState) => void\n  addBoxBefore : (box : BoxState) => void\n  addBoxAfter : (box : BoxState) => void\n}\n\n\nexport default function BoxTitleBar (props : Props) : JSX.Element {\n  const { state, isActive, updateBoxState, removeBox, addBoxBefore, addBoxAfter } : Props = props\n  const { type, title, menuOpen, minimized, settingsOpen } = state\n\n\n  return (\n    <div className='boxTopBar'>\n      <div\n        className='topBarTitle'\n        contentEditable={ true }\n        onBlur={ (e) => updateBoxState({ ...state, title : e.target.textContent || \"\" }) \n      } >\n        { title }\n      </div>\n\n      <div className='box-top-bar-custom'>\n        {\n          (type === BoxType.UNTYPED_LAMBDA) ? \n            (\n              <UntypedLambdaBTB\n                state={ state as UntypedLambdaState }\n                isActive={ isActive }\n                removeBox={ removeBox }\n                updateBoxState={ updateBoxState }\n              />\n            )\n          :\n          (type === BoxType.MARKDOWN) ?\n            (\n              <MarkdownBTB\n                state={ state as NoteState }\n                isActive={ isActive }\n                removeBox={ removeBox }\n                updateBoxState={ updateBoxState }\n              />\n            )\n          :\n            (\n              <EmptyBTB />\n            )\n        }\n\n      </div>\n      <div className='box-top-bar-controls'>\n\n        <div\n          onClick={ (e) => {\n            e.stopPropagation()\n            updateBoxState({ ...state, minimized : ! minimized })\n          } }\n          className='box-top-bar--controls--imize'\n          title={ minimized ? 'Expand this Box' : 'Collapse this Box' }\n        >\n          {\n            minimized ?\n            <i className=\"mini-icon fas fa-caret-down\" />\n            :\n            <i className=\"mini-icon fas fa-caret-up\" />\n          }\n        </div>      \n\n        <div\n          className='box-top-bar--controls--settings'\n          onClick={ (e) => {\n            e.stopPropagation()\n            updateBoxState({ ...state, settingsOpen : ! settingsOpen })\n          } }\n        >\n          <i className=\"mini-icon fas fa-cog\" />\n        </div>\n\n        <div\n          onClick={ () => updateBoxState({ ...state, menuOpen : ! menuOpen }) }\n          className='box-top-bar--controls--menu'\n        >\n          <i className=\"mini-icon fas fa-ellipsis-v\"></i>\n        </div>\n      </div>\n      \n      {\n        menuOpen ?\n          <div className='box-top-bar--menu' >\n            {/* TODO: move into ... menu */}\n            <div\n              className='box-top-bar--menu-item'\n              onClick={ removeBox }\n            >\n              Remove\n              {/* <i\n                className='mini-icon far fa-trash-alt'\n                onClick={ removeBox }\n                title='Remove this Box'\n              /> */}\n            </div>\n\n            <div\n              className='box-top-bar--menu-item'\n              onClick={ () => addBoxAfter }\n            >\n              New Box Before\n            </div>\n\n            <div className='box-top-bar--menu-item'>\n              New Box After\n            </div>\n          \n          </div>\n        :\n        null\n\n      }\n      \n    </div>\n  )\n\n}","import React, { MouseEvent } from 'react'\nimport { mapBoxTypeToStr } from '../AppTypes'\nimport Box from './Box'\nimport BoxTitleBar from './BoxTitleBar'\nimport { BoxState } from '../Types'\n\nimport \"../styles/BoxContainer.css\"\n\n\ninterface Props {\n  isActiveBox : boolean\n  isFocusedBox : boolean\n  box : BoxState\n\n  makeActive : () => void\n  onBlur : () => void\n  updateBoxState : (state : BoxState) => void\n  removeBox : () => void\n  addBoxBefore : (state : BoxState) => void\n  addBoxAfter : (state : BoxState) => void\n}\n\nexport function BoxContainer (props : Props) : JSX.Element {\n  const {\n    isActiveBox,\n    isFocusedBox,\n    box,\n    makeActive,\n    onBlur,\n    updateBoxState,\n    addBoxBefore,\n    addBoxAfter,\n    removeBox\n  } : Props = props\n\n  const { settingsOpen } : BoxState = box\n\n  const boxTypeClassName : string = mapBoxTypeToStr(box.type)\n\n  return (\n    <div\n      className={ `boxContainer ${ isActiveBox ? 'active' : 'inactive' } ${boxTypeClassName}` }\n      onClick={ makeActive }\n      onBlur={ onBlur }\n    >\n      <BoxTitleBar\n        state={ box }\n        isActive={ isActiveBox }\n        isFocused={ isFocusedBox }\n        removeBox={ (e : MouseEvent) => {\n          e.stopPropagation()\n          removeBox()\n         } }\n        updateBoxState={ (box : BoxState) => updateBoxState(box) }\n        addBoxBefore={ addBoxBefore }\n        addBoxAfter={ addBoxAfter }\n      />\n      \n      {\n        settingsOpen ?\n          <div className='box-settings'>\n            Box Settings Override:\n          </div>\n        :\n          null\n      }\n      \n      <Box\n        state={ box }\n        isActive={ isActiveBox }\n        isFocused={ isFocusedBox }\n        updateBoxState={ (box : BoxState) => updateBoxState(box) }\n        addBoxAfter={ addBoxAfter }\n      />\n    </div>\n  )\n}","// This component needs to be able to specify which Boxes are allowed inside\n// It will also have other settings - maybe something like lock - if it's locked, you can not modify it\n// Exam mode will feature the build of the Frontend which will not import any of the Evaluation Boxes\n\n\nimport React, { PureComponent } from 'react'\nimport CreateBox from '../components/CreateBox'\nimport { BoxType, NotebookState, GlobalSettings, BoxState } from '../Types'\n\nimport { onMarkDownBlur, NoteState } from '../markdown-integration/AppTypes'\nimport { BoxContainer } from '../components/BoxContainer'\n\ninterface Props {\n  state : NotebookState\n  settings : GlobalSettings\n\n  updateNotebook (notebook : NotebookState) : void\n}\n\nexport default class Notebook extends PureComponent<Props> {\n  constructor (props : Props) {\n    super(props)\n\n    this.insertBefore = this.insertBefore.bind(this)\n    this.insertAfter = this.insertAfter.bind(this)\n    this.removeBox = this.removeBox.bind(this)\n    this.updateBoxState = this.updateBoxState.bind(this)\n    this.makeActive = this.makeActive.bind(this)\n    this.onBlur = this.onBlur.bind(this)\n    this.createBoxFromURL = this.createBoxFromURL.bind(this)\n    this.setBoxState = this.setBoxState.bind(this)\n  }\n\n  componentDidMount () : void {\n    this.createBoxFromURL()\n  }\n\n  render () {\n    const { state, settings } = this.props\n    const { activeBoxIndex, focusedBoxIndex, boxList, allowedBoxes } = state\n\n    return (\n      <div className=\"mainSpace\">\n        {/* TODO: This will be refactore out to standalone component. */}\n        <ul className=\"boxList UL\">\n          { boxList.map(\n            (box : BoxState, i : number) =>\n            <li className=\"LI\" key={ box.__key }>\n              \n              <CreateBox\n                addNew={ (box : BoxState) => this.insertBefore(i, box) }\n                whiteList={ allowedBoxes }\n                settings={ settings }\n              />\n              \n              <BoxContainer\n                box={ box}\n                isActiveBox={ activeBoxIndex === i}\n                isFocusedBox={ focusedBoxIndex === i }\n                addBoxBefore={ (box : BoxState) => this.insertBefore(i, box) }\n                addBoxAfter={ (box : BoxState) => this.insertAfter(i, box) }\n                makeActive={ () => this.makeActive(i) }\n                removeBox={ () => this.removeBox(i) }\n                updateBoxState={ (box : BoxState) => this.updateBoxState(i, box) }\n                onBlur={ () => this.onBlur(i) }\n              />          \n            </li>\n          ) }\n  \n          <CreateBox\n            addNew={ (box : BoxState) => this.insertBefore(state.boxList.length, box) }\n            whiteList={ allowedBoxes }\n            settings={ settings }\n          />\n  \n        </ul>\n      </div>\n    )\n  }\n\n  /**\n   * URL params:\n   *  type : untyped-lambda | markdown | lisp | ... \n   *  specific : {\n   *    SLI : nul\n   *    strategy : normal | applicative | simplyfied\n   *  }\n   *  source : string\n   */\n  createBoxFromURL () {\n    const urlSearchParams : URLSearchParams = new URL(window.location.toString()).searchParams\n    const type : string | null = urlSearchParams.get('type')\n\n    if (type === null) {\n      return\n    }\n\n    // switch (type) {\n    //   case BoxType.UNTYPED_LAMBDA: {\n\n    //   }\n        \n    //   default:\n    //     break;\n    // }\n    \n    console.log(window.location.toString())\n    console.log(urlSearchParams.get('type'))\n    console.log(urlSearchParams.get('source'))\n\n\n\n\n    // const hash : string = decodeURI(window.location.hash.substring(1))\n    // const isExercise : boolean = hash.indexOf('exercise:') !== -1\n\n    // const expression : string = isExercise ? hash.substring(9) : hash\n\n    // if (expression === '') {\n    //   // return\n    // }\n\n    // const box : BoxState = {\n    //   type : BoxType.EXPRESSION,\n    //   __key : Date.now().toString(),\n    //   expression : '',\n    //   ast : null,\n    //   history : [],\n    //   isRunning : false,\n    //   breakpoints : [],\n    //   timeoutID : undefined,\n    //   timeout : 10,\n    //   isExercise : isExercise,\n    //   strategy : this.getActiveStrategy(),\n    //   singleLetterNames : this.getActiveSingleLetterNames(),\n    //   standalones : this.getActiveStandalones(),\n    //   editor : {\n    //     placeholder : PromptPlaceholder.INIT,\n    //     content : expression,\n    //     caretPosition : expression.length,\n    //     syntaxError : null,\n    //   }\n    // }\n\n    // this.setState({\n    //   ...this.state,\n    //   submittedBoxes : [ box ],\n    //   activeBoxIndex : 0,\n    // })\n  }\n\n  setBoxState (index : number, boxState : BoxState) : void {\n    // const { submittedBoxes } = this.state\n    \n    // const expression : string = boxState.type === BoxType.EXPRESSION ? boxState.editor.content || (boxState as EvaluationState).expression : '' // TODO: DIRTY DIRTY BIG TIME\n    // const expPrefix : string = boxState.type === BoxType.EXPRESSION && (boxState as EvaluationState).isExercise ? 'exercise:' : '' \n    \n    // history.pushState({}, \"page title?\", \"#\" + expPrefix + encodeURI(expression))\n\n    // // TODO: doresit update URL // ted uz to docela dobry je\n\n    // // TODO: consider immutability\n    // submittedBoxes[index] = boxState\n\n    // this.setState({\n    //   ...this.state,\n    //   submittedBoxes,\n    // })\n\n  }\n\n  insertBefore (index : number, box : BoxState) : void {\n    console.log(\"              INSERT BEFORE \" + index)\n    const { boxList } = this.props.state\n\n    boxList.splice(index, 0, box)\n    this.props.updateNotebook({ ...this.props.state, boxList : boxList, activeBoxIndex : index, focusedBoxIndex : index })\n  }\n\n  insertAfter (index : number, box : BoxState) : void {\n    console.log(\"              INSERT AFTER \" + index)\n\n    const { boxList } = this.props.state\n\n    boxList.splice(index + 1, 0, box)\n    this.props.updateNotebook({ ...this.props.state, boxList : boxList, activeBoxIndex : index + 1, focusedBoxIndex : index + 1})\n  }\n\n  removeBox (index : number) : void {\n    const { boxList, activeBoxIndex } = this.props.state\n    \n    const nearestValidIndex = (i : number) => {\n      if (i < activeBoxIndex) return activeBoxIndex - 1\n      if (i > activeBoxIndex) return activeBoxIndex\n      if (boxList.length === 1) return NaN\n      if (i === 0) return i\n      return i - 1\n    }\n\n    const newIndex : number = nearestValidIndex(index)\n\n    boxList.splice(index, 1)\n    this.props.updateNotebook({ ...this.props.state, boxList : boxList, activeBoxIndex : newIndex })\n  }\n\n  updateBoxState (index : number, box : BoxState) : void {\n    const { boxList } = this.props.state\n    boxList[index] = { ...box }\n\n\n    this.props.updateNotebook({ ...this.props.state, boxList : [...boxList] })\n  }\n\n  makeActive (index : number) : void {\n    console.log(\"               MAKE ACTIVE \" + index)\n    const { activeBoxIndex, focusedBoxIndex, boxList } = this.props.state\n\n    const currentType : BoxType = boxList[activeBoxIndex].type\n\n    switch (currentType) {\n      case BoxType.UNTYPED_LAMBDA:\n        // boxList[activeBoxIndex] = onUntypedLambdaBlur(boxList[activeBoxIndex])\n        break\n      \n      case BoxType.MARKDOWN: {\n        boxList[activeBoxIndex] = onMarkDownBlur(boxList[activeBoxIndex] as NoteState)\n        break\n      }\n\n      default:\n        break\n    }\n\n    if (index !== activeBoxIndex || index !== focusedBoxIndex || boxList[index].minimized === true) {\n      boxList[index].minimized = false;\n\n      this.props.updateNotebook({ ...this.props.state, activeBoxIndex : index, focusedBoxIndex : index, boxList })\n    }\n  }\n\n  onBlur (index : number) : void {\n    // TODO: I may not need onBlur handling in the future\n    // I am thinking - right now all it does is this:\n    // it un-focuses currently focused Box\n    // if this is not really needed - then maybe I should not have this feature\n    console.log(\"                  BLUR \" + index)\n    const { boxList, activeBoxIndex } = this.props.state\n\n    if (activeBoxIndex !== index) {\n      return\n    }\n\n    const currentType : BoxType = boxList[index].type\n\n    switch (currentType) {\n      case BoxType.UNTYPED_LAMBDA:\n        // boxList[activeBoxIndex] = onUntypedLambdaBlur(boxList[activeBoxIndex])\n        break\n      \n      case BoxType.MARKDOWN: {\n        // boxList[index] = onMarkDownBlur(boxList[index] as NoteState)\n        return // TODO: just for now\n      }\n\n      default:\n        break\n    }\n\n    this.props.updateNotebook({ ...this.props.state, boxList, focusedBoxIndex : undefined })\n  }\n}","import React from 'react'\nimport 'github-markdown-css'\n\nimport guide from '../misc/UserGuide'\nconst ReactMarkdown = require('react-markdown')\n\nexport default function Help (props : {}) : JSX.Element {\n  return (\n  <div className='helpSpace'>\n    <ReactMarkdown className='markdown-body' source={ guide } />    \n  </div>)\n}","export default `# User guide\n\n## Typing expressions\n#### To write lambda expression you simply type in the prompt.\n\n## Typing λ symbol\n#### If you want to write \\`λ\\` symbol inside of the Interactive Box - you simply type \\`\\\\\\` and Lambdulus will take care of the rest.\n\n#### If you need to write \\`λ\\` symbol inside of the Markdown Box - you can use \\`&lambda;\\` sequence.\n\n## Multiple expressions\n#### You can also have many submitted expressions. To submit another expression you need to open new empty \\`expression box\\` by clicking on the \\`λ\\` inside the \\`+λ +Macro +MD\\` panel at the end of the notebook.\n\n## Single Letter Names (SLI)\n#### You can write lambda functions and omit whitespaces such as \\`(λabc.cba) 2 1 +\\`. To do that you have to check switch \\`Single Letter Names\\` at the top of the page.\n\n## Evaluation Strategies\n#### We have option to select from 3 evaluation strategies. The \\`Simplified\\` strategy is specific evaluation order which evaluates built-in macros atomicaly. The \\`Normal\\` and the \\`Applicative\\` strategies are sort of self describing.\n\n## Macros\n#### If you want to define your own macro - you can. You must first create empty \\`macro box\\` by clicking on the \\`+Macro\\` inside the \\`+λ +Macro +MD\\` panel at the end of the notebook. Then you write macro name followed by symbol \\`:=\\` and then valid lambda expression.\n\n## Macro Definition\n#### Inside the macro definition you can reference any valid macro which is already defined or will be defined in the future. Yes you can reference macro you are just defining inside it's own definition - whether you should or not is up to you.\n\n## List All Macros\n#### If you want to list all defined macros - built-ins and also your macros - you simply click on the \\`Macro\\` icon at the top or on the left of the page.\n\n## Remove User Macro\n#### To remove user macros - \\`because you can not remove built-ins\\` - first show all macros and then hover your mouse over the macro you want to remove and click the \\`trash bin\\` icon.\n\n## Redefine User Macro\n#### To redefine user macro - \\`because you can not redefine built-ins\\` - just create new empty \\`macro box\\` and define the already existing macro again - this time with different macro definition.\n\n## Report a Bug or Request New Features\n#### If you want to report a bug or you need some feature - click on the \\`Issues\\` button on the left or at the top of the page. Then fill in the issue on the GitHub page of the project. Definitely don't forget to check if the corresponding issue already exist.\n`","import React, { ChangeEvent } from 'react'\nimport { UntypedLambdaSettings, EvaluationStrategy } from './Types'\n\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\n\ninterface Props {\n  settings : UntypedLambdaSettings\n  change : (settings : UntypedLambdaSettings) => void\n}\n\nexport default function Settings (props : Props) : JSX.Element {\n  const { settings, change } : Props = props\n  const { SLI, expandStandalones, strategy } : UntypedLambdaSettings = settings\n\n  return (\n    <div className='untypedLambdaSettings'>\n      <h3>Untyped Lambda Calculus</h3>\n\n\n      <span title='Letters as names without spaces'>\n        <Switch\n          checked={ SLI }\n          disabled={ false } // TODO: tohle bude rozhodne chtit prepsat\n          shape=\"fill\"\n          \n          onChange={\n             (e : ChangeEvent<HTMLInputElement>) => // tady nejakej destructuring\n              change({ ...settings, SLI : e.target.checked })\n          }\n        >\n          Single Letter Names\n        </Switch>\n      </span>\n\n      <br></br>\n      <br></br>\n\n      <span title='Expand stand-alones'>\n        <Switch\n          checked={ expandStandalones }\n          disabled={ false } // TODO: tohle bude rozhodne chtit prepsat\n          shape=\"fill\"\n          \n          onChange={\n            (e : ChangeEvent<HTMLInputElement>) => // tady nejakej destructuring\n              change({ ...settings, expandStandalones : e.target.checked })\n          }\n        >\n          Expand stand-alones\n        </Switch>\n      </span>\n\n      <br></br>\n      <br></br>\n\n      <div className='strategies inlineblock'>\n        <p className='stratsLabel inlineblock'>Evaluation Strategies:</p>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={\n            strategy === EvaluationStrategy.ABSTRACTION\n          }\n          \n          onChange={\n            () => change({ ...settings, strategy : EvaluationStrategy.ABSTRACTION })\n          }\n        >\n          Simplified\n        </Radio>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={\n            strategy === EvaluationStrategy.NORMAL\n          }\n          \n          onChange={\n            () => change({ ...settings, strategy : EvaluationStrategy.NORMAL })\n          }\n        >\n          Normal\n        </Radio>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={\n            strategy === EvaluationStrategy.APPLICATIVE\n          }\n          \n          onChange={\n            () => change({ ...settings, strategy : EvaluationStrategy.APPLICATIVE })\n          }\n        >\n          Applicative\n        </Radio>\n      </div>\n    </div>\n  )\n}","import React from 'react'\n\nimport UntypedLambdaCalculusSet from '../untyped-lambda-integration/Settings'\nimport { CODE_NAME as UNTYPED_CODE_NAME } from '../untyped-lambda-integration/AppTypes'\nimport { GlobalSettings } from '../Types'\nimport { UntypedLambdaSettings } from '../untyped-lambda-integration/Types'\n\n\ninterface Props {\n  settings : GlobalSettings\n  updateSettings : (settings : GlobalSettings) => void\n}\n\nexport default function SettingsScreen (props : Props) : JSX.Element {\n  const { settings, updateSettings } = props\n\n  const untypedSettings : UntypedLambdaSettings = settings[UNTYPED_CODE_NAME] as UntypedLambdaSettings\n\n  return (\n    <div className='settingsSpace'>\n      <UntypedLambdaCalculusSet\n        settings={ untypedSettings }\n        change={\n          (unTypLSet : UntypedLambdaSettings) =>\n            updateSettings({ ...settings, [UNTYPED_CODE_NAME] : unTypLSet })\n        }\n      />\n    </div>\n  )\n}","import React, { Component } from 'react'\n\nimport './App.css'\n\nimport { updateSettingsInStorage, loadAppStateFromStorage, updateAppStateToStorage, CLEAR_WORKSPACE_CONFIRMATION, loadSettingsFromStorage, ANY_BOX } from './AppTypes'\n\nimport MenuBar from './components/MenuBar'\nimport Notebook from './screens/Notebook'\nimport Help from './screens/Help'\nimport SettingsScreen from './screens/Settings'\nimport { Screen, AppState, NotebookState, GlobalSettings } from './Types'\n\n\n\n/**\n * This is the main Application\n * in the future - when building Exam Mode - I will need to replace some part of the application components\n * if it's only some component at the top, it can be done easily\n * if it's gonna replace some deeper stuff I will need to implement some Namespace FROM which app and integrations\n * will inport parts and this Namespace will take care of that\n */\n\n\ninterface Props {}\nexport default class App extends Component<Props, AppState> {\n  constructor (props : Props) {\n    super(props)\n\n    this.state = loadAppStateFromStorage()\n\n    this.setScreen = this.setScreen.bind(this)\n    this.updateNotebook = this.updateNotebook.bind(this)\n    this.changeNotebook = this.changeNotebook.bind(this)\n    this.addNotebook = this.addNotebook.bind(this)\n    this.removeNotebook = this.removeNotebook.bind(this)\n    this.editNotebookName = this.editNotebookName.bind(this)\n    this.changeNotebookName = this.changeNotebookName.bind(this)\n    this.stopEditingNotebook = this.stopEditingNotebook.bind(this)\n    this.updateSettings = this.updateSettings.bind(this)\n    this.importWorkspace = this.importWorkspace.bind(this)\n    this.clearWorkspace = this.clearWorkspace.bind(this)\n\n    // TODO: implement Class Keyboard Controller -> handling all keyboard events and firing events -> invoking handlers from this class\n    // document.addEventListener('keydown', (event : KeyboardEvent) => {\n    //   console.log(event)\n    // })\n  }\n\n\n  render () {\n    const { notebookList, currentNotebook, currentScreen } = this.state\n    const state = notebookList[currentNotebook]\n    const { settings } = state\n\n    return (\n      <div id='app'>\n        <MenuBar\n          state={ this.state }\n          onScreenChange={ this.setScreen }\n          onImport={ this.importWorkspace }\n          onClearWorkspace={ this.clearWorkspace }\n        />\n        \n        {/* TODO: Commenting this out for now - world is not yet ready for such powers */}\n        {/* {\n          notebookList.length > 0 ?\n            <ul className='notebook-list UL'>\n              <div className='notebook-list--title'>\n                Notebook Explorer:\n              </div>\n              {\n                notebookList.map(\n                  (notebook : NotebookState, index : number) =>\n                  <li\n                    className={ `notebook-tab LI ${ currentNotebook === index ? 'current' : '' }` }\n                    key={ notebook.__key }\n                    title='Click to Select this Notebook'\n                    onClick={ () => this.changeNotebook(index) }\n                  >\n                    {\n                      notebook.editingName ?\n                        <input\n                          type='text'\n                          value={ notebook.name }\n                          onChange={ (event) => this.changeNotebookName(index, event.target.value) }\n                          onBlur={ () => this.stopEditingNotebook(index) }\n                          maxLength={12}\n                          size={ 10 }\n                          />\n                      :\n                        notebook.name\n                    }\n                    <span\n                      className='notebook-tab--edit-name'\n                      onClick={ (event) => {\n                        event.stopPropagation()\n\n                        this.editNotebookName(index)\n                      }}\n                    >\n                      <i className=\"edit-name mini-icon fas fa-pen\" title='Click to Change the Notebook Name' />\n                    </span>\n\n                    <div className='notebookIconWrapper'>\n                        {\n                          notebookList.length === 1 ?\n                          null\n                          :\n                          <i\n                            className=\"removeNtb mini-icon fas fa-trash-alt\"\n                            title='Click to Remove this Notebook'\n                            onClick={ (event) => {\n                              event.stopPropagation()\n                              this.removeNotebook(index) } }\n                          />\n                        }\n                      </div>\n                  </li>\n                )\n              }\n              <li\n                className='notebook-tab LI'\n                title='Click to Add New Notebook'\n                onClick={ this.addNotebook }\n              >\n                Add New\n                <div className='notebookIconWrapper'>\n                  <i className=\"addNtb mini-icon fas fa-plus\" />\n                  </div>\n              </li>\n            </ul>\n          :\n            null\n        } */}\n        {\n          (() => {\n            if (currentScreen === Screen.MAIN)\n              return <Notebook state={ state } updateNotebook={ this.updateNotebook } settings={ settings } />\n            if (currentScreen === Screen.HELP)\n              return <Help/>\n            if (currentScreen === Screen.SETTINGS)\n              return <SettingsScreen settings={ settings } updateSettings={ this.updateSettings } />\n          })()\n        }\n        \n      </div>\n    )\n  }\n\n  setScreen (screen : Screen) : void {\n    this.setState({ currentScreen : screen })\n  }\n\n  updateNotebook (notebook : NotebookState) : void {\n    const { notebookList, currentNotebook } = this.state\n\n    notebookList[currentNotebook] = notebook\n\n    this.setState({ notebookList })\n    updateAppStateToStorage({ ...this.state })\n    // NOTE: Carefuly around here - I kinda rely on the mutation of this.state.notebookList\n  }\n\n  changeNotebook (index : number) : void {\n    this.setState({ currentNotebook : index })\n    updateAppStateToStorage({ ...this.state, currentNotebook : index })\n  }\n\n  addNotebook () : void {\n    this.setState({\n      notebookList : [ ...this.state.notebookList, createNewNotebook() ],\n      currentNotebook : this.state.currentNotebook + 1\n    })\n\n    updateAppStateToStorage({\n      ...this.state,\n      notebookList : [ ...this.state.notebookList, createNewNotebook() ],\n      currentNotebook : this.state.currentNotebook + 1\n    })\n  }\n\n  removeNotebook (index : number) : void {\n    // if (index === 0) return\n\n    const { notebookList, currentNotebook } = this.state\n    \n    const nearestValidIndex = (i : number) => {\n      if (i < currentNotebook) return currentNotebook - 1\n      if (i > currentNotebook) return currentNotebook\n      if (notebookList.length === 1) return NaN\n      if (i === 0) return i\n      return i - 1\n    }\n    \n    const newIndex : number = nearestValidIndex(index)\n    \n    if (Number.isNaN(newIndex)) return\n\n    notebookList.splice(index, 1)\n\n    this.setState({ notebookList, currentNotebook : newIndex })\n    updateAppStateToStorage({\n      ...this.state,\n      notebookList,\n      currentNotebook : newIndex,\n    })\n  }\n\n  editNotebookName (index : number) : void {\n    const { notebookList } = this.state\n\n    const notebook : NotebookState = notebookList[index]\n\n    notebookList[index] = { ...notebook, editingName : true, persistent : true }\n\n    this.setState({ notebookList })\n    updateAppStateToStorage({ ...this.state })\n  }\n\n  changeNotebookName (index : number, name : string) : void {\n    const { notebookList } = this.state\n\n    const notebook : NotebookState = notebookList[index]\n\n    notebookList[index] = { ...notebook, name }\n\n    this.setState({ notebookList })\n    updateAppStateToStorage({ ...this.state })\n  }\n\n  stopEditingNotebook (index : number) : void {\n    const { notebookList } = this.state\n\n    const notebook : NotebookState = notebookList[index]\n\n    notebookList[index] = { ...notebook, editingName : false }\n\n    this.setState({ notebookList })\n    updateAppStateToStorage({ ...this.state })\n  }\n\n  updateSettings (newSettings : GlobalSettings) : void {\n    const { currentNotebook, notebookList } = this.state\n    notebookList[currentNotebook].settings = newSettings\n\n    this.setState({ notebookList : [...notebookList] })\n    updateSettingsInStorage(newSettings)\n  }\n\n  importWorkspace (state : AppState) : void {\n    this.setState(state)\n    updateAppStateToStorage(state)\n  }\n\n  clearWorkspace () : void {\n    if (window.confirm(CLEAR_WORKSPACE_CONFIRMATION)) {\n      localStorage.removeItem('AppState')\n\n      this.setState(loadAppStateFromStorage())\n    }\n  }\n}\n\nfunction createNewNotebook () : NotebookState {\n  return {\n    boxList : [],\n    activeBoxIndex : NaN,\n    focusedBoxIndex : undefined,\n    allowedBoxes : ANY_BOX,\n    settings : loadSettingsFromStorage(),\n    \n    __key : Date.now().toString(),\n    name : \"Temp Notebook\",\n    editingName : false,\n    persistent : true, // TODO: you can change this if explicit save/rename is required for persistency\n  }\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}